"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[499],{7154:(t,e,s)=>{s.d(e,{T:()=>l,Z:()=>a});var i=s(6666),o=s(1404),n=s.n(o),r=s(4711);class a{constructor(){const t=new(n().Workbook);t.created=new Date,t.creator="Jira Assistant",t.lastModifiedBy="Jira Assistant",this.document=t}addTable(t){t=i(t);const e=this.normalizeSheetName(t.attr("export-sheet-name"));console.log("Exporting ",e),this.worksheet=this.document.addWorksheet(e),this.sheetOptions={mergeCells:[],width:{},styles:[],rowsToRemove:[],rowsToHide:[]},this.curRowNum=1;const s=t.find("> thead:not([exportignore]) > tr:not([exportignore])");this.prepareData(s),console.log("header rows",s.length);const o=t.find("> tbody:not([exportignore]) > tr:not([exportignore])");this.prepareData(o),console.log("bodyRows rows",o.length),this.worksheet.views=[{state:"frozen",xSplit:0,ySplit:s.length}],this.sheetOptions.mergeCells.forEach((t=>this.worksheet.mergeCells(t)));const n=this.sheetOptions.width;Object.keys(n).forEach((t=>{const e=this.worksheet.getColumn(t),s=parseFloat(n[t])/7.178;e.width=s})),this.sheetOptions.styles.forEach((t=>{const e=this.worksheet.getCell(t.key),s=t.style,i={};"left"!==s.textAlign&&(i.horizontal=s.textAlign),"left"!==s.verticalAlign&&(i.vertical=s.verticalAlign),e.alignment=i;const o=s.fontWeight||"";e.style.font={size:this.getFontSize(s.fontSize),bold:o.indexOf("bold")>-1||o>=550}})),this.sheetOptions.rowsToHide.forEach((t=>this.worksheet.getRow(t).hidden=!0)),this.sheetOptions.rowsToRemove.orderByDescending().forEach((t=>this.worksheet.spliceRows(t,1))),this.worksheet=null,this.sheetOptions=null,this.curRowNum=null}normalizeSheetName(t){return t?t.replace(/\[/g,"(").replace(/\]/g,")").replace(/:/g,"-").replace(/[?/\\]/g,""):t}trim(t){return t.replace(/^\s+|\s+$/gm,"")}getFontSize(t){return t?t.endsWith("px")?.75*parseInt(t.replace("px",""),10):t.endsWith("pt")?parseInt(t.replace("pt",""),10):t.endsWith("em")?.0833333*parseInt(t.replace("em",""),10):void 0:t}rgbaToHex(t){if(!t)return t;const e=t.substring(t.indexOf("(")).split(","),s=parseInt(this.trim(e[0].substring(1)),10),i=parseInt(this.trim(e[1]),10),o=parseInt(this.trim(e[2]),10);e[3]=e[3]||"1)";const n=parseFloat(this.trim(e[3].substring(0,e[3].length-1))).toFixed(2);return this.fixSize(s.toString(16))+this.fixSize(i.toString(16))+this.fixSize(o.toString(16))+this.fixSize((255*n).toString(16).substring(0,2))}fixSize(t){return 1===t.length?`0${t}`:t}prepareData(t){const e=this.worksheet,s=[];t.each(((t,o)=>{o=i(o);const n=this.getColArray(o,s);if(n){e.addRow(n).commit(),this.curRowNum++}}))}getColArray(t,e){const s=t.find("> th, > td"),o=[],n=!!t.attr("exportignore");return n&&this.sheetOptions.rowsToRemove.push(this.curRowNum),t.attr("exporthidden")&&this.sheetOptions.rowsToHide.push(this.curRowNum),s.each(((t,s)=>{for(;e[o.length]>0;)e[o.length]=e[o.length]-1,o[o.length]=null;let r=(s=i(s)).attr("exportValue");if(r||(r=s.text()),r&&!n){r=r.trim();switch(s.attr("exportType")){case"int":r=function(t){if(!t)return t;const e=parseInt(t,10);return isNaN(e)?t:e}(r);break;case"float":case"number":r=function(t){if(!t)return t;const e=parseFloat(t);return isNaN(e)?t:e}(r);break;case"date":r=h(r,!0);break;case"datetime":r=h(r,!1)}}o[o.length]=r;let a=s.attr("colspan")||1;const l=(s.attr("rowspan")||1)-1;l&&(e[o.length-1]=l);const c=this.numToChar(o.length),d=this.curRowNum;if(a>1||l>0){const t=this.numToChar(o.length+(a-1)),e=this.curRowNum+l;this.sheetOptions.mergeCells.push(`${c+d}:${t}${e}`)}if(!n){if(!a||a<2){const t=s.width();t>20&&(this.sheetOptions.width[c]=t)}this.sheetOptions.styles.push({key:c+d,style:window.getComputedStyle(s.get(0),null)})}for(;a>1;)a-=1,o[o.length]=null,l&&(e[o.length-1]=l)})),o}export(t){this.document.xlsx.writeBuffer().then((e=>{const s=new Blob([e],{type:"application/octet-stream"});(0,r.po)(s,`${t}.xlsx`)}))}charToNum(t){for(let e=0,s=1;e<s;e++,s++)t==this.numToChar(e)&&(s=e)}numToChar(t){const e=(t-1)%26,s=this.chr(65+e),i=parseInt((t-1)/26,10);return i>0?this.numToChar(i)+s:s}chr(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t))):String.fromCharCode(t)}}const l={XLSX:"XLSX",CSV:"CSV",PDF:"PDF"};function h(t,e){if(!t)return t;const s=new Date(t);return isNaN(s.getTime())?t:s}},4918:(t,e,s)=>{s.d(e,{Xk:()=>m.X,ZP:()=>T,jn:()=>S});var i=s(7313),o=s(9642),n=s(2328),r=s(8041),a=s(9168),l=s(6123),h=s.n(l),c=s(1485),d=s(6666),p=s(5508),f=(s(8695),s(7154)),g=s(4711);class u{export(){this.format&&"XLSX"===this.format.toUpperCase()?this.exportToXlsx():this.format&&this.format===f.T.PDF?this.exportToPDF():this.exportToCsv()}exportToXlsx(){const t=d(this.element),e=new f.Z(f.T.XLSX);t.find("table.exportable").each(((t,s)=>e.addTable(s))),e.export(this.fileName)}exportToCsv(){let t=d(this.element);t.is("table")||(t=t.find("table.exportable")),this.exportTable(t,t.attr("export-sheet-name")||this.fileName||"download")}exportToPDF(){const t=d(this.element).find("table.exportable:first-child"),e=t.attr("export-sheet-name")||this.fileName||"download",s=new p.default({orientation:"landscape",unit:"in",format:"a3"});s.autoTable({html:t.get(0)}),s.save(`${e}.pdf`)}exportTable(t,e){const s=[];let i=null;function o(t,e){const s=[];t.each(((t,i)=>{d(i).children("th,td").each(((i,o)=>{o=d(o);let n=s[t];for(n||(n=s[t]=[]);null!=n[i];)i++;const r=e[i];r&&r.noExport||(e[i]={noExport:o.is("[no-export]")||o.is(":hidden")&&!o.is("[force-export]")}),n[i]=function(t){const e={encode:!0,trim:!0};let s=t.attr("export-option");s=s&&s.length>10?{...e,...JSON.parse(s)}:e;const i=t.find("[export-data]:first");let o=(t.attr("export-data")||i.attr("export-data")||i.text()||t.text()).replace(/\r?\n|\r/g," ");return s.trim&&(o=o.trim()),o.indexOf('"')>=0&&(o=o.replace(/"/g,'""')),s.encode&&o.indexOf(",")>=0&&(o=`"${o}"`),o}(o);let a=parseInt(o.attr("colspan"));for(;a>1;)n[i+a-1]="",a--;let l=parseInt(o.attr("rowspan"));for(;l>1;){let e=s[t+l-1];e||(e=s[t+l-1]=[]),e[i]="",l--}}))}));let i="";for(let n=0;n<s.length;n++){let t="";const r=s[n];for(let s=0;s<r.length;s++){var o;null!==(o=e[s])&&void 0!==o&&o.noExport||(t+=`,${r[s]||""}`)}i+=`${t.substring(1).replace(/\r?\n|\r/g," ")}\r\n`}return i}i="string"===typeof t?o(d(`#${t} thead:not([no-export]) tr:not([no-export]):visible`),s)+o(d(`#${t} tbody:visible tr:not([no-export]):visible`),s):o(t.find("thead:not([no-export]) tr:not([no-export]):visible"),s)+o(t.find("tbody:visible tr:not([no-export]):visible"),s),(0,g.ut)(i,e)}}var m=s(551),x=s(7174),v=s(6444),b=s(9149),w=s(6417);const S=new r.EventEmitter;let k=0;class C extends i.PureComponent{constructor(t,e,s){super(t),this.eventReceived=t=>this.executeEvent(t),this.toggleFullScreen=()=>{let{isFullScreen:t}=this.state;t=!t,this.$analytics.trackEvent("Toggle full screen",v.Jk.GadgetActions,this.title,t),t?document.body.classList.add("fs-layout"):document.body.classList.remove("fs-layout"),this.columnResizeMode=t?"fit":"expand",this.setState({isFullScreen:t})},this.addWorklogOn=t=>{this.addWorklog({ticketNo:t})},this.removeGadget=()=>{this.$analytics.trackEvent("Gadget removed",v.Jk.GadgetActions,this.title),this.performAction(m.X.RemoveGadget)},this.setLoader=t=>this.setState({isLoading:t}),this.exportData=t=>{const e=new u;e.fileName=this.title,e.format=t||this.exportFormat,e.element=this.el,this.$analytics.trackEvent("Export data",v.Jk.GadgetActions,e.format),e.export()},this.showGadgetGontextMenu=t=>(0,c.pT)(t,this.getContextMenu()),this.getHeader=()=>{const{title:t,subTitle:e,isGadget:s,props:{draggableHandle:i}}=this,o="gadget-header"+(i?" movable":"");return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{ref:i,className:o,onContextMenu:s?this.showGadgetGontextMenu:null,onDoubleClick:this.toggleFullScreen,children:[(0,w.jsx)("i",{className:`fa ${this.iconClass}`})," ",t," ",e&&(0,w.jsxs)("span",{children:[" - ",e]}),(0,w.jsxs)("div",{className:"pull-right",children:[this.getTooltipElement(),this.renderCustomActions&&this.renderCustomActions(s),!this.hideRefresh&&this.getRefreshButton(),!this.hideMenu&&(0,w.jsx)(a.Z,{icon:"fa fa-wrench",onClick:t=>(0,c.pT)(t,this.getContextMenu())})]})]}),(0,w.jsx)("div",{className:"clearfix"})]})},this.setRef=t=>{this.el=t;const{dropProps:{dropConnector:e}={}}=this.props;e&&e(t)},(0,x.f3)(this,"AnalyticsService"),this.instanceId=++k,this.title=e,this.iconClass=s,this.isGadget=!1!==t.isGadget,this.settings=t.settings||{fullWidth:!1,fullHeight:!1};const{fullWidth:i=!1,fullHeight:o=!1}=this.settings;this.state={fullWidth:i,fullHeight:o}}getContextMenu(){const{isFullScreen:t,fullWidth:e,fullHeight:s}=this.state,i=this.isGadget?[{separator:!0},{label:"Full width",icon:`fa fa-${e?"check-":""}circle fs-16 margin-r-5`,command:()=>this.setSizeOptions(!e,s)},{label:"Full height",icon:`fa fa-${s?"check-":""}circle fs-16 margin-r-5`,command:()=>this.setSizeOptions(e,!s)},{separator:!0},{label:"Remove",icon:"fa fa-remove",command:()=>this.removeGadget()}]:[],o=[];return this.hideExport||(o.push({separator:!0}),this.hideCSVExport||o.push({label:"Export to CSV",icon:"fa fa-file-text-o",disabled:!this.exportData,command:()=>this.exportData(f.T.CSV)}),this.hideXLSXExport||o.push({label:"Export to Excel",icon:"fa fa-file-excel-o",disabled:!this.exportData,command:()=>this.exportData(f.T.XLSX)}),this.hidePDFExport||o.push({label:"Export to PDF",icon:"fa fa-file-pdf-o",disabled:!this.exportData,command:()=>this.exportData(f.T.PDF)})),[{label:"Toggle full screen",icon:"fa fa-"+(t?"compress":"expand"),command:()=>this.toggleFullScreen()},...o,...i]}componentDidMount(){this.isGadget&&(S.on("change",this.eventReceived),this.$analytics.trackEvent("Gadget loaded",v.Jk.GadgetActions,this.title)),this._isMounted=!0}componentWillUnmount(){S.off("change",this.eventReceived)}setSizeOptions(t,e){const{settings:s}=this;s.fullWidth=t,s.fullHeight=e,this.setState({fullWidth:t,fullHeight:e}),this.saveSettings()}UNSAFE_componentWillReceiveProps(t){if(this.settings!==t.settings){this.settings=t.settings||{};const{fullWidth:e,fullHeight:s}=this.settings;this.setState({fullWidth:e,fullHeight:s})}}performAction(t,e){const{onAction:s}=this.props;s&&s({type:t,data:e},this.props.model,this.props.index)}addWorklog(t){this.performAction(m.X.AddWorklog,t)}editWorklog(t){this.performAction(m.X.AddWorklog,{id:t})}saveSettings(){this.performAction(m.X.SettingsChanged,this.settings)}executeEvent(t){}getFullScreenButton(){if(this.isGadget)return null;const{state:{isFullScreen:t}}=this;return(0,w.jsx)(a.Z,{icon:t?"fa fa-compress":"fa fa-expand",onClick:this.toggleFullScreen,title:"Toggle full screen"})}getRefreshButton(t){const{disableRefresh:e,isLoading:s}=this.state;return(0,w.jsx)(a.Z,{icon:"fa fa-refresh",disabled:e||s,onClick:t||this.refreshData,title:"Refresh data"})}getTooltipElement(){return this.getHint?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(n.u,{target:`.icon-hint-${this.instanceId}`,children:this.getHint()}),(0,w.jsx)("i",{className:`fa fa-info-circle icon-hint icon-hint-${this.instanceId}`,"data-pr-position":"bottom"})]}):null}renderBase(t){const{fullWidth:e,fullHeight:s,isLoading:i,isFullScreen:n}=this.state,{isGadget:r,props:{tabLayout:a,gadgetType:l}}=this;if(a)return(0,w.jsxs)(w.Fragment,{children:[t,this.renderFooter&&this.renderFooter()]});const c=e||!r,d=s||!r,p=h()("gadget",this.className,{docked:!r,"full-width":c&&!n,"full-height":d&&!n,"half-width":!c&&!n,"half-height":!d&&!n,"full-screen":n});return(0,w.jsxs)("div",{ref:this.setRef,className:p,"data-test-id":l,children:[i&&(0,w.jsx)("div",{className:"data-loader",children:(0,w.jsx)("i",{className:"fa fa-refresh fa-spin"})}),(0,w.jsxs)(o.Panel,{header:this.getHeader(),children:[t,this.renderFooter&&this.renderFooter()]})]})}render(){return(0,w.jsx)("div",{ref:this.setRef,className:"gadget half-width half-height",children:(0,w.jsx)(o.Panel,{header:"Gadget Unavailable",children:(0,w.jsxs)("div",{className:"pad-22",children:["This section contains an un-known gadget.",b.RX&&"You could have added a new Gadget from Web version which is not yet available in extension. ",b.RX&&"If not, please report about this issue to have it fixed!",!b.RX&&"Please report about this issue to have it fixed!"]})})})}}const T=C},1499:(t,e,s)=>{s.d(e,{Z:()=>d});s(7313);var i=s(4918),o=s(3997),n=s.n(o),r=s(2725),a=s(4616),l=s(794),h=s(6417);class c extends i.ZP{constructor(t,e,s){super(t,`Bulk import - [${e}]`,s),this.fileSelected=()=>{const t=this.fileSelector,e=t.files[0];if(e){if(!e.name.endsWith(".csv"))return this.$message.warning("Unknown file selected to import. Select a valid file to import"),void(t.value="");n().parse(e,{header:!0,transformHeader:this.transformHeader,skipEmptyLines:"greedy",complete:t=>{const{data:e}=t;e&&e.length||this.$message.warning("No rows found to import","No records exists"),this.processData(e)}})}t.value=""},this.getTicketLink=t=>(0,h.jsx)(l.Z,{className:"link",href:this.$userutils.getTicketUrl(t),children:t}),this.setFileSelector=t=>this.fileSelector=t,this.chooseFileForImport=()=>this.fileSelector.click(),(0,a.f3)(this,"UserUtilsService"),this.isGadget=!1,this.hideRefresh=!0}formatDate(t){return t instanceof Date?this.$userutils.formatDateTime(t):t}renderCustomActions(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("input",{ref:this.setFileSelector,type:"file",className:"hide",accept:".csv,.json, .xlsx",onChange:this.fileSelected}),(0,h.jsx)(r.zx,{icon:"fa fa-upload",onClick:this.chooseFileForImport,title:"Choose file to import"})]})}}const d=c}}]);