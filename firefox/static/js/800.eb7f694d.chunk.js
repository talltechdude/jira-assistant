"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[800],{8514:(e,t,s)=>{s.d(t,{Z:()=>n});var a=s(7313),o=s(2725),r=s(7174),i=s(6417);class l extends a.PureComponent{constructor(e){super(e),this.searchRapidView=e=>{e=(e||"").toLowerCase();const{state:{rapidViews:t},props:{value:s}}=this;return t.filter((t=>(t.name.toLowerCase().indexOf(e)>=0||t.id.toString().startsWith(e))&&(!s||!s.some((e=>e.id===t.id)))))},this.setValue=e=>{this.props.onChange(e)},(0,r.f3)(this,"JiraService"),this.state={},this.init()}init(){return this.$jira.getRapidViews().then((e=>{const t=e.orderBy((e=>e.name)).map((e=>({name:e.name,id:e.id})));let{value:s}=this.props;if(s&&Array.isArray(s)&&s.length){const e=s.map((e=>e.id));s=t.filter((t=>!!~e.indexOf(t.id))),this.setValue(s)}this.setState({rapidViews:t})}))}render(){const{state:{rapidViews:e},props:{value:t,placeholder:s,multiple:a}}=this;return a?(0,i.jsx)(o.Qc,{value:t,onChange:this.setValue,dataset:this.searchRapidView,dropdown:!0,multiple:a,displayField:"name",placeholder:s||"start typing the board name here",size:35,maxLength:25,styleclass:"autocomplete-350",scrollHeight:"300px",disabled:!e||0===e.length}):(0,i.jsx)(o.jL,{value:t,dataset:e,displayField:"name",onChange:this.setValue})}}const n=l},3972:(e,t,s)=>{s.d(t,{Z:()=>u});s(7313);var a=s(816),o=s.n(a),r=s(6392),i=s(1783),l=s(4616),n=s(2725),d=s(7606),c=s(6444),h=s(9113),p=s(6417);class m extends i.Z{constructor(e){const{editTracker:t}=e;super(e,t?"Edit Tracker":"Add worklog"),this.saveWorklog=(e,t,s)=>{if(!this.validateData(e,t,this.state.ctlClass))return this.$message.warning("Please provide value for all the mandatory fields","Incomplete worklog details"),!1;if(this.setState({isLoading:!0}),this.props.editTracker){const{dateStarted:e,description:t}=this.state.log;this.$wltimer.editTrackerInfo(this.getTicketNo(this.state.log),e,t).then(this.props.onDone)}else this.$worklog.saveWorklog({ticketNo:this.getTicketNo(e),dateStarted:e.dateStarted,overrideTimeSpent:e.overrideTimeSpent,description:e.description,worklogId:e.worklogId,isUploaded:e.isUploaded,timeSpent:e.timeSpent,parentId:e.parentId,id:e.id},s).then((t=>{this.props.onDone(e.id>0?{type:d.Xk.WorklogModified,edited:t,previousTime:this.previousTime}:{type:d.Xk.WorklogModified,added:t}),this.onHide()}),(e=>{this.setState({isLoading:!1}),"string"===typeof e?this.$message.error(e):e.message&&this.$message.error(e.message)}))},this.setValue=(e,t,s)=>{let{log:a,vald:o,ctlClass:r}=this.state;t?(a[e]=t,s&&(r={...r,[e]:""},o={...o,[e]:!0})):delete a[e],a={...a},this.setState({log:a,vald:o,ctlClass:r})},this.formatTs=e=>e,this.handleKeyPress=e=>{const{ctrlKey:t,charCode:s}=e;if(t&&13===s){const{isLoading:e,state:{log:t,vald:s,uploadImmediately:a}}=this;e||this.saveWorklog(t,s,a&&!(t.id>0))}},this.style={width:"90vw",maxWidth:"850px"},(0,l.f3)(this,"SessionService","WorklogService","WorklogTimerService","MessageService","UtilsService","AnalyticsService"),this.className="add-worklog-popup",this.displayDateFormat="yyyy-MM-dd HH:mm";const{commentLength:s,autoUpload:a,defaultTimeSpent:o}=this.$session.CurrentUser;this.minCommentLength=s||0,this.defaultTimeSpent=function(e){if(!e)return"01:00";e=e.toString().split(".");const t=parseInt(e[0]),s=parseInt(Math.round(60*`.${e[1]||0}`))||0;return`${t.pad(2)}:${s.pad(2)}`}(o);const{worklog:r,uploadImmediately:i}=e;this.state=this.getState(r),this.state.uploadImmediately="boolean"===typeof i?i:a||!1,this.init(t)}init(e){e?this.$wltimer.getCurrentTimer().then((e=>this.setState(this.getTrackerState(e)))):this.loadWorklog(this.state.log)}loadWorklog(e){e.id&&this.fillWorklog(e,e.copy)}getTrackerState(e){const t={ticketNo:e.key,dateStarted:new Date(e.created),description:e.description};return{log:t,vald:{ticketNo:!0,dateStarted:!0,description:!!t.description}}}getState(e){const t={showDialog:!0,vald:{},ctlClass:{},isLoading:!1,log:e};if(e&&!e.id){var s;t.log={ticketNo:e.ticketNo,dateStarted:o()(e.startTime||e.dateStarted||new Date).toDate(),description:(null===(s=e.description)||void 0===s?void 0:s.trim())||"",allowOverride:e.allowOverride},e.parentId&&(t.log.parentId=e.parentId);let{timeSpent:a}=e;"number"===typeof a&&(a=this.$utils.formatSecs(a,!1,!0)),!e.allowOverride&&a&&(t.log.timeSpent=a),a?t.log.overrideTimeSpent=a:(t.log.overrideTimeSpent=this.defaultTimeSpent,t.log.allowOverride=!0),this.validateData(t.log,t.vald,t.ctlClass)}return t}fillWorklog(e,t){return this.$worklog.getWorklog(e).then((e=>{e.timeSpent&&(e.timeSpent=e.timeSpent.substring(0,5),"00:00"===e.timeSpent&&(e.timeSpent=null)),e.overrideTimeSpent&&(e.overrideTimeSpent=e.overrideTimeSpent.substring(0,5),e.allowOverride=!0),t?(this.$analytics.trackEvent("Worklog copy",c.Jk.UserActions,e.isUploaded?"Uploaded worklog":"Pending worklog"),delete e.id,delete e.isUploaded,delete e.worklogId,delete e.parentId,e.dateStarted=o()(`${(new Date).format("yyyy/MM/dd")} ${e.dateStarted.format("HH:mm:ss")}`).toDate()):(this.previousTime=e.dateStarted,this.$analytics.trackEvent("Worklog view",c.Jk.UserActions,e.isUploaded?"Uploaded worklog":"Pending worklog"));const s={log:e,vald:this.state.vald,ctlClass:this.state.ctlClass};return this.validateData(s.log,s.vald,s.ctlClass),this.setState(s),e}))}validateData(e,t,s){e.allowOverride&&(e.overrideTimeSpent=e.overrideTimeSpent||e.timeSpent||"00:00");let a=!0;const r=this.getTicketNo(e);if(a=(t.ticketNo=!(!r||r.length<3))&&a,this.props.editTracker){const s=o()(e.dateStarted),r=o()().startOf("day").toDate();a=(t.dateStarted=s.isValid()&&s.isBetween(r,new Date,void 0,"[]"))&&a}else a=(t.dateStarted=!(!e.dateStarted||e.dateStarted.length<16))&&a,t.overrideTimeSpent=e.allowOverride&&e.overrideTimeSpent&&e.overrideTimeSpent.length>=4,t.overrideTimeSpent=t.overrideTimeSpent&&this.$worklog.getTimeSpent(e.overrideTimeSpent)>0,a=(t.overrideTimeSpent=t.overrideTimeSpent||!e.allowOverride&&e.timeSpent&&e.timeSpent.length>=4)&&a;return a=(t.description=this.minCommentLength<1||!(!e.description||e.description.length<this.minCommentLength))&&a,s.ticketNo=t.ticketNo?"is-valid":"is-invalid",s.dateStarted=t.dateStarted?"is-valid":"is-invalid",s.overrideTimeSpent=t.overrideTimeSpent?"is-valid":"is-invalid",s.description=t.description?"is-valid":"is-invalid",a}getTicketNo(e){return e&&e.ticketNo?"string"===typeof e.ticketNo?e.ticketNo:e.ticketNo.value:null}deleteWorklog(e){this.setState({isLoading:!0});const t=e.ticketNo;e.ticketNo=t.value||t,this.$worklog.deleteWorklog(e).then((t=>{this.setState({isLoading:!1}),this.props.onDone({type:d.Xk.DeletedWorklog,removed:e.id,deleted:e.id,deletedObj:e}),this.onHide()}),(()=>{e.ticketNo=t}))}getFooter(){const{state:{isLoading:e,log:t,vald:s,uploadImmediately:a}}=this;return(0,p.jsxs)(p.Fragment,{children:[!t.id&&(0,p.jsx)(n.XZ,{checked:a,className:"pull-left",label:"Upload immediately to Jira",onChange:e=>this.setState({uploadImmediately:e})}),t.id>0&&(0,p.jsx)(n.zx,{type:"danger",icon:"fa fa-trash-o",label:"Delete",className:"pull-left",disabled:e,onClick:()=>this.deleteWorklog(t)}),t.id>0&&!t.worklogId&&(0,p.jsx)(n.zx,{type:"success",isLoading:e,icon:"fa fa-upload",label:"Save & Upload",className:"pull-left",disabled:e,onClick:()=>this.saveWorklog(t,s,!0)}),(0,p.jsx)(n.zx,{type:"primary",icon:"fa fa-save",label:"Save",isLoading:e,disabled:e,onClick:()=>this.saveWorklog(t,s,a&&!(t.id>0))}),(0,p.jsx)(n.zx,{type:"secondary",icon:"fa fa-times",label:"Cancel",onClick:this.onHide})]})}render(){const{minCommentLength:e,state:{log:t,vald:s,ctlClass:a}}=this;return this.state.log?super.renderBase((0,p.jsxs)("div",{className:"pad-22",onKeyPress:this.handleKeyPress,children:[(0,p.jsxs)("div",{className:"row pad-b",children:[(0,p.jsx)("div",{className:"col-sm-3",children:(0,p.jsx)("strong",{children:"Log time"})}),(0,p.jsx)("div",{className:"p-col-9 col-sm-9",children:(0,p.jsxs)("div",{className:"form-group",children:[(0,p.jsx)("div",{className:a.dateStarted,children:(0,p.jsx)(n.Mt,{value:t.dateStarted,showTime:!0,onChange:e=>this.setValue("dateStarted",e)})}),(0,p.jsx)("span",{className:"help-block "+(s.dateStarted?"":"msg-error"),children:"Provide the time you had started the work"})]})})]}),(0,p.jsxs)("div",{className:"row pad-b",children:[(0,p.jsx)("div",{className:"col-sm-3",children:(0,p.jsx)("strong",{children:"Ticket no"})}),(0,p.jsxs)("div",{className:"col-sm-9",children:[(0,p.jsx)(h.Q,{value:t.ticketNo,useDisplay:!0,className:"w-p-100",tabIndex:"3",placeholder:"Enter the ticket number or start typing the summary to get suggestion",disabled:t.isUploaded,maxLength:20,onPick:e=>this.setValue("ticketNo",e,!0)}),(0,p.jsx)("span",{className:"help-block "+(s.ticketNo?"":"msg-error"),children:"Provide the ticket no on which you had to log your work"})]})]}),!this.props.editTracker&&(0,p.jsxs)("div",{className:"row pad-b",children:[(0,p.jsx)("div",{className:"col-sm-3",children:(0,p.jsx)("strong",{children:"Actual time spent"})}),(0,p.jsx)("div",{className:"col-sm-2",children:(0,p.jsx)("strong",{children:this.formatTs(t.timeSpent)||"-"})}),(0,p.jsx)("div",{className:"col-sm-4",children:(0,p.jsx)("strong",{children:"Override time spent"})}),(0,p.jsx)("div",{className:"col-sm-3",children:(0,p.jsx)("div",{className:"form-group no-margin",children:(0,p.jsxs)("div",{className:`p-inputgroup ${a.overrideTimeSpent}`,children:[(0,p.jsx)("span",{className:"p-inputgroup-addon",children:(0,p.jsx)(n.XZ,{checked:t.allowOverride||!1,onChange:e=>this.setValue("allowOverride",e)})}),(0,p.jsx)(r.InputMask,{mask:"99:99",className:"w-80",value:t.overrideTimeSpent||"",placeholder:"00:00",maxlength:5,disabled:!t.allowOverride,onChange:e=>this.setValue("overrideTimeSpent",e.value)})]})})}),(0,p.jsx)("div",{className:"col-sm-3"}),(0,p.jsx)("div",{className:"col-sm-9 no-t-padding",children:(0,p.jsx)("span",{className:"help-block "+(s.overrideTimeSpent?"":"msg-error"),children:"Provide the time spent on this task (override to change existing)"})})]}),(0,p.jsxs)("div",{className:"row",children:[(0,p.jsx)("div",{className:"col-sm-3",children:(0,p.jsx)("strong",{children:"Comments"})}),(0,p.jsx)("div",{className:"col-sm-9",children:(0,p.jsx)(n.zC,{multiline:!0,rows:5,value:t.description||"",className:"form-control "+(s.description?"":"ctl-error"),onChange:e=>this.setValue("description",e),placeholder:"Provide a brief info about the task you had done."+(e?` Should be atleast ${e} chars is length. You can change this settings from General settings -> Worklog tab`:"")})})]})]})):"Loading..."}}const u=m},7606:(e,t,s)=>{s.d(t,{f:()=>O,kW:()=>ne,Xk:()=>a.X,Z$:()=>Ls,Em:()=>vs,Qk:()=>Ns,WP:()=>Cs,dS:()=>$s,Uz:()=>ee,bM:()=>Us,Se:()=>fs,dL:()=>Te,gM:()=>hs});var a=s(551),o=s(7313),r=s(816),i=s.n(r),l=s(1682),n=s(2e3),d=s(4298),c=s(4032),h=s(6686),p=s(1035),m=s(3860),u=s(4918),g=s(4616),f=s(9168),x=s(1270),y=s(1485),k=s(3972),j=s(1287),v=s(4711),w=s(794),S=s(6417);class N extends o.PureComponent{constructor(){super(...arguments),this.state={},this.toggleShowAttendees=()=>this.setState({showAttendees:!this.state.showAttendees}),this.toggleShowDesc=()=>this.setState({showFullDesc:!this.state.showFullDesc})}render(){const{props:{cut:e,eventDetails:t},state:{showAttendees:s,showFullDesc:a}}=this;return t?(0,S.jsxs)("div",{className:"event-details",children:[(0,S.jsxs)("div",{className:"header",children:[(0,S.jsx)("div",{className:"controls"}),(0,S.jsx)("div",{className:"title",children:e(t.summary,75)})]}),(0,S.jsxs)("div",{className:"body",children:[(0,S.jsxs)("div",{className:"detail",children:[(0,S.jsx)("div",{className:"title",children:(0,S.jsx)("i",{className:"fa fa-clock-o"})}),(0,S.jsxs)("div",{className:"info",children:[(0,S.jsx)("span",{children:t.date}),(0,S.jsxs)("span",{className:"info",children:[t.startTime," - ",t.endTime," ",t.remaining]})]})]}),t.location&&(0,S.jsxs)("div",{className:"detail",children:[(0,S.jsx)("div",{className:"title",children:(0,S.jsx)("i",{className:"fa fa-map-marker"})}),(0,S.jsx)("div",{className:"info",children:t.location})]}),t.videoCall&&(0,S.jsxs)("div",{className:"detail",children:[(0,S.jsx)("div",{className:"title",children:(0,S.jsx)("i",{className:"fa fa-video-camera"})}),(0,S.jsx)("div",{className:"info",children:(0,S.jsxs)(w.Z,{href:t.videoCall.url,children:["Join meeting: ",t.videoCall.name]})})]}),t.attendees&&(0,S.jsxs)("div",{className:"detail pointer",children:[(0,S.jsx)("div",{className:"title",children:(0,S.jsx)("i",{className:"fa fa-users"})}),(0,S.jsxs)("div",{className:"info",onClick:this.toggleShowAttendees,children:[(0,S.jsx)("div",{className:"icon pull-right",children:(0,S.jsx)("i",{className:"fa "+(s?"fa-angle-up":"fa-angle-down")})}),(0,S.jsxs)("div",{children:[(0,S.jsxs)("span",{children:[t.attendees.total," guests"]}),t.attendees&&(0,S.jsxs)("span",{className:"info",children:[t.attendees.yes&&(0,S.jsxs)("font",{children:[t.attendees.yes," yes,"]}),t.attendees.no&&(0,S.jsxs)("font",{children:[t.attendees.no," no,"]}),t.attendees.tentative&&(0,S.jsxs)("font",{children:[" ",t.attendees.tentative," tentative,"]}),t.attendees.awaiting&&(0,S.jsxs)("font",{children:[" ",t.attendees.awaiting," awaiting"]})]})]})]}),s&&t.attendees&&(0,S.jsx)("div",{className:"attendees",children:t.attendees.list.map(((e,t)=>(0,S.jsxs)("div",{className:"attendee",children:[e.displayName&&(0,S.jsxs)("span",{className:"name",children:[" ",e.displayName]}),e.email&&(0,S.jsxs)("span",{className:"email",children:[" (",e.email,")"]})]},t)))})]}),t.description&&(0,S.jsxs)("div",{className:"detail",children:[(0,S.jsx)("div",{className:"title",children:(0,S.jsx)("i",{className:"fa fa-align-justify"})}),(0,S.jsx)("div",{className:"info",children:(0,v.rg)(a?t.description:e(t.description,350))}),t.description.length>350&&(0,S.jsx)("div",{style:{textAlign:"center"},children:(0,S.jsx)("span",{className:"link",onClick:this.toggleShowDesc,children:a?"show less":"show all"})})]})]})]}):null}}const T=N;var C=s(1783),b=s(2725);const{googleCalendar:D,outlookCalendar:$}=m.default.features.integrations,W=!1!==$||!1!==D;class U extends C.Z{constructor(e){super(e,"Calendar configurations"),this.setValue=(e,t)=>{let{settings:s}=this.state;s={...s},e||!1===e?s[t]=e:delete s[t],this.setState({settings:s})},this.onDone=()=>{this.props.onDone(this.state.settings),this.onHide()},this.state={showDialog:!0,settings:{...e.settings}},this.style={width:"667px"}}getFooter(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.zx,{type:"default",icon:"fa fa-times",label:"Cancel",onClick:this.onHide}),(0,S.jsx)(b.zx,{type:"success",icon:"fa fa-floppy-o",label:"Done",onClick:this.onDone})]})}render(){const{settings:e}=this.state;return super.renderBase((0,S.jsxs)("div",{className:"pad-22",children:[(0,S.jsx)("h3",{className:"control-sidebar-heading",children:"Item Colors"}),W&&(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Meeting entry color"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)(b.zH,{value:e.eventColor,fieldName:"eventColor",onChange:this.setValue}),(0,S.jsx)("label",{className:"form-check-label",children:"Specify the color of the entry for meeting"})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Worklog entry color"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)(b.zH,{value:e.worklogColor,fieldName:"worklogColor",onChange:this.setValue}),(0,S.jsx)("label",{className:"form-check-label",children:"Specify the color of the worklog entry"})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Info color (Valid)"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)(b.zH,{value:e.infoColor_valid,fieldName:"infoColor_valid",onChange:this.setValue}),(0,S.jsx)("label",{className:"form-check-label",children:"Specify the color of the info entry when the total hours logged is equal to the max hours to log setting"})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Info color (Less)"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)(b.zH,{value:e.infoColor_less,fieldName:"infoColor_less",onChange:this.setValue}),(0,S.jsx)("label",{className:"form-check-label",children:"Specify the color of the info entry when the total hours logged is lesser than the max hours to log"})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Info color (High)"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)(b.zH,{value:e.infoColor_high,fieldName:"infoColor_high",onChange:this.setValue}),(0,S.jsx)("label",{className:"form-check-label",children:"Specify the color of the info entry when the total hours logged is higher than the max hours to log"})]})]}),(0,S.jsx)("h3",{className:"control-sidebar-heading",children:"Show / Hide Entries"}),W&&(0,S.jsx)("div",{className:"form-group",children:(0,S.jsx)(b.XZ,{checked:e.showMeetings||!1,onChange:e=>this.setValue(e,"showMeetings"),label:"Display entry for meetings integrated from calendar"})}),(0,S.jsx)("div",{className:"form-group",children:(0,S.jsx)(b.XZ,{checked:e.showWorklogs||!1,onChange:e=>this.setValue(e,"showWorklogs"),label:"Display worklog added by you"})}),(0,S.jsx)("div",{className:"form-group",children:(0,S.jsx)(b.XZ,{checked:e.showInfo||!1,onChange:e=>this.setValue(e,"showInfo"),label:"Display information about total hours logged on daily basis"})}),(0,S.jsx)("h5",{className:"control-sidebar-heading",children:"Entry details"}),(0,S.jsxs)("div",{className:"form-group",children:[(0,S.jsx)(b.EU,{value:e.detailsMode||"1",defaultValue:"1",onChange:e=>this.setValue(e,"detailsMode"),label:"Display worklog comments on worklog entry"}),(0,S.jsx)("br",{}),(0,S.jsx)(b.EU,{value:e.detailsMode||"1",defaultValue:"2",onChange:e=>this.setValue(e,"detailsMode"),label:"Display ticket summary on worklog entry"}),(0,S.jsx)("br",{}),(0,S.jsx)(b.EU,{value:e.detailsMode||"1",defaultValue:"3",onChange:e=>this.setValue(e,"detailsMode"),label:"Try accomidate both worklog comments and ticket summary on worklog entry"})]}),(0,S.jsx)("h3",{className:"control-sidebar-heading",children:"Other options"}),(0,S.jsx)("div",{className:"form-group",children:(0,S.jsx)(b.XZ,{checked:e.rowBanding||!1,onChange:e=>this.setValue(e,"rowBanding"),label:"Enable alternate row color on calendar time grid"})}),(0,S.jsxs)("div",{className:"form-group",children:[(0,S.jsx)(b.XZ,{checked:e.hideWeekends||!1,onChange:e=>this.setValue(e,"hideWeekends"),label:"Hide weekends from calendar view (even when worklog already exists)"}),"\xa0( ",(0,S.jsx)("span",{className:"fa fa-exclamation-triangle",title:"Will be applied only once the page is refreshed. Existing pending worklog would still be uploaded even if hidden"})," )"]}),(0,S.jsxs)("div",{className:"form-group",children:[(0,S.jsx)(b.XZ,{checked:e.readableEvents||!1,onChange:e=>this.setValue(e,"readableEvents"),label:"Allow small events to expand in height to make it readable"}),"\xa0( ",(0,S.jsx)("span",{className:"fa fa-exclamation-triangle",title:"This settings may result in small events overlapping with other events. This settings would be applied only after page refresh."})," )"]})]}))}}const L=U;var E=s(6444),I=s(4074);class M extends o.PureComponent{componentDidMount(){this.props.enabled&&this.props.onChange()}render(){return null}}const F=M,P=[{value:"dayGridMonth",label:"Month"},{value:"timeGridWeek",label:"Week"},{value:"timeGridDay",label:"Day"},{value:"listMonth",label:"Month List"},{value:"listWeek",label:"Week List"},{value:"listDay",label:"Day List"},{value:"dayGridWeek",label:"Grid Week"},{value:"dayGridDay",label:"Grid Day"}],R=[n.Z,d.Z,p.ZP,c.Z,h.ZP],{googleCalendar:A,outlookCalendar:H}=m.default.features.integrations,V=(!1!==H||!1!==A)&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("li",{children:["One click ",(0,S.jsx)("span",{className:"fa fa-clock-o"})," icon to create worklog entry for meetings"]}),(0,S.jsx)("li",{children:'You can set "Default meeting ticket" in General Settings \u21e8 Worklog tab'})]});class B extends u.ZP{constructor(e){super(e,"Calendar","fa-calendar"),this.refreshData=()=>this.fillEvents(this.startDate,this.endDate),this.viewModeChanged=e=>{this.setState({viewMode:e}),this.fullCalendarOpts.dayHeaderFormat=this.getDayHeaderFormat(e),this.calendar.getApi().changeView(e),this.saveSettings({...this.state.settings,viewMode:e},!0)},this.hideWorklogDialog=()=>this.setState({showAddWorklogPopup:!1}),this.toggleSettingsDialog=()=>this.setState({showSettingsPopup:!this.state.showSettingsPopup}),this.addEvent=e=>{if(0===e.type)return;let t=!1,{events:s}=this.state;if(s=[...s],e.removed){const t=e.removed+(e.deletedObj.worklogId?`#${e.deletedObj.worklogId}`:"");e=s.first((e=>e.id===t&&1===e.entryType)),s.remove(e)}else if(e.added||e.edited){const a=e.previousTime;e=e.added||e.edited,(e={...e}).backgroundColor=this.state.settings.worklogColor,e.borderColor=e.backgroundColor,s.removeAll((t=>t.id===e.id&&1===t.entryType)),s.push(e),t=!0,a&&this.updateAllDayEvent({start:a},s)}return this.updateAllDayEvent(e,s),this.setEventsData(s),t},this.hideOPEvent=()=>this.setState({showOpEvent:!1}),this.eventClick=e=>{const{event:t,jsEvent:s,view:a}=e;return s.target.hasAttribute("event-icon")||(this.currentMeetingViewItem=null,1===t.extendedProps.entryType?this.showWorklogPopup(t.extendedProps.sourceObject):2===t.extendedProps.entryType&&(this.currentMeetingViewItem=s.srcElement,this.showCalendarDetails(t,s,a))),!1},this.renderEventContent=e=>{const{timeText:t,event:s,view:{type:a}}=e,{entryType:o,logged:r,diff:i}=s.extendedProps;if(3===o)return(0,S.jsx)("span",{className:"pad-l-5",children:this.getLoggedTimeTitle(r,i)});const l=` (${this.$utils.formatTs(this.getEventDuration(s))})`,n=s.extendedProps.sourceObject;let d,c,h,p=s.title,m="";if(1===o){const{detailsMode:e}=this.state.settings;"2"===e?p=`${null===n||void 0===n?void 0:n.ticketNo} - ${null===n||void 0===n?void 0:n.summary}`:"3"===e&&(m=null===n||void 0===n?void 0:n.summary)}if(n&&(d=`${t} ${l}\n${p}`),1===o){const e=n;h=t=>{this.mnuWL_Upload.disabled=e.isUploaded,this.currentWLItem=e,(0,y.pT)(t,this.contextMenuItems)},c=(0,S.jsx)("i",{className:"fa fa-ellipsis-v pull-left",title:"Show options",onClick:h,"event-icon":"true"})}else if(2===o){var u;const e=n,t=null===(u=this.state.events)||void 0===u?void 0:u.some((e=>e.parentId===s.id&&1===e.entryType));h=(a,o,r)=>{a.stopPropagation(),a.preventDefault(),this.currentMeetingItem=e,this.currentMeetingExtdProps=s.extendedProps,this.mnuCal_AddWL.disabled=t,this.mnuCal_OpenUrl.disabled=!e.hangoutLink,(0,y.pT)(a,this.calMenuItems)},c=t?(0,S.jsx)("i",{className:"fa fa-ellipsis-v pull-left",title:"Show options",onClick:h,"event-icon":"true"}):(0,S.jsx)("i",{className:"fa fa-clock-o pull-left",title:"Create worklog for this meeting","event-icon":"true",onClick:t=>{t.stopPropagation(),this.createWorklog(t,e,this.defaultMeetingTicket)}})}if("timeGridWeek"===a||"timeGridDay"===a){const e=30*((p?3:0)+(m?3:0))>n.totalMins?" short-desc":"";return(0,S.jsxs)("div",{ref:e=>{var t,s;return null===e||void 0===e||null===(t=e.parentElement)||void 0===t||null===(s=t.parentElement)||void 0===s?void 0:s.addEventListener("contextmenu",h)},className:"fc-content pad-8",title:d,"data-jira-key":null===n||void 0===n?void 0:n.ticketNo,"data-jira-wl-id":null===n||void 0===n?void 0:n.worklogId,children:[1===o&&(0,S.jsx)(G,{worklog:n,onUpload:this.uploadSelectedWorklog,onClone:this.cloneWorklog}),c,(0,S.jsxs)("div",{className:"fc-time",children:[(0,S.jsx)("span",{children:t}),(0,S.jsxs)("span",{className:"fc-hour",children:[" ",l]})]}),(0,S.jsx)("div",{className:`fc-title${e}`,children:p}),!!m&&(0,S.jsx)("div",{className:`fc-sub-title${e}`,title:m,children:m})]})}return!0},this.uploadSelectedWorklog=async e=>{try{this.setState({uploading:!0});const t=await this.$worklog.uploadWorklogs([e],!0);this.setState({uploading:!1}),this.$message.success("Worklog uploaded successfully!");const{events:s}=this.state;s.removeAll((t=>1===t.entryType&&t.id.toString()===e.toString())),this.addEvent({added:this.$worklog.getWLCalendarEntry(t[0])}),this.$analytics.trackEvent("Worklog uploaded: Individual",E.Jk.UserActions)}catch(t){(t.message||t.response)&&this.$message.error(t.message||t.response)}finally{this.setState({uploading:!1})}},this.cloneWorklog=async e=>{try{const t=await this.$worklog.copyWorklog(e);this.addEvent({added:t}),this.$message.success("Worklog cloned!"),this.$analytics.trackEvent("Worklog Cloned: Individual",E.Jk.UserActions)}catch(t){this.$message.error(t.message,"Clone failed")}},this.saveSettings=(e,t)=>{if(this.isGadget)return super.saveSettings(),void(!0!==t&&this.refreshData());this.$session.pageSettings.calendar=e,this.setGadgetClass(e),this.setState({settings:e},!0!==t?this.refreshData:null),this.$config.saveSettings("calendar",e)},this.toggleDisplayHours=()=>this.setState((e=>this.updateOpts(e,{fullView:!e.fullView}))),this.toggleZoom=()=>this.setState((e=>this.updateOpts(e,{zoomIn:!e.zoomIn}))),this.today=()=>this.calendar.getApi().today(),this.setCalRef=e=>this.calendar=e,(0,g.f3)(this,"SessionService","WorklogService","MessageService","AnalyticsService","OutlookService","CalendarService","UtilsService","UserUtilsService","ConfigService","TicketService","AppBrowserService"),this.hideMenu=!e.isGadget,this.hideRefresh=!0,this.hideExport=!0,this.$session.pageSettings.calendar?this.state.settings=Object.assign({showMeetings:!0,showWorklogs:!0,showInfo:!0},this.$session.pageSettings.calendar):this.state.settings={viewMode:"timeGridWeek",showMeetings:!0,showWorklogs:!0,showInfo:!0},this.setGadgetClass(this.state.settings),this.setMenuItems(),this.CurrentUser=this.$session.CurrentUser,this.maxTime=this.CurrentUser.maxHours,this.minTime=this.CurrentUser.minHours||this.maxTime,this.dateFormat=this.CurrentUser.dateFormat,this.maxTime&&(this.maxTime=60*this.maxTime*60),this.minTime&&(this.minTime=60*this.minTime*60),this.fullCalendarOpts=this.getCalendarOptions(this.state)}setGadgetClass(e){let{rowBanding:t}=e;const s=t?" cal-row-banding":"";this.props.isGadget?this.className=`calendar-view${s}`:this.className=s}getHint(){return(0,S.jsxs)("ul",{className:"gadget-hint",children:[(0,S.jsx)("li",{children:"Pressing left Alt + drag drop worklog will copy the worklog to target slot"}),V,(0,S.jsx)("li",{children:"Drag and drop or resize the worklog to edit it"}),(0,S.jsx)("li",{children:"Right click worklog to see more options"}),(0,S.jsxs)("li",{children:["You can change the hours grid in calendar by changing the working",(0,S.jsx)("br",{}),"and display hours in General Settings page"]})]})}async setMenuItems(){this.mnuWL_Upload={label:"Upload worklog",icon:"fa fa-upload",command:()=>this.uploadWorklog()},this.contextMenuItems=[{label:"Edit worklog",icon:"fa fa-edit",command:()=>this.showWorklogPopup(this.currentWLItem)},{label:"Open ticket",icon:"fa fa-external-link",command:()=>this.openTicket(this.currentWLItem)},{label:"Copy worklog",icon:"fa fa-copy",command:()=>this.copyWorklog()},this.mnuWL_Upload,{label:"Delete worklog",icon:"fa fa-times",command:()=>this.deleteWorklog()}];const e=(this.$session.CurrentUser.meetingTicket||"").trim().split(",").map((e=>e.trim())).filter(Boolean),t=await this.$ticket.getTicketDetails(e),s=[];e.length>0&&(e.forEach((e=>{const{fields:{summary:a=""}={}}=t[e.toUpperCase()]||{};s.push({label:a?`${e}: ${this.$utils.cut(a,65,!0)}`:e,icon:"fa fa-ticket",command:t=>this.createWorklog(t.originalEvent,this.currentMeetingItem,e)})})),1===e.length&&(this.defaultMeetingTicket=e[0])),s.length>0&&s.push({separator:!0}),s.push({label:"Choose ticket",icon:"fa fa-pencil-square-o",command:e=>this.createWorklog(e.originalEvent,this.currentMeetingItem,"")}),this.mnuCal_AddWL={label:"Add worklog to",icon:"fa fa-clock-o",items:s,command:e=>this.createWorklog(e.originalEvent,this.currentMeetingItem,"")},this.mnuCal_OpenUrl={label:"Open video call",icon:"fa fa-video-camera",command:()=>this.openVideoCall(this.currentMeetingItem)},this.calMenuItems=[this.mnuCal_AddWL,{label:"Show details",icon:"fa fa-info-circle",command:e=>this.showCalendarDetails({extendedProps:this.currentMeetingExtdProps},e.originalEvent,null)},this.mnuCal_OpenUrl]}getDayHeaderFormat(e){if("dayGridMonth"===e)return;let t=this.dateFormat?E.Yv[this.dateFormat]:void 0;return t&&(t=t.replace("YYYY","").replace(/-/g,"/").clearStart(["/",","," "]).clearEnd(["/",","," "]),t.includes("ddd")||(t=`ddd, ${t}`)),t}getCalendarOptions(e){var t;let{fullView:s,zoomIn:a}=e;const{startOfDay:o,endOfDay:r,startOfWeek:i,workingDays:l,timeFormat:n}=this.CurrentUser,{viewMode:d}=this.isGadget?this.props:this.state.settings,{hideWeekends:c,readableEvents:h}=this.state.settings,{startOfDayDisp:p,endOfDayDisp:m}=s?{startOfDayDisp:"00:00",endOfDayDisp:"23:59"}:this.CurrentUser;let u=i;u&&u>0?u-=1:u=null;const g=(n||"").indexOf("tt")>-1,f=!!g&&"short";let x=c?[0,1,2,3,4,5,6].filter((e=>!l.includes(e))):[];return 7===(null===(t=x)||void 0===t?void 0:t.length)&&(x=[]),{plugins:R,timeZone:"local",weekends:!0,hiddenDays:x,titleFormat:this.dateFormat?E.Yv[this.dateFormat]:void 0,dayHeaderFormat:this.getDayHeaderFormat(d),eventMinHeight:h?40:void 0,displayEventTime:!0,selectable:!0,firstDay:u,height:"100%",fixedWeekCount:!1,dayMaxEventRows:!0,editable:!0,droppable:!0,slotDuration:a?"00:05:00":"00:15:00",slotMinTime:p||o||E.T2,slotMaxTime:m||r||E.$K,allDayText:"total",headerToolbar:!1,nowIndicator:!0,navLinks:!0,initialView:d,businessHours:{daysOfWeek:l||E.rQ,startTime:o||E.T2,endTime:r||E.$K},slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:g,meridiem:f,hour12:g},eventTimeFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:g,meridiem:f,hour12:g},select:this.select.bind(this),datesSet:this.viewRender.bind(this),eventDrop:this.eventDrop.bind(this),eventResize:this.eventResize.bind(this),eventClick:this.eventClick}}UNSAFE_componentWillReceiveProps(e){e.viewMode&&this.setState({settings:{...this.state.settings,viewMode:e.viewMode}}),super.UNSAFE_componentWillReceiveProps(e)}createWorklog(e,t,s){if((0,y.cO)(),!t.start.dateTime)return;e.stopPropagation(),e.preventDefault();const a=r.duration(r(t.end.dateTime).diff(t.start.dateTime)),o={dateStarted:t.start.dateTime,timeSpent:`${a.hours().pad(2)}:${a.minutes().pad(2)}`,description:t.subject||t.summary,parentId:t.id};return s?(o.ticketNo=s,this.$worklog.saveWorklog(o).then((t=>{var s;this.addEvent({added:t}),null===(s=e.currentTarget)||void 0===s||s.remove()}),(e=>{"string"===typeof e?this.$message.error(e):console.error(e)})),this.$analytics.trackEvent("Quick add WL",E.Jk.UserActions)):this.showWorklogPopup(o),!1}fillEvents(e,t){e=r(e).startOf("day"),t=r(t).endOf("day");const s=e=>{const t=[],s=this.state.settings;switch(s.showMeetings&&t.push(2),s.showWorklogs&&t.push(1),s.showInfo&&t.push(3),t.length){case 0:e=[];break;case 3:break;default:e=e.filter((e=>t.indexOf(e.entryType)>-1))}this.setColors(e),this.setEventsData(e)},a=[this.$worklog.getWorklogsEntry(e,t,["worklog","summary"])];this.CurrentUser.googleIntegration&&this.CurrentUser.hasGoogleCredentials&&this.state.settings.showMeetings&&a.push(this.$calendar.getEvents(e,t).then(null,(e=>{let t="Unable to fetch Google meetings!";return e.error&&e.error.message&&(t+=`<br /><br />Reason:- ${e.error.message}`),this.$message.warning(t),[]}))),this.CurrentUser.outlookIntegration&&this.CurrentUser.hasOutlookCredentials&&this.state.settings.showMeetings&&a.push(this.$outlook.getEvents(e,t).then(null,(e=>{let t="Unable to fetch Outlook meetings!";return e.error&&e.error.message&&(t+=`<br /><br />Reason:- ${e.error.message}`),this.$message.warning(t),[]}))),this.setState({isLoading:!0,uploading:!1}),Promise.all(a).then((e=>{this.setState({isLoading:!1});const t=e[0],a=t.filter((e=>1===e.entryType)).groupBy((e=>r(e.start).format("YYYY-MM-DD"))).map((e=>this.getAllDayObj(e)));s(t.addRange(a).addRange(e[1]))}),(e=>(this.setState({isLoading:!1}),Promise.reject(e))))}setLoggedTime(e,t){const s=this.getTimeSpent(e);return t.logged=s,s>this.maxTime?t.diff=s-this.maxTime:s<this.minTime?t.diff=s-this.minTime:t.diff=0,this.setInfoColor(t,this.state.settings),t.title=this.getLoggedTimeTitle(s,t.diff),t}getLoggedTimeTitle(e,t){const{formatSecs:s}=this.$utils;let a=`Logged: ${s(e)}`;return t&&(a+=` (${t>0?"+":"-"}${s(Math.abs(t))})`),a}setInfoColor(e,t){e.diff?e.backgroundColor=e.diff>0?t.infoColor_high:t.infoColor_less:e.backgroundColor=t.infoColor_valid,e.borderColor=e.backgroundColor}getTimeSpent(e){return e.sum((e=>{const t=r(e.start),s=r(e.end);return r.duration(s.diff(t)).asSeconds()}))}updateAllDayEvent(e,t){const s=r(e.start).format("YYYY-MM-DD");t||(t=[...this.state.events]),t.removeAll((e=>e.id===s&&3===e.entryType));const o=t.filter((e=>1===e.entryType&&r(e.start).format("YYYY-MM-DD")===s));if(o&&o.length>0){const e=this.getAllDayObj({key:s,values:o});e.logged&&(t.push(e),this.setLoggedTime(o,e))}this.setEventsData(t),this.performAction(a.X.WorklogModified)}openTicket(e){const t=this.$userutils.getTicketUrl(e.ticketNo);this.$jaBrowserExtn.openTab(t)}showWorklogPopup(e){(0,y.cO)();const t={showAddWorklogPopup:!0};if(e.copy)return t.worklogItem=e.copy,void this.setState(t);let s;if(e.id||e.parentId)s=e;else{const t=r.duration(e.end.diff(e.start));s={timeSpent:`${t.hours().pad(2)}:${t.minutes().pad(2)}`,allowOverride:!0},e.dateStarted?s.startTime=e.dateStarted:s.startTime=e.isMonthMode?r(`${e.start.format("YYYY-MM-DD")} ${this.CurrentUser.startOfDay}`,"YYYY-MM-DD HH:mm").toDate():e.start.toDate()}t.worklogItem=s,this.setState(t)}setEventsData(e){this.setState({isLoading:!1,events:[...e],pendingWorklogCount:this.getPendingWorklogs(e).length})}getAllDayObj(e){return this.setLoggedTime(e.values,{id:e.key,entryType:3,start:e.key,allDay:!0,editable:!1})}setColors(e){const t=this.state.settings,s=t.worklogColor,a=t.eventColor;e.forEach((e=>{switch(e.entryType){case 1:e.backgroundColor=s,e.borderColor=s;break;case 2:e.backgroundColor=a,e.borderColor=a;break;case 3:this.setInfoColor(e,t)}}))}select(e){let{start:t,end:s,allDay:a}=e;const o="dayGridMonth"===this.state.settings.viewMode&&!this.isGadget;return!o&&a||(this.$analytics.trackEvent("Worklog drag",E.Jk.UserActions),this.showWorklogPopup({isMonthMode:o,start:r(t),end:r(s)})),!1}showCalendarDetails(e,t,s){(0,y.cO)(),t.preventDefault(),t.stopPropagation();const a=e.extendedProps.sourceObject;if(this.$analytics.trackEvent("View event details",E.Jk.UserActions,e.extendedProps.source),"goolge"===e.extendedProps.source?this.currentMeetingItem=this.getGoogleEventView(a):"outlook"===e.extendedProps.source&&(this.currentMeetingItem=this.getOutlookEventView(a)),this.$session.isQuickView){const e=document.body.querySelector(".app-header.navbar > button[appmobilesidebartoggler]");e&&(t={currentTarget:e})}else this.currentMeetingViewItem&&(t={currentTarget:this.currentMeetingViewItem});this.opEvent.show(t),this.setState({showOpEvent:!0})}getGoogleEventView(e){const t={summary:e.summary,htmlLink:e.htmlLink,location:e.location,description:e.description,descrLimit:350,creator:e.creator,organizer:e.organizer};if(e.start){t.date=this.$userutils.formatDate(e.start.dateTime),t.startTime=this.$userutils.formatTime(e.start.dateTime);let s=r(e.start.dateTime).diff(r());s=s<0?e.end&&e.end.dateTime&&r().diff(e.end.dateTime)<0?"(now ongoing)":"":`(in ${this.$utils.formatTs(s)})`,t.remaining=s}if(e.end&&e.end.dateTime&&(t.endTime=this.$userutils.formatTime(e.end.dateTime)),e.attendees&&(t.attendees={total:e.attendees.length,yes:e.attendees.count((e=>"accepted"===e.responseStatus)),no:e.attendees.count((e=>"notAccepted"===e.responseStatus)),awaiting:e.attendees.count((e=>"needsAction"===e.responseStatus)),tentative:e.attendees.count((e=>"tentative"===e.responseStatus)),list:e.attendees}),e.hangoutLink){let s=e.hangoutLink;s.lastIndexOf("/")>0&&(s=s.substring(s.lastIndexOf("/")+1)),t.videoCall={url:e.hangoutLink,name:s}}return t}getOutlookEventView(e){const t={summary:e.subject,htmlLink:e.webLink,location:(e.location||{}).displayName,description:e.bodyPreview,descrLimit:350,creator:e.creator,organizer:((e.organizer||{}).emailAddress||{}).name};if(e.start){t.date=this.$userutils.formatDate(e.start.dateTime),t.startTime=this.$userutils.formatTime(e.start.dateTime);let s=r(e.start.dateTime).diff(r());s=s<0?e.end&&e.end.dateTime&&r().diff(e.end.dateTime)<0?"(now ongoing)":"":`(in ${this.$utils.formatTs(s)})`,t.remaining=s}if(e.end&&e.end.dateTime&&(t.endTime=this.$userutils.formatTime(e.end.dateTime)),e.attendees&&(t.attendees={total:e.attendees.length,yes:e.attendees.count((e=>"accepted"===(e.status||{}).response)),no:e.attendees.count((e=>"notAccepted"===(e.status||{}).response)),awaiting:e.attendees.count((e=>"needsAction"===(e.status||{}).response)),tentative:e.attendees.count((e=>"tentative"===(e.status||{}).response)),list:e.attendees.map((e=>{const{emailAddress:{address:t,name:s}}=e;return{email:t,displayName:s}}))}),e.onlineMeetingUrl){let s=e.onlineMeetingUrl;s.lastIndexOf("/")>0&&(s=s.substring(s.lastIndexOf("/")+1)),t.videoCall={url:e.onlineMeetingUrl,name:s}}return t}openVideoCall(e){(0,y.cO)(),e&&e.hangoutLink&&this.$jaBrowserExtn.openTab(e.hangoutLink)}viewRender(e){const{view:t}=e;this.startDate=t.activeStart,this.endDate=t.activeEnd,this.title=`Calendar - [${t.title.replace(/[^a-zA-Z0-9, /]+/g,"-")}]`,this.saveSettings({...this.state.settings,viewMode:t.type})}eventDrop(e){const{event:t,revert:s,jsEvent:a}=e,o=t.extendedProps.sourceObject,i=a.ctrlKey||a.altKey;if(!i&&o.isUploaded){const t=e.el.querySelector("i.fa-ellipsis-v");t&&(t.classList.replace("fa-ellipsis-v","fa-refresh"),t.classList.add("fa-spin")),s()}if(i){s();const e=this.state.events.first((e=>1===e.entryType&&e.id===t.id));if(e){const t=e.sourceObject;e.start=r(new Date(t.dateStarted)).toDate(),e.end=r(new Date(t.dateStarted)).add(this.$worklog.getTimeSpent(t),"minutes").toDate()}this.$worklog.copyWorklog(o,t.start).then((e=>{this.addEvent({added:e}),this.$analytics.trackEvent("Worklog quick copied",E.Jk.UserActions,o.isUploaded?"Uploaded worklog":"Pending worklog")}))}else{const e=o.dateStarted,s=Z(this.state.zoomIn?5:15,t.start);this.$worklog.changeWorklogDate(o,s).then((t=>{this.$analytics.trackEvent("Worklog moved",E.Jk.UserActions,o.isUploaded?"Uploaded worklog":"Pending worklog"),this.addEvent({previousTime:e,edited:t})}))}}eventResize(e){const{event:t}=e;this.$worklog.changeWorklogTS(t.extendedProps.sourceObject,this.getEventDuration(t,!0)).then((e=>{this.addEvent({edited:e}),this.$analytics.trackEvent("Worklog resized",E.Jk.UserActions,t.extendedProps.sourceObject.isUploaded?"Uploaded worklog":"Pending worklog")}))}getEventDuration(e,t){if(e.end&&e.start){const s=t?Z(this.state.zoomIn?5:15,e.end):e.end,a=r.duration(r(s).diff(e.start));return`${a.hours().pad(2)}:${a.minutes().pad(2)}`}if(e.extendedProps.sourceObject){const t=e.extendedProps.sourceObject,s=t.overrideTimeSpent||t.timespent;if(s&&~s.indexOf(":"))return s}return"00:00"}async uploadWorklog(e){if(this.setState({uploading:!0}),(0,y.cO)(),e)try{const e=this.getPendingWorklogs().map((e=>e.sourceObject.id));await this.$worklog.uploadWorklogs(e),this.$message.success(`${e.length} worklog(s) uploaded successfully!`),this.$analytics.trackEvent("Worklog uploaded: All",E.Jk.UserActions)}catch(t){(t.message||t.response)&&this.$message.error(t.message||t.response)}finally{this.refreshData()}else this.uploadSelectedWorklog(this.currentWLItem.id)}deleteWorklog(){(0,y.cO)(),this.$worklog.deleteWorklog(this.currentWLItem).then((()=>{this.$analytics.trackEvent("Worklog deleted",E.Jk.UserActions,this.currentWLItem.isUploaded?"Uploaded worklog":"Pending worklog"),this.addEvent({removed:this.currentWLItem.id,deletedObj:this.currentWLItem})}))}copyWorklog(){(0,y.cO)();const e=Object.create(this.currentWLItem);e.copy=!0,this.showWorklogPopup({copy:e})}getPendingWorklogs(e){return e||(e=this.state.events),e.filter((e=>1===e.entryType&&!e.sourceObject.isUploaded))}executeEvent(e){e.type!==a.X.AddWorklog&&e.type!==a.X.DeletedWorklog&&e.type!==a.X.WorklogModified||this.refreshData()}updateOpts(e,t){return this.fullCalendarOpts=this.getCalendarOptions({...e,...t}),t}renderCustomActions(){const{isGadget:e,state:{pendingWorklogCount:t,isLoading:s,uploading:a,fullView:o,zoomIn:r,settings:{viewMode:i}}}=this,l="timeGridWeek"===i||"timeGridDay"===i;return(0,S.jsxs)(S.Fragment,{children:[l&&(0,S.jsx)(f.Z,{type:"secondary",icon:o?"fa fa-compress":"fa fa-expand",onClick:this.toggleDisplayHours,title:o?"Click to show only working hours in calendar":"Click to show full day calendar"}),(0,S.jsx)(f.Z,{label:"Today",onClick:this.today,title:"Navigate to current week"}),(0,S.jsx)(f.Z,{onClick:this.toggleZoom,icon:r?"fa fa-search-minus":"fa fa-search-plus",title:r?"Zoom out to see 15 mins grid":"Zoom in to see 5 mins grid"}),!this.isGadget&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(f.Z,{icon:"fa fa-arrow-left",onClick:()=>this.calendar.getApi().prev()}),(0,S.jsx)(f.Z,{icon:"fa fa-arrow-right",onClick:()=>this.calendar.getApi().next()}),(0,S.jsx)(x.Z,{dataset:P,value:i,valueField:"value",displayField:"label",style:{width:"120px"},onChange:this.viewModeChanged})]}),(0,S.jsxs)("span",{className:"info-badge",title:t?`Upload ${t} pending worklog(s)`:"No worklog pending to be uploaded",children:[t>0&&(0,S.jsx)("span",{className:"info btn-warning",children:t}),(0,S.jsx)(f.Z,{type:"success",icon:a?"fa fa-spin fa-spinner":"fa fa-upload",disabled:a||t<1||s,onClick:()=>this.uploadWorklog(!0)})]}),(0,S.jsx)(f.Z,{icon:"fa fa-refresh",disabled:s||a,onClick:this.refreshData,title:"Refresh meetings and worklogs"}),!e&&(0,S.jsx)(f.Z,{icon:"fa fa-cogs",onClick:this.toggleSettingsDialog,title:"Show settings"})]})}render(){var e;const{hideWorklogDialog:t,addEvent:s,state:{showAddWorklogPopup:a,showSettingsPopup:o,worklogItem:r,events:i,showOpEvent:n,isLoading:d}}=this;return super.renderBase((0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(l.Z,{ref:this.setCalRef,events:i,...this.fullCalendarOpts,eventContent:this.renderEventContent}),a&&(0,S.jsx)(k.Z,{worklog:r,onDone:s,onHide:t}),o&&(0,S.jsx)(L,{settings:this.state.settings,onDone:this.saveSettings,onHide:this.toggleSettingsDialog}),(0,S.jsx)(j.T,{className:"op-event-details",ref:e=>{this.opEvent=e},showCloseIcon:!0,dismissable:!0,appendTo:document.body,onHide:this.hideOPEvent,children:n&&this.currentMeetingItem&&(0,S.jsx)(T,{eventDetails:this.currentMeetingItem,cut:this.$utils.cut})}),(0,S.jsx)(F,{enabled:!d&&this.context.needReload,onChange:this.refreshData},null===(e=this.context.timerEntry)||void 0===e?void 0:e.key)]}))}}B.contextType=I.a2;const O=B;function Z(e,t){let s=(t=r(t)).minutes()%e;if(!s)return t.toDate();return s=s<=parseInt(e/2)?-s:15-s,t.add(s,"minutes").toDate()}function G(e){let{worklog:t,onUpload:s,onClone:a}=e;return(0,S.jsxs)("div",{className:"worklog-options",children:[!t.worklogId&&(0,S.jsx)("span",{className:"fa fa-upload",title:"Upload this worklog","event-icon":"true",onClick:e=>s(t.id)}),(0,S.jsx)("span",{className:"fa fa-clone",title:"Clone worklog to same time","event-icon":"true",onClick:e=>a(t)})]})}var _=s(1857),z=s(2251);class q extends o.PureComponent{constructor(e){super(e),(0,g.f3)(this,"JiraService","SessionService");const{epicNameField:t,storyPointField:s}=this.$session.CurrentUser;this.epicNameField=null===t||void 0===t?void 0:t.id,this.storyPointField=null===s||void 0===s?void 0:s.id;const a=["key","summary","project","status","parent","assignee","issuetype","reporter","created","changeLog","timeestimate","aggregatetimeestimate","timeoriginalestimate","aggregatetimeoriginalestimate"];this.epicNameField&&a.push(this.epicNameField),this.storyPointField&&a.push(this.storyPointField),this.fieldNames=a,this.state={}}componentDidMount(){this.fetchData()}UNSAFE_componentWillReceiveProps(e){const{jql:t}=e;this.jql!==(null===t||void 0===t?void 0:t.trim())&&this.fetchData()}async fetchData(){const{jql:e,setLoader:t}=this.props;if(this.jql=null===e||void 0===e?void 0:e.trim(),this.jql){t&&t(!0);try{const t=await this.$jira.searchTickets(e,this.fieldNames,0,{expand:["changelog"]}),s=(new Date).getTime(),a=t.map((e=>{const{key:t,changelog:{histories:a}={},fields:{summary:o,status:r,issuetype:l,assignee:n,reporter:d,created:c,project:h,parent:p,timeestimate:m,aggregatetimeestimate:u,timeoriginalestimate:g,aggregatetimeoriginalestimate:f,[this.epicNameField]:x,[this.storyPointField]:y}}=e,k=[];let j=a.length;for(;--j>=0;){const{created:e,items:t}=a[j];t.filter((e=>"status"===e.field)).forEach((t=>{const{fromString:s,toString:a}=t;k.push({date:i()(e).toDate().getTime(),from:s,to:a})}))}let v=i()(c).toDate().getTime();const w=k.length-1,S=k.reduce(((e,t,a)=>{const{date:o,from:r,to:i}=t;return e[r]=(e[r]||0)+(o-v),v=o,w===a&&(e[i]=(e[i]||0)+(s-v)),e}),{});return Object.keys(S).forEach((e=>{S[e]||delete S[e]})),{key:t,summary:o,status:r,issuetype:l,assignee:n,reporter:d,created:c,project:h,parent:p,timeestimate:m,aggregatetimeestimate:u,timeoriginalestimate:g,aggregatetimeoriginalestimate:f,statusData:S,changelog:k,epic:x,storyPoint:y}})),o=a.distinct((e=>e.project.key)),r=await this.getStatuses(o);this.columnList=this.getFieldList(r),this.setState({reportData:a,statusList:r})}finally{t&&t(!1)}}else this.setState({reportData:[],statusList:[]})}getFieldList(e){const{onAddWorklog:t}=this.props;return[{field:"key",displayText:"Ticket No",type:"string",viewComponent:z.a3,props:{onAddWorklog:t}},{field:"summary",displayText:"Summary",type:"string"},{field:"project",fieldKey:"project.key",displayText:"Project",type:"string",viewComponent:z.Bx},{field:"issuetype",fieldKey:"issuetype.name",displayText:"Issue Type",type:"string",viewComponent:z.y5},{field:"epic",displayText:"Epic",type:"string",viewComponent:z.a3,props:{hideWorklog:!0}},{field:"storyPoint",displayText:"Story Points",type:"number"},{field:"timeestimate",displayText:"Time Estimate",type:"number",viewComponent:z.Hv},{field:"aggregatetimeestimate",displayText:"\u03a3 Time Estimate",type:"number",viewComponent:z.Hv},{field:"timeoriginalestimate",displayText:"Original Estimate",type:"number",viewComponent:z.Hv},{field:"aggregatetimeoriginalestimate",displayText:"\u03a3 Original Estimate",type:"number",viewComponent:z.Hv},{field:"parent",fieldKey:"project.key",displayText:"Parent",type:"string",viewComponent:z.lc,props:{onAddWorklog:t}},{field:"status",fieldKey:"status.name",displayText:"Status",type:"string",viewComponent:z.y5},{field:"created",displayText:"Created",type:"datetime",viewComponent:z.qm},{field:"assignee",fieldKey:"assignee.displayName",displayText:"Assignee",type:"string",viewComponent:z.H},{field:"reporter",fieldKey:"reporter.displayName",displayText:"Reporter",type:"string",viewComponent:z.H},...e.map((e=>({field:`statusData.${e.name}`,displayText:`Spent on ${e.name}`,type:"number",viewComponent:z.Hv,props:{inputType:"ticks",days:!0}})))]}async getStatuses(e){const t=await this.$jira.getProjectStatuses(e),s=[],a=[];return t.forEach((e=>{e.forEach((e=>{e.statuses.forEach((e=>{if(~s.indexOf(e.id))return;const{id:t,name:o,iconUrl:r}=e;s.push(t),a.push({name:o,iconUrl:r})}))}))})),a}render(){const{columnList:e,state:{loading:t,reportData:s},props:{settings:a,settingsChanged:o}}=this,{displayColumns:r,groupBy:i,groupFoldable:l,sortField:n,isDesc:d}=a||{};return(0,S.jsx)("div",{className:"statuswise-ts-grid",children:!t&&s&&(0,S.jsx)(_.Z,{dataset:s,exportSheetName:"Status wise time spent",columns:e,allowSorting:!0,onChange:o,displayColumns:r,groupBy:i,groupFoldable:l,sortField:n,isDesc:d,noRowsMessage:"No ticket details available"})})}}const X=q;var Y=s(218);class J extends C.Z{constructor(e){super(e,"Gadget configurations"),this.onDone=()=>{this.onHide(this.state.pageSettings)},this.onChange=(e,t)=>{let{pageSettings:s}=this.state;s={...s,jql:e,jqlSettings:t},this.setState({pageSettings:s})},this.className="no-padding";const{pageSettings:t}=e;this.state={showDialog:!0,pageSettings:{...t}}}getFooter(){return(0,S.jsx)(b.zx,{icon:"fa fa-floppy-o",label:"Done",onClick:this.onDone})}render(){const{pageSettings:{jql:e,jqlSettings:t}}=this.state;return super.renderBase((0,S.jsx)("div",{children:(0,S.jsx)(Y.Z,{jql:e,settings:t,onChange:this.onChange})}))}}const K=J;class Q extends u.ZP{constructor(e){super(e,"Status Wise Time Spent","fa-list-alt"),this.settingsChanged=e=>{this.pageSettingsChanged({gridSettings:e})},this.pageSettingsChanged=e=>{e&&(this.settings={...this.settings,...e},this.saveSettings()),this.setState({showSettings:!1,settings:e})},this.showSettings=()=>{this.setState({showSettings:!0})},this.setLoader=e=>{this.setState({isLoading:e})},this.refreshData=()=>{let{gridKey:e}=this.state;e++,this.setState({gridKey:e})},(0,g.f3)(this,"SessionService","AnalyticsService"),this.state.gridKey=0}renderCustomActions(){return(0,S.jsx)(b.zx,{icon:"fa fa-cogs",onClick:this.showSettings,title:"Show settings"})}render(){const{showSettings:e,gridKey:t}=this.state,{jql:s,gridSettings:a}=this.settings||{};return super.renderBase((0,S.jsxs)("div",{className:"status-wise-ts-gadget",children:[!s&&(0,S.jsxs)("div",{className:"no-jql",children:["No JQL was set to fetch the data. Click on ",(0,S.jsx)("span",{className:"fa fa-cogs"})," icon from top right corner of the gadget and modify the JQL to fetch data from Jira."]}),s&&(0,S.jsx)(X,{setLoader:this.setLoader,jql:s,settings:a,settingsChanged:this.settingsChanged,onAddWorklog:this.addWorklogOn},t),e&&(0,S.jsx)(K,{pageSettings:this.settings,onHide:this.pageSettingsChanged})]}))}}const ee=Q;var te=s(7174),se=s(1329),ae=s(1108);const oe=function(){return"Loading... Please wait..."};const re=function(e){let{value:t,maxHours:s}=e,a=-100,o="log-indicator";return t?(a=100*t/s,a>100?a=100:a<0&&(a=0),a-=100):o+=" no-value",(0,S.jsx)("div",{className:o,children:(0,S.jsx)("div",{className:"prog-bar",style:{marginLeft:`${a}%`}})})},ie=function(e){let{lastUpdated:t,showContext:s,editWorklog:a,settings:r,setLoader:i}=e;const[l,n]=(0,o.useState)(!1),{$worklog:d,$utils:c,$userutils:h,$session:{CurrentUser:{maxHours:p}}}=(0,g.G2)("WorklogService","UtilsService","UserUtilsService","SessionService"),m=60*(p||8)*60;if((0,o.useEffect)((()=>{(async()=>{try{const e=r.dateRange;if(!e)return void n([]);const[t,s]=(0,ae.dq)(e.quickDate)||[];if(t&&(e.fromDate=t,e.toDate=s),!e.fromDate)return void n([]);null===i||void 0===i||i(!0),e.dateWise=!0;const a=await d.getWorklogs(e);a.forEach((e=>e.rowClass=c.getRowStatus(e))),n(a)}finally{null===i||void 0===i||i(!1)}})()}),[t]),!1===l)return(0,S.jsx)(oe,{});return(0,S.jsxs)(se.TT,{dataset:l,exportSheetName:"Datewise worklog",children:[(0,S.jsx)(se.Et,{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)(se.sg,{sortBy:"dateLogged",style:{width:"100px"},children:"Logged Date"}),(0,S.jsx)(se.sg,{sortBy:"totalHours",children:"Total Hours"}),(0,S.jsx)(se.sg,{sortBy:"uploaded",children:"Uploaded"}),(0,S.jsx)(se.sg,{sortBy:"pendingUpload",children:"Pending Upload"}),(0,S.jsx)(se.sg,{children:"Ticket List"})]})}),(0,S.jsx)(se.XP,{className:"no-log-bg-hl",children:e=>(0,S.jsxs)("tr",{onContextMenu:s?t=>s(t,e):void 0,className:e.rowClass,children:[(0,S.jsx)("td",{children:h.formatDate(e.dateLogged)}),(0,S.jsxs)("td",{className:"log-indi-cntr",children:[c.formatTs(e.totalHours),e.totalSecs>0&&(0,S.jsx)(re,{value:e.totalSecs,maxHours:m})]}),(0,S.jsx)("td",{children:c.formatTs(e.uploaded)}),(0,S.jsx)("td",{children:c.formatTs(e.pendingUpload)}),(0,S.jsx)("td",{children:(0,S.jsx)("ul",{className:"tags",children:e.ticketList.map(((e,t)=>{return(0,S.jsxs)("li",{children:[e.worklogId&&(0,S.jsxs)(w.Z,{className:"link badge badge-pill skin-bg-font",href:(s=e.ticketNo,o=e.worklogId,h.getWorklogUrl(s,o)),title:e.comment,children:[(0,S.jsx)("span",{className:"fa fa-clock-o"})," ",e.ticketNo,": ",e.uploaded]}),!e.worklogId&&(0,S.jsxs)("span",{className:"link badge badge-pill skin-bg-font",onClick:a?()=>a(e.id):void 0,title:e.comment,children:[(0,S.jsx)("span",{className:"fa fa-clock-o"})," ",e.ticketNo,": ",e.uploaded]})]},t);var s,o}))})})]},e.dateLogged)}),(0,S.jsx)(se.ch,{span:5,children:"No worklog exists for selected date range!"})]})};class le extends u.ZP{constructor(e){super(e,"Daywise worklog","fa-list-alt"),this.refreshData=async()=>this.setState({lastUpdated:new Date}),this.showContext=(e,t)=>{this.selectedDay=t,(0,y.pT)(e,this.contextMenu)},(0,te.f3)(this,"WorklogService","UtilsService","MessageService"),this.contextMenu=[{label:"Upload worklog",icon:"fa fa-clock-o",command:()=>this.uploadWorklog()},{label:"Add worklog",icon:"fa fa-bookmark",command:()=>this.addWorklog()}]}dateSelected(e){this.settings.dateRange=e,e.toDate&&(this.refreshData(),e.auto||this.saveSettings())}async uploadWorklog(){const e=this.selectedDay.ticketList.filter((e=>!e.worklogId)).map((e=>e.id));if(0!==e.length){this.setState({isLoading:!0});try{await this.$worklog.uploadWorklogs(e),super.performAction(u.Xk.WorklogModified)}catch(t){t.message&&this.$message.error(t.message)}finally{this.refreshData(),this.setState({isLoading:!1})}}}addWorklog(){let e=i()(this.selectedDay.dateLogged).toDate();i()(e).isSame(i()(),"day")&&(e=new Date);let t=null;this.selectedDay.pendingUpload>0&&(t=this.$utils.formatTs(this.selectedDay.pendingUpload,!0)),super.addWorklog({startTime:e,timeSpent:t,allowOverride:!!t})}executeEvent(e){e.type!==u.Xk.AddWorklog&&e.type!==u.Xk.DeletedWorklog&&e.type!==u.Xk.WorklogModified||this.refreshData()}renderCustomActions(){return(0,S.jsx)(b.Mt,{range:!0,value:this.settings.dateRange,onChange:e=>this.dateSelected(e),style:{marginRight:"35px"}})}render(){var e;const{state:{isLoading:t,lastUpdated:s}}=this;return super.renderBase((0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ie,{lastUpdated:s,settings:this.settings,showContext:this.showContext,editWorklog:this.editWorklog,setLoader:this.setLoader}),(0,S.jsx)(F,{enabled:!t&&this.context.needReload,onChange:this.refreshData},null===(e=this.context.timerEntry)||void 0===e?void 0:e.key)]}))}}le.contextType=I.a2;const ne=le;var de=s(4902),ce=s(2371);class he extends C.Z{constructor(e){super(e,"Report configurations"),this.onDone=()=>{this.$config.saveSettings("reports_UserDayWise",this.state.pageSettings),this.onHide(this.state.pageSettings)},this.setValue=(e,t)=>{let{pageSettings:s}=this.state;s[e]=t,s={...s},this.setState({pageSettings:s})},(0,te.f3)(this,"ConfigService"),this.className="no-padding";const{pageSettings:t}=e;this.state={showDialog:!0,pageSettings:{...t}},this.hideEstimate=t.hideEstimate}getFooter(){return(0,S.jsx)(b.zx,{icon:"fa fa-floppy-o",label:"Done",onClick:this.onDone})}render(){const{setValue:e,state:{pageSettings:{logFormat:t,breakupMode:s,timeZone:a,jql:o,hideEstimate:r,showCostReport:i,showProject:l,showParentSummary:n,showIssueType:d,showEpic:c,showAssignee:h,showReporter:p}}}=this;return super.renderBase((0,S.jsxs)(ce.TabView,{className:"query-tab",children:[(0,S.jsxs)(ce.TabPanel,{header:"General",leftIcon:"fa fa-cog",contentClassName:"pad-22",children:[(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Log hour format"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[(0,S.jsx)("input",{className:"form-check-input",value:t,onChange:()=>e("logFormat","1"),type:"radio",checked:"1"===t,name:"hourformat"}),"Format hours (2h 30m)"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[(0,S.jsx)("input",{className:"form-check-input",value:t,onChange:()=>e("logFormat","2"),type:"radio",checked:"2"===t,name:"hourformat"}),"Show in hours (2.5)"]})})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Log breakup"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[(0,S.jsx)("input",{className:"form-check-input",value:s,onChange:()=>e("breakupMode","1"),type:"radio",checked:"1"===s,name:"logbreakup"}),"Single entry (Sum worklog added for same ticket on same day)"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[(0,S.jsx)("input",{className:"form-check-input",value:s,onChange:()=>e("breakupMode","2"),type:"radio",checked:"2"===s,name:"logbreakup"}),"Individual entry (Display individual entry for each of the worklog)"]})})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Report timezone (experimental)"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[(0,S.jsx)("input",{className:"form-check-input",value:a,onChange:()=>e("timeZone","1"),type:"radio",checked:"1"===a,name:"timezone"}),"Use my local time zone for all users"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[(0,S.jsx)("input",{className:"form-check-input",value:a,onChange:()=>e("timeZone","2"),type:"radio",checked:"2"===a,name:"timezone"}),"Use containing groups timezone for all users"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[(0,S.jsx)("input",{className:"form-check-input",value:a,onChange:()=>e("timeZone","3"),type:"radio",checked:"3"===a,name:"timezone"}),"Use individual users timezone"]})})]})]}),(0,S.jsxs)("div",{className:"row",children:[(0,S.jsxs)("div",{className:"col-4",children:[(0,S.jsx)(b.XZ,{checked:i,onChange:t=>e("showCostReport",t),label:"Show cost report"}),!!this.showCostReport!==!!i&&(0,S.jsxs)("span",{className:"pad-l-15",children:[" ( ",(0,S.jsx)("i",{className:"fa fa-exclamation-triangle",title:"Change will take effect only after report is refreshed"})," )"]})]}),(0,S.jsx)("div",{className:"col-4",children:(0,S.jsx)(b.XZ,{checked:l,onChange:t=>e("showProject",t),label:"Show Project details"})}),(0,S.jsx)("div",{className:"col-4",children:(0,S.jsx)(b.XZ,{checked:n,onChange:t=>e("showParentSummary",t),label:"Show Parent ticket"})}),(0,S.jsx)("div",{className:"col-4",children:(0,S.jsx)(b.XZ,{checked:d,onChange:t=>e("showIssueType",t),label:"Show Issue Type"})}),(0,S.jsx)("div",{className:"col-4",children:(0,S.jsx)(b.XZ,{checked:c,onChange:t=>e("showEpic",t),label:"Show Epic"})}),(0,S.jsx)("div",{className:"col-4",children:(0,S.jsx)(b.XZ,{checked:h,onChange:t=>e("showAssignee",t),label:"Show Assignee"})}),(0,S.jsx)("div",{className:"col-4",children:(0,S.jsx)(b.XZ,{checked:p,onChange:t=>e("showReporter",t),label:"Show Reporter"})}),(0,S.jsxs)("div",{className:"col-12",children:[(0,S.jsx)(b.XZ,{checked:r,onChange:t=>e("hideEstimate",t),label:"Hide estimate related fields"}),!!this.hideEstimate!==!!r&&(0,S.jsxs)("span",{className:"pad-l-15",children:[" ( ",(0,S.jsx)("i",{className:"fa fa-exclamation-triangle",title:"Change will take effect only after report is refreshed"})," )"]})]})]})]}),(0,S.jsxs)(ce.TabPanel,{header:"JQL Filter",leftIcon:"fa fa-filter",children:[(0,S.jsx)(b.zC,{multiline:!0,value:o,onChange:t=>e("jql",t),style:{width:"100%",height:411},placeholder:"Provide the additional JQL filters to be applied while fetching data.",defaultValue:""}),(0,S.jsxs)("span",{children:[(0,S.jsx)("strong",{children:"Note:"})," Date range and user list filter will be added automatically."]})]})]}))}}const pe=he,me=["-originalestimate","-totalLogged","-remainingestimate","-estVariance"];class ue extends o.PureComponent{constructor(e){super(e),this.settingsChanged=(e,t)=>{this.props.onChange(e,t)},this.setPropsInClass(e),this.state=this.getNewState(e),this.state.groupBy=[]}UNSAFE_componentWillReceiveProps(e){this.updateData(e)}updateData(e){this.data===e.flatData&&this.pageSettings===e.pageSettings||(this.setPropsInClass(e),this.setState(this.getNewState(e)))}getNewState(e){return{columns:this.getColumnSettings(e)}}setPropsInClass(e){this.data=e.flatData,this.pageSettings=this.props.pageSettings}getColumnSettings(e){var t;const{formatDateTime:s,convertSecs:a}=e,o="1"===(null===(t=e.pageSettings)||void 0===t?void 0:t.logFormat)?"string":"number";return[{field:"groupName",displayText:"Group Name",type:"string"},{field:"projectName",displayText:"Project Name",type:"string"},{field:"issueType",displayText:"Issue Type",type:"string"},{field:"epicDisplay",displayText:"Epic",type:"string",format:(e,t)=>this.formatTicket(e,t.epicUrl)},{field:"parent",displayText:"Parent",type:"string",format:(e,t)=>this.formatTicket(e,t.parentUrl)},{field:"ticketNo",displayText:"Ticket No",type:"string",format:(e,t)=>this.formatTicket(e,t.ticketUrl)},{field:"statusName",displayText:"Status",type:"string"},{field:"summary",displayText:"Summary",type:"string"},{field:"logTime",displayText:"Log Date & Time",type:"datetime",format:s},{field:"userDisplay",displayText:"Log user",type:"string"},{field:"assignee",displayText:"Assignee",type:"string"},{field:"reporter",displayText:"Reporter",type:"string"},{field:"timeSpent",displayText:"Hr. Spent",type:o,format:a},{field:"originalestimate",displayText:"Ori. Estm.",type:o,format:a},{field:"totalLogged",displayText:"Total Worklogs",type:o,format:a},{field:"remainingestimate",displayText:"Rem. Estm.",type:o,format:a},{field:"estVariance",displayText:"Estm. Variance",type:"string",format:e=>(e>0?"+":"")+a(e)},{field:"comment",displayText:"Comment"}]}formatTicket(e,t){return e&&(0,S.jsx)(w.Z,{href:t,className:"link",children:e})}render(){const{props:{flatData:e,pageSettings:{hideEstimate:t,flatTableSettings:{groupBy:s,groupFoldable:a,displayColumns:o,sortField:r,isDesc:i}={displayColumns:t?me:null}}={}},state:{columns:l}}=this;return(0,S.jsx)(_.Z,{className:"flat-data-grid",dataset:e,exportSheetName:"Flat Worklogs",columns:l,allowSorting:!0,onChange:this.settingsChanged,displayColumns:o,groupBy:s,groupFoldable:a,sortField:r,isDesc:i,noRowsMessage:"No worklog details available"})}}const ge=ue;class fe extends o.PureComponent{constructor(e){super(e),this.state={groupedData:this.generateGroupData(e)}}UNSAFE_componentWillReceiveProps(e){this.setState({groupedData:this.generateGroupData(e)})}getCssClass(e,t){if(t=t>0?t:0,e.isHoliday)return t?"log-high":"col-holiday";{const e=this.props.maxSecsPerDay;if(t===e)return"log-good";if(t<e)return"log-less";if(t>e)return"log-high"}}generateGroupData(e){const{rawData:t,dates:s,pageSettings:a,groups:o,getTicketUrl:r}=e,l=parseInt(a.timeZone),n=o.map((e=>{const a={name:e.name,total:{},totalCost:{},grandTotal:0,grandTotalCost:0,users:null};a.users=e.users.map((a=>{let o=null;2===l?o=e.timeZone:3===l&&(o=a.timeZone||e.timeZone),"GRP_TZ"===o&&(o=e.timeZone);const n={name:(0,v.vW)(a),displayName:a.displayName,emailAddress:a.emailAddress,timeZone:o,imageUrl:a.avatarUrls["48x48"]||a.avatarUrls["32x32"],profileUrl:a.self,costPerHour:a.costPerHour,tickets:null,total:{},totalCost:{},logClass:{},grandTotal:0,grandTotalCost:0},d=t.first((e=>e.userName===(0,v.vW)(a,!0)))||{};d.isCurrentUser&&(n.isCurrentUser=!0);const c=d.logData||[];n.tickets=c.groupBy((e=>e.ticketNo)).map((e=>{const t=e.values,s=t.first(),l={},n={ticketNo:e.key,parent:s.parent,parentUrl:s.parent?r(s.parent):null,parentSummary:s.parentSummary,projectKey:s.projectKey,projectName:s.projectName,assignee:s.assignee,reporter:s.reporter,epicDisplay:s.epicDisplay,epicUrl:s.epicUrl,issueType:s.issueType,statusName:s.statusName,summary:s.summary,originalestimate:s.originalestimate,remainingestimate:s.remainingestimate,totalLogged:s.totalLogged,estVariance:s.estVariance,url:s.url,logs:l,totalHours:0,totalCost:0};let d=0;return t.forEach((e=>{let t=e.logTime;o&&(t=i()(i()(t).tz(o).format("YYYY-MM-DD HH:mm:ss")).toDate());const s=t.format("yyyyMMdd");let r=l[s];r||(r=[],l[s]=r),r.push({logTime:t,totalHours:e.totalHours,totalCost:(0,v.qN)(e.totalHours,a.costPerHour),comment:e.comment}),d+=e.totalHours})),n.totalHours=d,n.totalCost=(0,v.qN)(d,a.costPerHour),n}));const h=n.logClass,p=n.total,m=n.totalCost;let u=0;return s.forEach((e=>{const t=n.tickets.sum((t=>{const s=t.logs[e.prop];return s?s.sum((e=>e.totalHours)):0}));t>0&&(p[e.prop]=t,m[e.prop]=(0,v.qN)(t,a.costPerHour),u+=t),h[e.prop]=this.getCssClass(e,t)})),n.grandTotal=u,n.grandTotalCost=(0,v.qN)(u,a.costPerHour),n}));const o=a.total,n=a.totalCost;let d=0,c=0;return s.forEach((e=>{const t=a.users.sum((t=>t.total[e.prop]||0));t>0&&(o[e.prop]=t,d+=t);const s=a.users.sum((t=>t.totalCost[e.prop]||0));s>0&&(n[e.prop]=s,c+=s)})),a.grandTotal=d,a.grandTotalCost=c,a}));let d=0,c=0;const h={},p={};return s.forEach((e=>{const t=n.sum((t=>t.total[e.prop]||0));t>0&&(h[e.prop]=t,d+=t);const s=n.sum((t=>t.totalCost[e.prop]||0));s>0&&(p[e.prop]=s,c+=s)})),n.grandTotal=d,n.grandTotalCost=c,n.total=h,n.totalCost=p,n}render(){const{state:{groupedData:e},props:{exportSheetName:t,months:s,dates:a,convertSecs:o,formatTime:r,breakupMode:i,pageSettings:l,addWorklog:n,costView:d}}=this,c="2"===(null===l||void 0===l?void 0:l.logFormat)?"float":void 0,{showProject:h,showParentSummary:p,showIssueType:m,showEpic:u,showAssignee:g,showReporter:f}=l||{},x=1+(h?1:0)+(p?1:0)+(m?1:0)+(u?1:0)+(g?1:0)+(f?1:0);return(0,S.jsxs)(se.TT,{className:"table-bordered",exportSheetName:t,children:[(0,S.jsxs)(se.Et,{children:[(0,S.jsxs)("tr",{className:"data-center pad-min auto-wrap",children:[(0,S.jsx)("th",{style:{minWidth:260+120*x},rowSpan:x>1?1:2,colSpan:x,children:"User Details"}),s.map(((e,t)=>(0,S.jsx)("th",{style:{minWidth:35},colSpan:e.days,children:e.monthName},t))),!d&&(0,S.jsx)("th",{style:{minWidth:50,maxWidth:100},rowSpan:2,children:"Total Hours"}),d&&(0,S.jsx)("th",{style:{minWidth:50,maxWidth:100},rowSpan:2,children:"Total Cost"})]}),(0,S.jsxs)("tr",{className:"pad-min auto-wrap",children:[x>1&&(0,S.jsx)("th",{style:{minWidth:380},children:"Issue details"}),!!h&&(0,S.jsx)("th",{children:"Project"}),!!p&&(0,S.jsx)("th",{children:"Parent Summary"}),!!m&&(0,S.jsx)("th",{children:"Issuetype"}),!!u&&(0,S.jsx)("th",{children:"Epic"}),!!g&&(0,S.jsx)("th",{children:"Assignee"}),!!f&&(0,S.jsx)("th",{children:"Reporter"}),a.map(((e,t)=>(0,S.jsx)("th",{"data-test-id":e.prop,style:{minWidth:35},children:e.display},t)))]})]}),(0,S.jsxs)(se.XP,{children:[e.map(((e,t)=>(0,S.jsx)(ye,{colSpan:x,group:e,dates:a,addWorklog:n,costView:d,convertSecs:o,timeExportFormat:c,formatTime:r,breakupMode:i,pageSettings:l},t))),!d&&(0,S.jsxs)("tr",{className:"grouped-row right auto-wrap",children:[(0,S.jsxs)("td",{colSpan:x,children:["Grand Total ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})]}),a.map(((t,s)=>(0,S.jsx)("td",{exportType:c,children:o(e.total[t.prop])},s))),(0,S.jsx)("td",{exportType:c,children:o(e.grandTotal)})]}),d&&(0,S.jsxs)("tr",{className:"grouped-row right auto-wrap",children:[(0,S.jsxs)("td",{colSpan:x,children:["Grand Total ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})]}),a.map(((t,s)=>(0,S.jsx)("td",{children:e.totalCost[t.prop]},s))),(0,S.jsx)("td",{children:e.grandTotalCost})]})]})]})}}const xe=fe;class ye extends o.PureComponent{constructor(){super(...arguments),this.state={},this.toggleDisplay=()=>this.setState({hidden:!this.state.hidden})}render(){const{props:{group:e,dates:t,convertSecs:s,formatTime:a,breakupMode:o,pageSettings:r,addWorklog:i,timeExportFormat:l,costView:n,colSpan:d},state:{hidden:c}}=this;return(0,S.jsxs)(S.Fragment,{children:[!c&&(0,S.jsx)("tr",{className:"grouped-row left",title:"Click to hide user details",children:(0,S.jsxs)("td",{colSpan:t.length+2,onClick:this.toggleDisplay,children:[(0,S.jsx)("i",{className:"pull-left drill-down fa fa-chevron-circle-down"}),e.name]})}),!c&&e.users.map(((e,c)=>(0,S.jsx)(ke,{colSpan:d,user:e,dates:t,breakupMode:o,costView:n,addWorklog:i,timeExportFormat:l,convertSecs:s,formatTime:a,pageSettings:r},c))),(0,S.jsxs)("tr",{className:"grouped-row right auto-wrap",onClick:c?this.toggleDisplay:null,children:[(0,S.jsxs)("td",{colSpan:d,children:[c&&(0,S.jsxs)("div",{children:[(0,S.jsx)("i",{className:"pull-left drill-down fa fa-chevron-circle-right",title:"Click to show user details"}),(0,S.jsx)("span",{className:"pull-left",children:e.name}),(0,S.jsxs)("span",{className:"pull-right",children:["Total ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})]})]}),!c&&(0,S.jsxs)("div",{children:[e.name," ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})," Total ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})]})]}),!n&&t.map(((t,a)=>(0,S.jsx)("td",{exportType:l,children:s(e.total[t.prop])},a))),!n&&(0,S.jsx)("td",{exportType:l,children:s(e.grandTotal)}),n&&t.map(((t,s)=>(0,S.jsx)("td",{children:e.totalCost[t.prop]},s))),n&&(0,S.jsx)("td",{children:e.grandTotalCost})]})]})}}class ke extends o.PureComponent{constructor(){super(...arguments),this.state={},this.getComments=(e,t)=>e&&0!==e.length?e.map((e=>`${this.props.formatTime(e.logTime)}(${this.props.convertSecs(e.totalHours)})${t?`, Cost: ${e.totalCost}`:""} - ${e.comment}`)).join(";\n"):"",this.toggleDisplay=()=>this.setState({expanded:!this.state.expanded}),this.addWorklog=(e,t)=>{const{user:s,addWorklog:a}=this.props,{date:o,prop:r}=t;a(s,e,o,s.total[r])}}getTotalTime(e){return e&&0!==e.length?e.sum((e=>e.totalHours)):""}getTotalCost(e){return e&&0!==e.length?e.sum((e=>e.totalCost)):""}getLogEntries(e){if(Array.isArray(e)&&e.length>0){const t=e.length>1?";":"";return e.map(((e,s)=>(0,S.jsx)("span",{title:`${this.props.formatTime(e.logTime)} - ${e.comment}`,children:this.props.convertSecs(e.totalHours)+t},s)))}}render(){const{props:{user:e,dates:t,convertSecs:s,breakupMode:a,pageSettings:{hideEstimate:o,showProject:r,showParentSummary:i,showIssueType:l,showEpic:n,showAssignee:d,showReporter:c},timeExportFormat:h,costView:p,colSpan:m},state:{expanded:u}}=this;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("tr",{className:"pointer auto-wrap",onClick:this.toggleDisplay,"data-current-user":e.isCurrentUser?"1":"0","data-row-id":"user",children:[(0,S.jsx)("td",{className:"data-left",colSpan:m,children:(0,S.jsxs)("div",{className:"user-info",style:{paddingLeft:0},children:[(0,S.jsx)("i",{className:"pull-left drill-down fa "+(u?"fa-chevron-circle-down":"fa-chevron-circle-right"),title:"Click to toggle ticket details"}),(0,S.jsx)("img",{src:e.imageUrl,height:40,width:40,className:"pull-left",alt:e.displayName}),(0,S.jsx)("span",{className:"name",children:e.displayName}),(0,S.jsxs)("span",{className:"email",children:["(",e.emailAddress||e.name,e.timeZone&&(0,S.jsxs)("span",{children:[", time zone: ",e.timeZone]}),")"]})]})}),!p&&t.map(((t,a)=>(0,S.jsxs)("td",{className:`${e.logClass[t.prop]} day-wl-block`,exportType:h,"data-test-id":t.prop,children:[e.isCurrentUser&&(0,S.jsx)("span",{className:"fa fa-clock-o add-wl",title:"Click to add worklog",onClick:()=>this.addWorklog(null,t)}),s(e.total[t.prop])]},a))),!p&&(0,S.jsx)("td",{exportType:h,"data-test-id":"total",children:s(e.grandTotal)}),p&&t.map(((t,s)=>(0,S.jsx)("td",{className:`${e.logClass[t.prop]} day-wl-block`,"data-test-id":t.prop,children:e.totalCost[t.prop]},s))),p&&(0,S.jsx)("td",{"data-test-id":"total",children:e.grandTotalCost})]}),u&&e.tickets.map(((m,u)=>{const g=s(m.originalestimate),f=s(m.remainingestimate),x=s(m.totalLogged)||0,y=(m.estVariance>0?"+":"")+(s(m.estVariance)||(m.originalestimate>0?0:"NA")),k=`Original Estimate: ${g||0}\nRemaining: ${f||0}\nTotal Logged: ${x}\nEstimate Variance: ${y}`;return(0,S.jsxs)("tr",{className:"auto-wrap","data-row-id":"ticket","data-current-user":e.isCurrentUser?"1":"0","data-test-id":m.ticketNo,children:[(0,S.jsxs)("td",{className:"data-left",children:[!i&&m.parent&&(0,S.jsxs)(w.Z,{href:m.parentUrl,className:"link",children:[m.parent," - "]}),(0,S.jsx)(w.Z,{href:m.url,className:"link",children:m.ticketNo})," -",(0,S.jsx)("span",{children:m.summary}),(0,S.jsxs)("strong",{children:[" (",m.statusName,")"]}),!o&&!(!g&&!f)&&(0,S.jsxs)("span",{className:"estimate",title:k,children:["(est: ",g||0," / rem: ",f||0," / log: ",x," / var: ",y,")"]})]}),!!r&&(0,S.jsxs)("td",{children:[m.projectKey," - ",m.projectName]}),!!i&&(0,S.jsxs)("td",{children:[m.parent&&(0,S.jsx)(w.Z,{href:m.parentUrl,className:"link",children:m.parent})," - ",m.parentSummary]}),!!l&&(0,S.jsx)("td",{children:m.issueType}),!!n&&(0,S.jsx)("td",{children:m.epicDisplay&&(0,S.jsx)(w.Z,{href:m.epicUrl,className:"link",children:m.epicDisplay})}),!!d&&(0,S.jsx)("td",{children:m.assignee}),!!c&&(0,S.jsx)("td",{children:m.reporter}),!p&&t.map(((t,o)=>(0,S.jsxs)("td",{className:"day-wl-block",exportType:h,"data-test-id":t.prop,children:[e.isCurrentUser&&(0,S.jsx)("span",{className:"fa fa-clock-o add-wl",title:"Click to add worklog",onClick:()=>this.addWorklog(m.ticketNo,t)}),"2"!==a&&(0,S.jsx)("span",{title:this.getComments(m.logs[t.prop]),children:s(this.getTotalTime(m.logs[t.prop]))}),"2"===a&&(0,S.jsxs)("div",{children:[" ",this.getLogEntries(m.logs[t.prop])]})]},o))),!p&&(0,S.jsx)("td",{exportType:h,"data-test-id":"total",children:s(m.totalHours)}),p&&t.map(((e,t)=>(0,S.jsx)("td",{className:"day-wl-block","data-test-id":e.prop,children:(0,S.jsx)("span",{title:this.getComments(m.logs[e.prop],p),children:this.getTotalCost(m.logs[e.prop])})},t))),p&&(0,S.jsx)("td",{"data-test-id":"total",children:m.totalCost})]},u)}))]})}}class je extends o.PureComponent{render(){return(0,S.jsxs)("div",{className:"pad-15",children:[(0,S.jsx)("h2",{children:"DEPRECATED"}),(0,S.jsxs)("ul",{children:[(0,S.jsx)("li",{children:"This Old worklog report is depricated. Please use new worklog report"}),(0,S.jsx)("li",{children:"This report would be removed over time after New Worklog report is stable"}),(0,S.jsx)("li",{children:"No new enhancments / bug fixes would be provided in this report"}),(0,S.jsx)("li",{children:"If you face any issue with new Worklog report, please report that issue so that it is resolved before this report is removed"})]})]})}}const ve=je;class we extends o.PureComponent{constructor(e){super(e);const{groups:t,flatData:s}=e;this.state=this.getGroupedData(t,s)}getGroupedData(e,t){const s=[],a={},o=t.groupBy((e=>e.username)).reduce(((e,t)=>(e[t.key]=t.values,e)),{});t.groupBy((e=>({key:e.projectKey,name:e.projectName}))).sortBy((e=>e.key.key)).forEach((e=>{let{key:t,values:o}=e;s.push(t),a[t.key]=o,t.issueTypes=o.distinct((e=>e.issueType))}));const r=e.map((e=>{const{name:t,users:r}=e,i={grandTotal:0,grandTotalCost:0,projects:{}},l={name:t,overallTotal:i};return l.users=r.map((e=>{const t=(0,v.vW)(e),{emailAddress:r,displayName:l}=e,n={name:t,emailAddress:r,displayName:l};n.projects=s.reduce(((s,o)=>{const r=i.projects[o.key]||{total:0,totalCost:0};i.projects[o.key]=r;const l=a[o.key];if(l){const a=l.filter((e=>e.username===t));if(a.length){const t=a.groupBy((e=>e.issueType)).reduce(((t,s)=>{const a=s.values.sum((e=>e.timeSpent))||0,o=(0,v.qN)(a,e.costPerHour);return t[s.key]={total:a,totalCost:o,logs:s.values},r[s.key]=(r[s.key]||0)+a,r[`${s.key}_Cost`]=(r[`${s.key}_Cost`]||0)+o,t}),{}),i=a.sum((e=>e.timeSpent));t.grandTotal={total:i,totalCost:(0,v.qN)(i,e.costPerHour),logs:a},r.total+=t.grandTotal.total||0,r.totalCost+=t.grandTotal.totalCost||0,s[o.key]=t}}return s}),{});const d=o[t]||[],c=d.sum((e=>e.timeSpent));return n.grandTotal={total:c,totalCost:(0,v.qN)(c,e.costPerHour),logs:d},i.grandTotal+=n.grandTotal.total,i.grandTotalCost+=n.grandTotal.totalCost,n})),l})),i=r.reduce(((e,t)=>{const{overallTotal:{grandTotal:a,grandTotalCost:o,projects:r}}=t;return e.grandTotal=(e.grandTotal||0)+a,e.grandTotalCost=(e.grandTotalCost||0)+o,s.forEach((t=>{const s=r[t.key]||{},a=e[t.key]||{total:0,totalCost:0};e[t.key]=a,a.total+=s.total||0,a.totalCost+=s.totalCost||0,t.issueTypes.forEach((e=>{a[e]=(a[e]||0)+(s[e]||0),a[`${e}_Cost`]=(a[`${e}_Cost`]||0)+(s[`${e}_Cost`]||0)}))})),e}),{grandTotal:0,grandTotalCost:0});return{projects:s,groupedData:r,grandTotal:i}}render(){const{props:{exportSheetName:e,convertSecs:t,costView:s},state:{projects:a,groupedData:r,grandTotal:i}}=this;return(0,S.jsxs)(se.TT,{className:"table-bordered",dataset:r,exportSheetName:e,children:[(0,S.jsxs)(se.Et,{children:[(0,S.jsxs)(se.lE,{children:[(0,S.jsx)(se.sg,{rowSpan:2,children:"Group Name"}),(0,S.jsx)(se.sg,{rowSpan:2,children:"User Name"}),a.map((e=>(0,S.jsx)(se.sg,{colSpan:e.issueTypes.length+1,children:e.name},e.key))),(0,S.jsx)(se.sg,{rowSpan:2,children:"Grand Total"})]}),(0,S.jsx)(se.lE,{children:a.map(((e,t)=>(0,S.jsxs)(o.Fragment,{children:[e.issueTypes.map(((e,t)=>(0,S.jsx)(se.sg,{children:e},t))),(0,S.jsx)(se.sg,{children:"Total"})]},t)))})]}),(0,S.jsx)(se.XP,{children:(e,r)=>(0,S.jsxs)(o.Fragment,{children:[e.users.map(((r,i)=>(0,S.jsxs)("tr",{children:[0===i&&(0,S.jsx)("td",{rowSpan:e.users.length+1,children:e.name}),(0,S.jsx)("td",{children:r.displayName}),a.map(((e,a)=>{var i,l,n;const d=r.projects[e.key]||{};return(0,S.jsxs)(o.Fragment,{children:[!s&&e.issueTypes.map(((e,s)=>{const a=d[e];return(0,S.jsx)("td",{className:"data-center",exportType:"float",children:t(null===a||void 0===a?void 0:a.total)},s)})),!s&&(0,S.jsx)("td",{className:"strong data-center",exportType:"float",children:t(null===(i=d.grandTotal)||void 0===i?void 0:i.total)}),s&&e.issueTypes.map(((e,s)=>{const a=d[e];return(0,S.jsx)("td",{className:"data-center",exportType:"float",title:t(null===a||void 0===a?void 0:a.total),children:null===a||void 0===a?void 0:a.totalCost},s)})),s&&(0,S.jsx)("td",{className:"strong data-center",exportType:"float",title:t(null===(l=d.grandTotal)||void 0===l?void 0:l.total),children:null===(n=d.grandTotal)||void 0===n?void 0:n.totalCost})]},a)})),!s&&(0,S.jsx)("td",{className:"strong data-center",exportType:"float",children:t(r.grandTotal.total)}),s&&(0,S.jsx)("td",{className:"strong data-center",exportType:"float",title:t(r.grandTotal.total),children:r.grandTotal.totalCost})]},i))),(0,S.jsxs)("tr",{className:"strong data-center",children:[(0,S.jsxs)("td",{className:"data-right",children:["Group Total ",(0,S.jsx)("span",{className:"fa fa-arrow-right"})]}),a.map(((a,r)=>{const i=e.overallTotal.projects[a.key]||{};return s?(0,S.jsxs)(o.Fragment,{children:[a.issueTypes.map(((e,s)=>(0,S.jsx)("td",{exportType:"float",title:t(i[e]),children:i[`${e}_Cost`]},s))),(0,S.jsx)("td",{exportType:"float",title:t(i.total),children:i.totalCost})]},r):(0,S.jsxs)(o.Fragment,{children:[a.issueTypes.map(((e,s)=>(0,S.jsx)("td",{exportType:"float",children:t(i[e])},s))),(0,S.jsx)("td",{exportType:"float",children:t(i.total)})]},r)})),!s&&(0,S.jsx)("td",{exportType:"float",children:t(e.overallTotal.grandTotal)}),s&&(0,S.jsx)("td",{exportType:"float",title:t(e.overallTotal.grandTotal),children:e.overallTotal.grandTotalCost})]})]},r)}),(0,S.jsx)("tfoot",{children:(0,S.jsxs)("tr",{className:"strong data-center",children:[(0,S.jsxs)("td",{colSpan:2,className:"data-right",children:["Grand total ",(0,S.jsx)("span",{className:"fa fa-arrow-right"})]}),!s&&a.map(((e,s)=>(0,S.jsxs)(o.Fragment,{children:[e.issueTypes.map(((s,a)=>(0,S.jsx)("td",{exportType:"float",children:t(i[e.key][s])},a))),(0,S.jsx)("td",{exportType:"float",children:t(i[e.key].total)})]},s))),!s&&(0,S.jsx)("td",{exportType:"float",children:t(i.grandTotal)}),s&&a.map(((e,s)=>(0,S.jsxs)(o.Fragment,{children:[e.issueTypes.map(((s,a)=>(0,S.jsx)("td",{exportType:"float",title:t(i[e.key][s]),children:i[e.key][`${s}_Cost`]},a))),(0,S.jsx)("td",{exportType:"float",title:t(i[e.key].total),children:i[e.key].totalCost})]},s))),s&&(0,S.jsx)("td",{exportType:"float",title:t(i.grandTotal),children:i.grandTotalCost})]})}),(0,S.jsx)(se.ch,{span:11,children:"No worklog details available"})]})}}const Se=we;class Ne extends u.ZP{constructor(e){super(e,"Worklog Report","fa-list-alt"),this.dateSelected=e=>{if(!e)return;const{quickDate:t,fromDate:s,toDate:a}=e;if(s&&a){let{pageSettings:s}=this.state;s=t?{...s,dateRange:{quickDate:t}}:{...s,dateRange:e},this.setState({dateRange:e,pageSettings:s},this.refreshData),this.saveSettings(s)}},this.refreshData=()=>{const{groups:e}=this.state;if(!e||0===e.length)return void this.$message.warning("User list need to be added before generating report","Missing input");this.userList=e.union((e=>(e.users.forEach((t=>t.groupName=e.name)),e.users)));const t={userList:this.userList.map((e=>(0,v.vW)(e,!0))),fromDate:this.state.dateRange.fromDate,toDate:this.state.dateRange.toDate};this.setState({isLoading:!0}),this.getDayWiseReportData(t).then((e=>{this.$analytics.trackEvent("Worklog report viewed",E.Jk.UserActions),this.rawData=e,this.generateFlatData(e),this.setState({isLoading:!1})}),(e=>(this.setState({isLoading:!1}),Promise.reject(e))))},this.showGroupsPopup=()=>this.setState({showGroupsPopup:!0}),this.showSettings=()=>this.setState({showSettings:!0}),this.groupsChanged=e=>{const t={showGroupsPopup:!1};e&&Array.isArray(e)&&(t.groups=e),this.setState(t)},this.settingsChanged=e=>{e||(e=this.state.pageSettings),this.setState({showSettings:!1,pageSettings:e})},this.groupSettingsChanged=e=>{const{groupBy:t,groupFoldable:s,displayColumns:a,sortField:o,isDesc:r}=e;let{pageSettings:i}=this.state;i={...i,flatTableSettings:{groupBy:t,groupFoldable:s,displayColumns:a,sortField:o,isDesc:r}},this.saveSettings(i)},this.addWorklog=(e,t,s,a)=>{let o=(this.maxSecsPerDay||0)-(a||0);o<60&&(o="01:00"),i()(s).isSame(i()(),"day")&&(s=new Date),this.worklogItem={ticketNo:t,dateStarted:s,timeSpent:o},this.setState({showWorklogPopup:!0})},this.worklogAdded=e=>{let{added:{sourceObject:t}}=e;console.log("Worklog added: ",t)},this.hideWorklog=()=>{this.worklogItem=null,this.setState({showWorklogPopup:!1})},this.convertSecs=e=>e||0===e?this.$utils.convertSecs(e,{format:"1"===this.state.pageSettings.logFormat}):e,this.formatTime=e=>this.$userutils.formatTime(e),this.formatDateTime=e=>this.$userutils.formatDateTime(e),(0,te.f3)(this,"SessionService","CacheService","UtilsService","UserUtilsService","JiraService","MessageService","ConfigService","UserGroupService","AnalyticsService");const t=this.$session.pageSettings.reports_UserDayWise;t.timeZone||(t.timeZone="1");let{dateRange:s}=t;if(s={...s||{}},s.quickDate){const[e,t]=(0,ae.dq)(s.quickDate);s.fromDate=e,s.toDate=t}this.state.dateRange=s,this.state.pageSettings=t;const{maxHours:a,epicNameField:o,name:r}=this.$session.CurrentUser;this.currentUserName=r.toLowerCase(),this.maxSecsPerDay=60*(a||8)*60,this.epicNameField=(o||{}).id}componentDidMount(){super.componentDidMount(),this.$usergroup.getUserGroups().then((e=>this.setState({groups:e})))}getDayWiseReportData(e){const t=e.userList.distinct(),s=i()(e.fromDate).startOf("day"),a=i()(e.toDate).endOf("day"),o=s.toDate(),r=a.toDate(),l=this.getDateArray(o,r);this.dates=l.map((e=>({prop:e.format("yyyyMMdd"),display:e.format("DDD, dd"),date:e,isHoliday:this.$userutils.isHoliday(e)}))),this.months=l.groupBy((e=>e.format("MMM, yyyy"))).map((e=>({monthName:e.key,days:e.values.length})));const n=this.state.pageSettings.hideEstimate;let d=(this.state.pageSettings.jql||"").trim();d&&(d=` AND (${d})`);const c=`worklogAuthor in ("${t.join('","')}") and worklogDate >= '${s.clone().add(-1,"days").format("YYYY-MM-DD")}' and worklogDate < '${a.clone().add(1,"days").format("YYYY-MM-DD")}'${d}`,h=["summary","worklog","issuetype","parent","project","status","assignee","reporter"];n||(h.push("timeoriginalestimate"),h.push("timeestimate"));const p=this.epicNameField;return p&&h.push(p),this.$jira.searchTickets(c,h,0,{worklogStartDate:s.toDate(),worklogEndDate:a.toDate()}).then((e=>{const s=t.map((e=>{const t={logData:[],userName:e.toLowerCase()};return t.userName===this.currentUserName&&(t.isCurrentUser=!0),t})),a={};for(let t=0;t<s.length;t++){const e=s[t];a[e.userName]=e}for(let t=0;t<e.length;t++){const s=e[t],g=s.fields||{},f=(g.worklog||{}).worklogs||[],x=f.sum((e=>e.timeSpentSeconds)),y=g.timeoriginalestimate||0,k=g.timeestimate||0,j=y>0?k+x-y:0;for(let e=0;e<f.length;e++){const t=f[e],w=i()(t.started).toDate(),S=i()(t.started).startOf("day").toDate();if(S.getTime()>=o.getTime()&&S.getTime()<=r.getTime()){const e=a[(0,v.vW)(t.author,!0)];if(e){var l,n,d,c,h,m,u;const a={ticketNo:s.key,epicDisplay:null,epicUrl:null,url:this.$userutils.getTicketUrl(s.key),issueType:null===(l=g.issuetype)||void 0===l?void 0:l.name,parent:null===(n=g.parent)||void 0===n?void 0:n.key,parentSummary:null===(d=g.parent)||void 0===d||null===(c=d.fields)||void 0===c?void 0:c.summary,assignee:null===(h=g.assignee)||void 0===h?void 0:h.displayName,reporter:null===(m=g.reporter)||void 0===m?void 0:m.displayName,summary:g.summary,originalestimate:y,remainingestimate:k,totalLogged:x,estVariance:j,logTime:w,comment:t.comment,projectName:g.project.name,statusName:null===(u=g.status)||void 0===u?void 0:u.name,projectKey:g.project.key,totalHours:t.timeSpentSeconds};if(p){a.epicDisplay=g[p];const e=a.ticketNo.split("-")[0];a.epicDisplay&&0===a.epicDisplay.indexOf(`${e}-`)&&(a.epicUrl=this.$userutils.getTicketUrl(a.epicDisplay))}e.logData.push(a)}}}}for(let t=0;t<s.length;t++){const e=s[t];e.totalHours=e.logData.sum((e=>e.totalHours))}return s}))}generateFlatData(e){this.flatData=this.state.groups.union((t=>{const s=t.name;return t.users.union((t=>{const a=t.displayName;return e.first((e=>e.userName===(0,v.vW)(t,!0))).logData.map((e=>({groupName:s,username:(0,v.vW)(t),userDisplay:a,assignee:e.assignee,reporter:e.reporter,parent:e.parent,parentSummary:e.parentSummary,parentUrl:e.parent?this.$userutils.getTicketUrl(e.parent):null,epicDisplay:e.epicDisplay,epicUrl:e.epicUrl,ticketNo:e.ticketNo,ticketUrl:e.url,issueType:e.issueType,summary:e.summary,projectKey:e.projectKey,projectName:e.projectName,statusName:e.statusName,logTime:e.logTime,timeSpent:e.totalHours,originalestimate:e.originalestimate,remainingestimate:e.remainingestimate,totalLogged:e.totalLogged,estVariance:e.estVariance,comment:e.comment})))}))}))}getDateArray(e,t){const s=[];let a=new Date(e);for(;a<=t;)s.push(new Date(a)),a=a.addDays(1);return s}renderCustomActions(){const{state:{dateRange:e}}=this;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.Mt,{value:e,range:!0,onChange:this.dateSelected,style:{marginRight:"35px"}}),(0,S.jsx)(b.zx,{icon:"fa fa-users",onClick:this.showGroupsPopup,title:"Add users / groups to report"}),(0,S.jsx)(b.zx,{icon:"fa fa-cogs",onClick:this.showSettings,title:"Show settings"})]})}saveSettings(e){this.$config.saveSettings("reports_UserDayWise",e),this.settingsChanged(e)}render(){const{months:e,dates:t,convertSecs:s,formatTime:a,formatDateTime:o,rawData:r,flatData:i=[],state:{isLoading:l,showGroupsPopup:n,showWorklogPopup:d,showSettings:c,groups:h,pageSettings:p={}}}=this,{breakupMode:m,showCostReport:u}=p,g=`${p._uniqueId}_${i._uniqueId}`,f=(0,S.jsx)(ce.TabPanel,{header:"Grouped - [User daywise]",contentClassName:"no-padding",children:r&&(0,S.jsx)(xe,{exportSheetName:"Grouped - [User daywise]",rawData:r,groups:h,dates:t,months:e,pageSettings:p,convertSecs:s,formatTime:a,breakupMode:m,getTicketUrl:this.$userutils.getTicketUrl,maxSecsPerDay:this.maxSecsPerDay,addWorklog:this.addWorklog})}),x=(0,S.jsx)(ce.TabPanel,{header:"Summary - [User project wise]",children:i&&(0,S.jsx)(Se,{exportSheetName:"Summary - [User project wise]",groups:h,flatData:i,formatDateTime:o,convertSecs:s},g)}),y=(0,S.jsx)(ce.TabPanel,{header:"Flat (Groupable)",children:i&&(0,S.jsx)(ge,{flatData:i,formatDateTime:o,convertSecs:s,pageSettings:p,onChange:this.groupSettingsChanged},g)});return super.renderBase((0,S.jsxs)("div",{className:"worklog-gadget-container",children:[!r&&!l&&(0,S.jsx)(ve,{}),l&&(0,S.jsx)("div",{className:"pad-15",children:"Loading... please wait while the report is being loaded. It may take few seconds / minute based on the range you had selected."}),r&&!u&&(0,S.jsxs)(ce.TabView,{className:"no-padding",renderActiveOnly:!1,children:[f,x,y]}),r&&u&&(0,S.jsxs)(ce.TabView,{className:"no-padding",renderActiveOnly:!1,children:[f,(0,S.jsx)(ce.TabPanel,{header:"Cost Report",contentClassName:"no-padding",children:r&&(0,S.jsx)(xe,{exportSheetName:"Cost Report",rawData:r,groups:h,dates:t,months:e,pageSettings:p,costView:!0,convertSecs:s,formatTime:a,breakupMode:m,getTicketUrl:this.$userutils.getTicketUrl,maxSecsPerDay:this.maxSecsPerDay})}),x,(0,S.jsx)(ce.TabPanel,{header:"Cost Summary",children:i&&(0,S.jsx)(Se,{exportSheetName:"Cost Summary",groups:h,flatData:i,formatDateTime:o,convertSecs:s,costView:!0},g)}),y]}),n&&(0,S.jsx)(de.Z,{groups:h,onHide:this.groupsChanged}),c&&(0,S.jsx)(pe,{pageSettings:p,onHide:this.settingsChanged}),d&&(0,S.jsx)(k.Z,{worklog:this.worklogItem,onDone:this.worklogAdded,onHide:this.hideWorklog,uploadImmediately:!0})]}))}}const Te=Ne;const Ce=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"function"===typeof e&&(e=e(e));const t=(0,o.createContext)(e),s=t.Provider;let a=function(){},r=function(){};function i(e){a(e)}function l(e){const t=r();if(t)return e?t[e]:t}function n(t){let{children:i,initialData:l,...n}=t;const[d,c]=(0,o.useState)((()=>({...e,...l,...n})));return a=e=>c("function"===typeof e?e:t=>({...t,...e})),r=()=>d,(0,S.jsx)(s,{value:d,children:i})}function d(e,s,a,r){if(a=a?Object.keys(a).reduce(((e,t)=>(e[t]=a[t](i,l),e)),{}):{},r&&r.length){const e=r[r.length-1];if("function"===typeof e){const t=(0,g.f3)(r.slice(0,r.length-1));a={...a,...e(t)}}else{const e=(0,g.f3)(r);a={...a,...e}}}return function(r){const i=(0,o.useContext)(t),l=s?s(i,r):void 0;return(0,S.jsx)(e,{...l,...r,...a})}}return{DataProvider:n,withProvider:function(e,t,s,a,r){return(t||s)&&(e=d(e,t,s,a)),r?function(t){const[s,a]=(0,o.useState)(!1),[i,l]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{!async function(){var e;let s=r(t);null!==(e=s)&&void 0!==e&&e.then&&(s=await s),l(s),a(!0)}()}),[]),s?(0,S.jsx)(n,{initialData:i,children:(0,S.jsx)(e,{...t})}):null}:function(t){return(0,S.jsx)(n,{children:(0,S.jsx)(e,{...t})})}},connect:d}},be={userListMode:"2",timeframeType:"2",userGroups:[],reportUserGrp:"1",dateRange:{},logFormat:"2",breakupMode:"1",userDisplayFormat:"1",fields:{},daysToHide:"1",rIndicator:"1",timeZone:"1",sprintStartRounding:"1",sprintEndRounding:"1",jql:"",logFilterType:"1",filterThrsType:"1",filterDays:5,filterDate:new Date,wlDateSelection:"1",loadingData:!1,reportLoaded:!1,disableAddingWL:!1,selSprints:{},sprintBoards:[],sprintList:{},allSprints:{},sprints:[],userExpnState:{}},{withProvider:De,connect:$e}=Ce(be);function We(e,t){if(!e)return{};const{userListMode:s,timeframeType:a,reportUserGrp:o,dateRange:r,logFormat:l,breakupMode:n,timeZone:d,sprintStartRounding:c,sprintEndRounding:h,userDisplayFormat:p,fields:m,daysToHide:u,rIndicator:g,jql:f,logFilterType:x,filterThrsType:y,filterDays:k,filterDate:j,wlDateSelection:v,sprintBoards:w,sprintList:S,selSprints:N={},userGroups:T,flatTableSettings:C}=e,b=Le({userListMode:s,timeframeType:a,reportUserGrp:o,dateRange:r,logFormat:l,breakupMode:n,timeZone:d,sprintStartRounding:c,sprintEndRounding:h,userDisplayFormat:p,fields:m,daysToHide:u,rIndicator:g,jql:f,logFilterType:x,filterThrsType:y,filterDays:k,filterDate:j,wlDateSelection:v,sprintBoards:w,sprintList:S,selSprints:N,flatTableSettings:Le(C)});return j&&i()(j).isSame(new Date,"day")&&delete b.filterDate,null!==t&&void 0!==t&&t.incUserGroups&&(b.userGroups=T),b}function Ue(e){let{sprintBoards:t,sprintList:s}=e;if(!t||!s)return{sprints:[],allSprints:{}};return{sprints:t.map((e=>{var t;return{label:e.name,isGroup:!0,items:null===(t=s[e.id])||void 0===t?void 0:t.map((e=>{let{name:t,id:s}=e;return{value:s,label:t}}))}})),allSprints:Object.keys(s).reduce(((e,t)=>{var a;return null===(a=s[t])||void 0===a||a.forEach((t=>e[t.id]=t)),e}),{})}}function Le(e){return"object"!==typeof e||Object.keys(e).forEach((t=>{"undefined"===typeof e[t]&&delete e[t]})),e}function Ee(e,t,s){const a=["summary","worklog","issuetype","parent","project","status","assignee","reporter"];if(e){var o;const r=e.fields.hideEstimate;let i=(null===(o=e.jql)||void 0===o?void 0:o.trim())||"";if(i){const{projects:e,users:t}=s||{};i=i.replace(/\$selectedProjects\$|\$selProjects\$/gi,`"${(null===e||void 0===e?void 0:e.join('", "'))||""}"`).replace(/\$selectedUsers\$|\$selUsers\$/gi,`"${(null===t||void 0===t?void 0:t.join('", "'))||""}"`),i=` AND (${i})`}r||(a.push("aggregatetimespent"),a.push("timeoriginalestimate"),a.push("timeestimate")),t&&a.push(t);const l=e.fields.optional;return Array.isArray(l)&&l.length&&l.forEach((e=>{let{key:t}=e;return a.push(t)})),{fieldsToFetch:a.distinct(),additionalJQL:i}}return{fieldsToFetch:a}}function Ie(e,t,s){return t.union((t=>t.users.union((a=>{var o,r;return(null===(o=e[(0,v.vW)(a,!0)])||void 0===o||null===(r=o.logData)||void 0===r?void 0:r.map(function(e,t,s){const{$userutils:{getTicketUrl:a}}=(0,g.f3)("UserUtilsService"),o=e.displayName;return r=>({groupName:t,sprintName:s,username:(0,v.vW)(e),userDisplay:o,fields:r.fields,assignee:r.assignee,reporter:r.reporter,parent:r.parent,parentSummary:r.parentSummary,parentUrl:r.parent?a(r.parent):null,epicDisplay:r.epicDisplay,epicUrl:r.epicUrl,ticketNo:r.ticketNo,ticketUrl:r.url,issueType:r.issueType,summary:r.summary,projectKey:r.projectKey,projectName:r.projectName,statusName:r.statusName,logTime:r.logTime,logCreated:r.logCreated,logUpdated:r.logUpdated,timeSpent:r.totalHours,originalestimate:r.originalestimate,remainingestimate:r.remainingestimate,totalLogged:r.totalLogged,estVariance:r.estVariance,comment:r.comment})}(a,t.name,s)))||[]}))))}function Me(e,t){let{projects:s,userListMode:a}=e;if((t||"3"===a||"4"===a)&&Array.isArray(s))return s.map((e=>{let{key:t}=e;return null===t||void 0===t?void 0:t.toUpperCase()})).distinct().filter(Boolean)}function Fe(e,t){const{userGroups:s,userListMode:a}=e;if(!t&&"2"!==a&&"4"!==a)return;return s.union((e=>(e.users.forEach((t=>t.groupName=e.name)),e.users))).map((e=>(0,v.vW)(e,!0))).distinct()}async function Pe(e,t){if(t){const{$ticket:a,$message:o}=(0,g.f3)("MessageService","TicketService");try{const s=e.distinct((e=>{let{fields:{[t]:s}}=e;return s})).filter(Boolean);return await a.getTicketDetails(s,!1,["summary","issuetype"])}catch(s){return o.error("Epic fetch failed",`Error Message: ${s.message}`),{}}}}function Re(e,t,s,a,o,r){var l;const n=(0,g.f3)("UserUtilsService","SessionService"),d={epicNameField:null===(l=n.$session.CurrentUser.epicNameField)||void 0===l?void 0:l.id,epicDetails:r,...n},c=function(e,t,s){const{logFilterType:a,filterThrsType:o,filterDays:r,wlDateSelection:l}=s;let{filterDate:n}=s;"1"===o?n=null:"2"===o&&(n=i()(t).clone().add(r,"days")),n&&(n=i()(n).endOf("day"));const d=s=>i()(s.started).isBetween(e,t,void 0,"[]");if("1"===a)return d;{const e="2"===a,t="2"!==l;return function(s){if(!d(s))return!1;const a=n||i()(s.started).add(r,"days").endOf("day");return e===i()(t&&s.updated||s.created).isBefore(a)}}}(t,s,o),h={};if(e.forEach((e=>{var t;const s=e.fields||{},o=(null===(t=s.worklog)||void 0===t?void 0:t.worklogs)||[],r=s.aggregatetimespent||0,l=s.timeoriginalestimate||0,n=s.timeestimate||0,p={originalestimate:l,remainingestimate:n,totalLogged:r,estVariance:l>0?n+r-l:0};o.forEach((t=>{if(!c(t))return;const o=(0,v.vW)(t.author,!0),r=o===a;let l=h[o];l||(l={logData:[],userName:o,isCurrentUser:r,...t.author},h[o]=l);const n=function(e,t,s,a,o){var r,l,n,d,c,h,p,m;let{epicNameField:u,epicDetails:g,$userutils:f}=o;const x={fields:t,ticketNo:e.key,epicDisplay:null,epicUrl:null,url:f.getTicketUrl(e.key),issueType:null===(r=t.issuetype)||void 0===r?void 0:r.name,iconUrl:null===(l=t.issuetype)||void 0===l?void 0:l.iconUrl,parent:null===(n=t.parent)||void 0===n?void 0:n.key,parentSummary:null===(d=t.parent)||void 0===d||null===(c=d.fields)||void 0===c?void 0:c.summary,assignee:null===(h=t.assignee)||void 0===h?void 0:h.displayName,reporter:null===(p=t.reporter)||void 0===p?void 0:p.displayName,summary:t.summary,logTime:i()(s.started).toDate(),logCreated:i()(s.created).toDate(),logUpdated:i()(s.updated||s.created).toDate(),comment:s.comment,projectName:t.project.name,statusName:null===(m=t.status)||void 0===m?void 0:m.name,projectKey:t.project.key,totalHours:s.timeSpentSeconds,...a};if(u){const e=t[u];if("string"===typeof e&&e.includes("-")){x.epicKey=e;const t=g[e];if(null!==t&&void 0!==t&&t.fields){const{key:e,fields:{summary:s,issuetype:{iconUrl:a}}}=t;x.epicDisplay=`${e} - ${s}`,x.epicIcon=a}x.epicUrl=f.getTicketUrl(e)}else x.epicDisplay=e}return x}(e,s,t,p,d);l.logData.push(n)}))})),"2"===o.userListMode){const e=Fe(o);Object.keys(h).forEach((t=>{e.includes(t)||delete h[t]}))}else if("4"===o.userListMode){const e=Me(o),t=Fe(o);Object.keys(h).filter((e=>!t.includes(e))).forEach((t=>{const s=h[t];let{logData:a}=s;a=a.filter((t=>{var s;return e.includes(null===(s=t.projectKey)||void 0===s?void 0:s.toUpperCase())})),a.length?s.logData=a:delete h[t]}))}return{userwiseLog:h,userwiseLogArr:Object.keys(h).map((e=>{const t=h[e];return t.totalHours=t.logData.sum((e=>e.totalHours)),t})).sortBy((e=>e.displayName))}}function Ae(e){return e.groupBy((e=>`${e.month}_${e.week}`)).map((e=>{let{values:t}=e;const s=t.length;let a="";const{0:{week:o,dispFormat:r,dateNum:i},[s-1]:{dateNum:l}}=t;return a=s>4?`${r}, ${i} to ${l} (W-${o})`:s>3?`${r}, ${i}-${l}`:s>2?`${r.split(" ")[0]} (W-${o})`:r.split(" ")[0],{display:a,days:s}}))}function He(e,t,s){const a=(0,g.f3)("UtilsService","UserUtilsService","SessionService"),{maxHours:o,minHours:r=o}=a.$session.CurrentUser,l=60*(o||8)*60,n=60*(r||8)*60,{timeZone:d,fromDate:c,toDate:h}=s;let{dates:p,daysToHide:m}=s;if(p)m=!1;else{const e=a.$utils.getDateArray(c,h);p=e.map((e=>({prop:e.format("yyyyMMdd"),date:e,dispFormat:e.format("MMM yyyy").toUpperCase(),month:e.getMonth(),week:i()(e).week(),dayOfWeek:i()(e).day(),day:e.format("DD").toUpperCase(),dateNum:e.getDate(),isHoliday:a.$userutils.isHoliday(e)})))}const u=parseInt(d),f=t.map((t=>{const s={name:t.name,total:{},totalCost:{},grandTotal:0,grandTotalCost:0,users:null};t.isDummy&&(s.isDummy=t.isDummy),s.users=t.users.map((s=>{let o=null;2===u?o=t.timeZone:3===u&&(o=s.timeZone||t.timeZone),"GRP_TZ"===o&&(o=t.timeZone);const r={name:(0,v.vW)(s),displayName:s.displayName,emailAddress:s.emailAddress,timeZone:o,imageUrl:s.avatarUrls["48x48"]||s.avatarUrls["32x32"],profileUrl:a.$userutils.getProfileUrl(s),costPerHour:s.costPerHour,tickets:null,total:{},totalCost:{},logClass:{},grandTotal:0,grandTotalCost:0},d=e[s.userName||(0,v.vW)(s,!0)]||{};d.isCurrentUser&&(r.isCurrentUser=!0);const c=d.logData||[],h={};r.ticketsMap=h,r.tickets=c.groupBy((e=>e.ticketNo)).map((e=>{const t=e.values,a=t.first(),r={},l={fields:a.fields,ticketNo:e.key,parent:a.parent,parentUrl:a.parent?(0,v.V8)(a.parent):null,parentSummary:a.parentSummary,projectKey:a.projectKey,projectName:a.projectName,assignee:a.assignee,reporter:a.reporter,epicDisplay:a.epicDisplay,epicUrl:a.epicUrl,issueType:a.issueType,iconUrl:a.iconUrl,statusName:a.statusName,summary:a.summary,originalestimate:a.originalestimate,remainingestimate:a.remainingestimate,totalLogged:a.totalLogged,estVariance:a.estVariance,url:a.url,logs:r,totalHours:0,totalCost:0};h[l.ticketNo]=l;let n=0;return t.forEach((e=>{let t=e.logTime;o&&(t=i()(i()(t).tz(o).format("YYYY-MM-DD HH:mm:ss")).toDate());const a=t.format("yyyyMMdd");let l=r[a];l||(l=[],r[a]=l),l.push({logTime:t,totalHours:e.totalHours,totalCost:(0,v.qN)(e.totalHours,s.costPerHour),comment:e.comment}),n+=e.totalHours})),l.totalHours=n,l.totalCost=(0,v.qN)(n,s.costPerHour),l}));const m=r.logClass,g=r.total,f=r.totalCost;let x=0;return p.forEach((e=>{const t=r.tickets.sum((t=>{const s=t.logs[e.prop];return s?s.sum((e=>e.totalHours)):0}));t>0&&(g[e.prop]=t,f[e.prop]=(0,v.qN)(t,s.costPerHour),x+=t),m[e.prop]=function(e,t,s,a){if(t=t>0?t:0,e.isHoliday)return t?"log-high":"col-holiday";if(t>=a&&t<=s)return"log-good";if(t<a)return"log-less";if(t>s)return"log-high"}(e,t,l,n)})),r.grandTotal=x,r.grandTotalCost=(0,v.qN)(x,s.costPerHour),r})),s.usersMap=s.users.reduce(((e,t)=>(e[t.name]=t,e)),{});const o=s.total,r=s.totalCost;let d=0,c=0;return p.forEach((e=>{const t=s.users.sum((t=>t.total[e.prop]||0));t>0&&(o[e.prop]=t,d+=t);const a=s.users.sum((t=>t.totalCost[e.prop]||0));a>0&&(r[e.prop]=a,c+=a)})),s.grandTotal=d,s.grandTotalCost=c,s}));let x=0,y=0;const k={},j={};return p.forEach((e=>{const t=f.sum((t=>t.total[e.prop]||0));t>0&&(k[e.prop]=t,x+=t),e.hasWorklogs=e.hasWorklogs||t>0;const s=f.sum((t=>t.totalCost[e.prop]||0));s>0&&(j[e.prop]=s,y+=s)})),f.grandTotal=x,f.grandTotalCost=y,f.total=k,f.totalCost=j,p=Ve(m,p),{groupedData:f,weeks:Ae(p),dates:p}}function Ve(e,t){if(!e||"1"===e)return t;const s="3"===e;return"2"===e||s?t.filter((e=>e.hasWorklogs||!s&&!e.isHoliday)):t}function Be(e,t){return async function(){const s={loadingData:!1};try{e({loadingData:!0,errorTitle:"",errorMessage:""});const{dateRange:{fromDate:a,toDate:o}}=t();if(!a||!o)return null;const r=await async function(e,t,s){const{$session:{CurrentUser:{name:a,epicNameField:o}}}=(0,g.f3)("SessionService"),r=await async function(e,t,s,a){const o=(0,g.f3)("JiraService"),{fieldsToFetch:r,additionalJQL:i}=Ee(s,a,{projects:Me(s,!0),users:Fe(s,!0)}),l=Fe(s),n=Me(s);if(0===(null===l||void 0===l?void 0:l.length)||0===(null===n||void 0===n?void 0:n.length))throw Error("Either userlist or project is required for generating worklog report");const d=l?`worklogAuthor in ("${l.join('","')}")`:"",c=n?`project in ("${n.join('","')}")`:"",h=d||c?`(${d}${d&&c?" OR ":""}${c}) AND `:"",p=`(worklogDate >= '${e.clone().add(-1,"days").format("YYYY-MM-DD")}' and worklogDate < '${t.clone().add(1,"days").format("YYYY-MM-DD")}') `,m=`${h}${p}${i}`;return await o.$jira.searchTickets(m,r,0,{worklogStartDate:e.toDate(),worklogEndDate:t.toDate()})}(e,t,s,null===o||void 0===o?void 0:o.id);if(!r.length)return;const i=await Pe(r,null===o||void 0===o?void 0:o.id),{userListMode:l,userGroups:n,reportUserGrp:d}=s,c="2"===l&&"1"===d;if(c||"1"===d)return Ze(r,e,t,null===a||void 0===a?void 0:a.toLowerCase(),s,c&&n,i);{const{groupByFunc:l,getGroupName:h}=function(e,t,s){return"3"===e?{getGroupName:e=>{const{name:t}=e[0].fields.issuetype;return t},groupByFunc:e=>e.fields.issuetype.id}:"4"===e&&t?{getGroupName:e=>{var a;const o=e[0].fields[t],r=o&&(null===s||void 0===s||null===(a=s[o])||void 0===a?void 0:a.fields.summary);return(r?`${o} - ${r}`:o)||"<Issues without epic>"},groupByFunc:e=>e.fields[t]}:{getGroupName:e=>{const{name:t,key:s}=e[0].fields.project;return`${t} (${s})`},groupByFunc:e=>e.fields.project.key}}(d,null===o||void 0===o?void 0:o.id,i),p=[],m=r.groupBy(l).map((e=>{let{values:t}=e;return{issues:t,grpName:h(t)}})).sortBy((e=>{let{grpName:t}=e;return t})).reduce(((o,r)=>{let{grpName:l,issues:d}=r;const{flatWorklogs:h,groupReport:{dates:m,groupedData:u}}=Ze(d,e,t,null===a||void 0===a?void 0:a.toLowerCase(),s,c&&n,i,o.dates,l);if(o.dates=m,!u.grandTotal)return o;p.addRange(h);const[g]=u;g.name=l,delete g.isDummy;const{groupedData:f}=o;return f.push(g),f.grandTotal=(f.grandTotal||0)+(u.grandTotal||0),f.grandTotalCost=(f.grandTotalCost||0)+(u.grandTotalCost||0),f.total=Oe(f.total,u.total),f.totalCost=Oe(f.totalCost,u.totalCost),o}),{groupedData:[]});return m.dates=Ve(s.daysToHide,m.dates),m.weeks=Ae(m.dates),{flatWorklogs:p,groupReport:m}}}(i()(a).startOf("day"),i()(o).endOf("day"),t());if(!r){const{$message:e}=(0,g.f3)("MessageService");return void e.warning("No worklog information returned matching your filters","No data available")}const{groupReport:l,flatWorklogs:n}=r;s.groupReport=l,s.flatWorklogs=n,s.reportLoaded=!0}catch(r){var a,o;console.error("Error pulling range report:",r);const{$message:t}=(0,g.f3)("MessageService"),s=r.message||(null===(a=r.error)||void 0===a||null===(o=a.errorMessages)||void 0===o?void 0:o[0])||"Unknown error. Check the console for more details",i=r.message?"Worklog report":"Unknown error";e({errorTitle:i,errorMessage:s}),t.error(s,i)}finally{e(s)}}}function Oe(e,t){if(e){if(t){const s={...e};return Object.keys(t).forEach((e=>{s[e]=(s[e]||0)+(t[e]||0)})),s}return e}return t}function Ze(e,t,s,a,o,r,i,l,n){const{userwiseLog:d,userwiseLogArr:c}=Re(e,t,s,a,o,i);r||(r=[_e(c,n)]);return{groupReport:He(d,r,{fromDate:t.toDate(),toDate:s.toDate(),timeZone:o.timeZone,dates:l,daysToHide:l?null:o.daysToHide}),flatWorklogs:Ie(d,r)}}const Ge="";function _e(e,t){const s=e.reduce(((e,t)=>(e.totalHours+=t.totalHours||0,e.totalCost+=t.totalCost||0,e)),{totalHours:0,totalCost:0});return{isDummy:!0,name:t||Ge,users:e,...s}}function ze(e,t,s,a,o){let{userListMode:r,userGroups:i}=a;const l=function(e,t){return e.map((e=>{const{id:s,name:a}=e,{dates:o}=t[`groupReport_${s}`];return{id:s,name:Je(a,e.settings),days:o.length}}))}(e,t);function n(e,s){const{grandTotalHours:a,grandTotalCost:o,users:r,usersMap:i}=function(e,t,s){let a=0,o=0;const r=e.sortBy((e=>e.displayName)).map((e=>{const r=[],i={},l={...e,tickets:r,allSprintTotalCost:0,allSprintTotalHours:0},n=(0,v.vW)(l);for(const a of t){const{groupedData:[e]}=s[`groupReport_${a.id}`],{tickets:t,grandTotal:o,grandTotalCost:d}=e.usersMap[n]||{tickets:[]};o&&(l.allSprintTotalHours+=o),d&&(l.allSprintTotalCost+=d);for(const s of t){const{ticketNo:e}=s,t=i[e];t?(s.totalHours&&(t.grandTotalHours+=s.totalHours),s.totalCost&&(t.grandtotalCost+=s.totalCost)):(r.push(s),i[e]=s,s.allSprintTotalHours=s.totalHours,s.allSprintTotalCost=s.totalCost)}}return a+=l.allSprintTotalHours,o+=l.allSprintTotalCost,l}));return{grandTotalHours:a,grandTotalCost:o,users:r}}(s,l,t);return{name:e,users:r,usersMap:i,grandTotalHours:a,grandTotalCost:o,sprints:l}}return"2"===r?i.map((e=>n(e.name,e.users))):[n("Sprint",s)]}function qe(e,t,s){var a;const{range:o,custom:r}=t[e],i=null===(a=s[e])||void 0===a?void 0:a.sortBy((e=>{let{startDate:t}=e;return new Date(t).getTime()}),!0);switch(o){case-1:return i.filter((e=>r[e.id])).reverse();case 0:return[i[0]].filter(Boolean);case 1:const e=i[0];return[e.completeDate?e:i[1]].filter(Boolean);default:return i.slice(0,o).reverse()}}async function Xe(e,t,s,a){var o;const{$jira:r,$session:{CurrentUser:{epicNameField:i}}}=(0,g.f3)("JiraService","SessionService"),{fieldsToFetch:l}=Ee(a,null===i||void 0===i?void 0:i.id),n={maxResults:1e3,fields:l,worklogStartDate:t,worklogEndDate:s};var d;null!==(o=a.jql)&&void 0!==o&&o.trim()&&(n.jql=null===(d=a.jql)||void 0===d?void 0:d.trim());const c=await r.getSprintIssues(e,n);return{issues:c,epicDetails:c.length>0&&await Pe(c,null===i||void 0===i?void 0:i.id)}}function Ye(e,t,s,a){const{userListMode:o,userGroups:r}=a,i="2"===o?r:function(e,t,s){return[{name:Je(e.name,s),users:Object.keys(t).map((e=>t[e]))}]}(e,t,s);return{groupReport:He(t,i,s),flatWorklogs:Ie(t,i,e.name)}}function Je(e,t){if(null===t||void 0===t||!t.fromDate)return e;const{fromDate:s,toDate:a}=t,{$userutils:o}=(0,g.f3)("UserUtilsService");return`${e} (${o.formatDateTime(s)} - ${o.formatDateTime(a)})`}function Ke(e){return function(t){e(t)}}function Qe(e,t){const{$utils:{convertSecs:s}}=(0,g.f3)("UtilsService");return e=>e||0===e?s(e,{format:"1"===t("logFormat")}):e}const et=["date","datetime","string","number"],tt=["project","issuetype","parent","status","assignee","reporter","comment"];function st(e){return function(t,s){e({[t]:s})}}function at(e,t,s,a,o){return(0,S.jsx)("input",{type:"radio",className:"form-check-input",name:e,checked:s===t,onChange:()=>a(e,t),...o})}function ot(e){let{sprintBoards:t,selSprints:s,setValue:a,onChange:r}=e;const i=(0,o.useRef)(null),l=(0,o.useRef)(!0),{current:n}=l;(0,o.useEffect)((()=>{l.current=!1,!n&&(null===r||void 0===r||r())}),[s]);const d=!(null===t||void 0===t||!t.length),[c,h]=(0,o.useState)(s),p=(e,t,s)=>h({...c,[t]:{range:0,custom:[],...c[t],selected:e,name:s}}),m=d?(e,t)=>h(t):void 0,u=d&&c!==s?()=>{Object.keys(c).forEach((e=>{const t=c[e];-1!==t.range||Object.keys(t.custom||{}).length||delete c[e]})),a("selSprints",c)}:void 0;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"link margin-r-8",title:"Click to choose list of sprints",onClick:e=>i.current.toggle(e),children:"Choose sprint"}),(0,S.jsxs)(j.T,{ref:i,showCloseIcon:!0,id:"overlay_panel",style:{width:"450px"},onHide:u,className:"op-sprint-list",children:[!d&&(0,S.jsxs)("div",{className:"pad-22 no-boards-message",children:[(0,S.jsx)("span",{className:"fa fa-exclamation-triangle warn"})," No agile boards selected. Click ",(0,S.jsx)("span",{className:"fa fa-cogs"})," icon to choose one or more agile boards."]}),d&&(0,S.jsx)("div",{className:"board-list",children:(0,S.jsxs)("table",{className:"board-list-table",children:[(0,S.jsx)("thead",{children:(0,S.jsx)("tr",{children:t.map((e=>{var t;return(0,S.jsx)("th",{children:(0,S.jsx)("div",{children:(0,S.jsx)(b.XZ,{label:e.name,field:e.id,args:e.name,checked:null===(t=c[e.id])||void 0===t?void 0:t.selected,onChange:p})})},e.id)}))})}),(0,S.jsx)("tbody",{children:(0,S.jsx)("tr",{children:t.map((e=>{var t;return(0,S.jsx)("td",{className:"board-col",children:(0,S.jsx)(it,{board:e,selSprints:c,setValue:m,disabled:!(null!==(t=c[e.id])&&void 0!==t&&t.selected)})},e.id)}))})})]})})]})]})}const rt=$e(o.memo(ot),(e=>{let{selSprints:t,sprintBoards:s}=e;return{selSprints:t,sprintBoards:s}}),{setValue:st});function it(e){var t;let{board:s,selSprints:a,disabled:r,setValue:i}=e;const[l,n]=(0,o.useState)(-1===(null===(t=a[s.id])||void 0===t?void 0:t.range)),d=e=>{e<0&&n(!0),c(null,null,e)},c=(e,t,o)=>{const r={...a[s.id],range:o};t>0&&(r.custom={...r.custom,[t]:e},e||delete r.custom[t]),i("selSprints",{...a,[s.id]:r})};return l?(0,S.jsxs)("div",{className:"sprint-custom-cntr",children:[(0,S.jsx)(lt,{boardId:s.id,selSprints:a,onChange:c,disabled:r}),(0,S.jsx)("div",{children:(0,S.jsx)("span",{className:"link",onClick:()=>n(!1),children:" Back"})})]}):(0,S.jsxs)("div",{className:"sprint-range",children:[(0,S.jsx)("div",{children:(0,S.jsx)(b.EU,{label:"Last sprint",defaultValue:0,value:null===(h=a[s.id])||void 0===h?void 0:h.range,onChange:d,disabled:r})}),(0,S.jsx)("div",{children:(0,S.jsx)(b.EU,{label:"Last closed sprint",defaultValue:1,value:null===(p=a[s.id])||void 0===p?void 0:p.range,onChange:d,disabled:r})}),(0,S.jsx)("div",{children:(0,S.jsx)(b.EU,{label:"Last 2 sprints",defaultValue:2,value:null===(m=a[s.id])||void 0===m?void 0:m.range,onChange:d,disabled:r})}),(0,S.jsx)("div",{children:(0,S.jsx)(b.EU,{label:"Last 3 sprints",defaultValue:3,value:null===(u=a[s.id])||void 0===u?void 0:u.range,onChange:d,disabled:r})}),(0,S.jsx)("div",{children:(0,S.jsx)(b.EU,{label:"Last 4 sprints",defaultValue:4,value:null===(g=a[s.id])||void 0===g?void 0:g.range,onChange:d,disabled:r})}),(0,S.jsx)("div",{children:(0,S.jsx)(b.EU,{label:"Last 5 sprints",defaultValue:5,value:null===(f=a[s.id])||void 0===f?void 0:f.range,onChange:d,disabled:r})}),(0,S.jsx)("div",{children:(0,S.jsx)(b.EU,{label:"Custom",defaultValue:-1,value:null===(x=a[s.id])||void 0===x?void 0:x.range,onChange:d,disabled:r})})]});var h,p,m,u,g,f,x}const lt=$e((function(e){var t;let{boardId:s,selSprints:a,getRapidSprintList:r,onChange:i,disabled:l}=e;const[n,d]=(0,o.useState)(!1),[c,h]=(0,o.useState)([]);(0,o.useEffect)((()=>{!async function(){try{d(!0);const e=await r([s]);h(e)}catch(e){console.error("Error pulling sprint for board:",s,e)}finally{d(!1)}}()}),[s,r]);const p=(null===(t=a[s])||void 0===t?void 0:t.custom)||{};return(0,S.jsxs)("div",{className:"sprints-custom",children:[n&&(0,S.jsx)("span",{children:"Loading..."}),c.map(((e,t)=>(0,S.jsx)("div",{children:(0,S.jsx)(b.XZ,{label:e.name,checked:!!p[e.id],field:e.id,args:-1,onChange:i,disabled:l})},t)))]})}),null,null,["JiraService",e=>{let{$jira:{getRapidSprintList:t}}=e;return{getRapidSprintList:t}}]),nt=$e((function(e){let{userListMode:t,timeframeType:s,showGroupsPopup:a,onInputChanged:o}=e;return(0,S.jsxs)(S.Fragment,{children:["1"===s&&(0,S.jsx)(rt,{onChange:o}),"2"===s&&(0,S.jsx)(dt,{onChange:o}),("2"===t||"4"===t)&&(0,S.jsx)(b.zx,{icon:"fa fa-users",onClick:a,title:"Add users / groups to report"})]})}),(e=>{let{userListMode:t,timeframeType:s}=e;return{userListMode:t,timeframeType:s}})),dt=$e((function(e){let{dateRange:t,onChange:s,setValue:a}=e;const r=(0,o.useRef)(!0),{current:i}=r;return(0,o.useEffect)((()=>{r.current=!1,!i&&(null===s||void 0===s||s())}),[t]),(0,S.jsx)(b.Mt,{value:t,range:!0,onChange:e=>a("dateRange",e),style:{marginRight:"35px"}})}),(e=>{let{dateRange:t}=e;return{dateRange:t}}),{setValue:st});var ct=s(8514);function ht(e){let{showMore:t,setShowMore:s}=e;const a=(0,o.useCallback)((()=>s(!t)),[t,s]);return(0,S.jsxs)("div",{onClick:a,className:"show-more-link",children:[(0,S.jsx)("span",{className:t?"fa fa-caret-down":"fa fa-caret-right"}),(0,S.jsx)("span",{className:"link",children:t?"Hide options":"Show more options"})]})}const pt=function(e){let{setValue:t,setBoards:s,state:a}=e;const{userListMode:o,timeframeType:r,sprintBoards:i,projects:l}=a,n="1"===r||!(null!==l&&void 0!==l&&l.length),d=n&&(0,S.jsx)("span",{className:"fa fa-exclamation-triangle msg-warning margin-l-5",title:"Not applicable when timeframe below is selected as Sprint or when no default project is configured"});return(0,S.jsxs)("div",{className:"settings-group",children:[(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"User List"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("userListMode","1",o,t),"Show all users who logged work"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("userListMode","2",o,t),"Show only selected users"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("userListMode","3",o,t,{disabled:n}),"Show all users logged work on configured projects ",d]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("userListMode","4",o,t,{disabled:n}),"Show selected users and all worklogs on configured projects ",d]})})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Time frame type"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("timeframeType","1",r,t,{disabled:"3"===o||"4"===o}),"Based on specific sprint",("3"===o||"4"===o)&&(0,S.jsx)("span",{className:"fa fa-exclamation-triangle msg-warning margin-l-5",title:"Not applicable based on User List selection above"})]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("timeframeType","2",r,t),"Based on selected date range"]})})]})]}),"1"===r&&(0,S.jsx)(mt,{sprintBoards:i,setBoards:s}),"1"===r&&(0,S.jsx)(gt,{state:a,setValue:t}),"2"===r&&(0,S.jsx)(ut,{state:a,setValue:t,userListMode:o})]})},mt=o.memo((function(e){let{setBoards:t,sprintBoards:s}=e;return(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Choose Agile board *"}),(0,S.jsx)("div",{className:"col-md-9 col-form-label",children:(0,S.jsx)(ct.Z,{value:s,onChange:t,multiple:!0})})]})}));function ut(e){let{setValue:t,state:{epicField:s,reportUserGrp:a,jql:o},userListMode:r}=e;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Users worklog grouping"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("reportUserGrp","1",a,t),"2"===r?"Use default user groups":"Do not group worklogs"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("reportUserGrp","2",a,t),"Group worklogs based on project"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("reportUserGrp","3",a,t),"Group worklogs based on Issue type"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("reportUserGrp","4",a,t,{disabled:!s}),"Group by Epic ",!s&&(0,S.jsx)("span",{className:"fa fa-exclamation-triangle msg-warning margin-l-5",title:"JIRA Epic field name must be configured in general settings -> default values tab"})]})})]})]}),"1"===r&&(0,S.jsxs)("div",{className:"col-md-12",children:[(0,S.jsx)("strong",{children:"Caution:"})," Pulling worklogs of all the users on a specific timerange could result in pulling huge data and cause performance issues.",o?"Ensure you have necessary filters in JQL.":"Use JQL to add additional filters as necessary."]})]})}const gt=o.memo((function(e){let{setValue:t,state:{sprintStartRounding:s,sprintEndRounding:a}}=e;const[r,i]=(0,o.useState)(!1);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ht,{showMore:r,setShowMore:i}),r&&(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Sprint start date rounding"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("sprintStartRounding","1",s,t),"Match exact start date time of sprint"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("sprintStartRounding","2",s,t),"Consider start of day as start date"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("sprintStartRounding","3",s,t),"Consider start of next day as start date"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("sprintStartRounding","4",s,t),"Use end of previous sprint (if available)"]})})]})]}),r&&(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Sprint end date rounding"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("sprintEndRounding","1",a,t),"Match exact end date time of sprint"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("sprintEndRounding","2",a,t),"Consider end of day as end date"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("sprintEndRounding","3",a,t),"Consider end of previous day as end date"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("sprintEndRounding","4",a,t),"Use start of next sprint (if available)"]})})]})]})]})}));var ft=s(5856);const xt=function(e){let{value:t,field:s,valueOnly:a,onChange:r,hideTypes:i,hideKeys:l}=e;const n=(0,o.useMemo)((()=>!t||a?t:t.map((e=>e.key))),[t,a]),[d,c]=(0,o.useState)(),h=(0,o.useMemo)((()=>null===d||void 0===d?void 0:d.reduce(((e,t)=>(e[t.key]=t,e)),{})),[d]);(0,o.useEffect)((()=>{(async function(e,t){const{$jira:s}=(0,te.f3)("JiraService");let a=await s.getCustomFields();Array.isArray(e)&&e.length&&(a=a.filter((t=>{var s;return!e.includes(null===(s=t.schema)||void 0===s?void 0:s.type)})));Array.isArray(t)&&t.length&&(a=a.filter((e=>!t.includes(e.key))));return a})(i,l).then(c)}),[i,l]);const p=(0,o.useCallback)(((e,t)=>{const s=e.map((e=>{const t=h[e],{key:s,name:a}=t,o=function(e){const{schema:t,key:s}=e;if(!t)return s;const{type:a,system:o}=t;if(!o)return a;if("number"===a&&(o.endsWith("timespent")||o.endsWith("estimate")))return"timespent";return a}(t);return{key:s,name:a,type:o}}));r(s,t)}),[h,r]);return d?(0,S.jsx)(b.jL,{multiselect:!0,valueField:"key",displayField:"name",value:n||[],dataset:d||[],field:s,onChange:a?r:p,filter:!0,placeholder:"Choose the list of columns"}):"Loading..."};const yt=["array","option"],kt=["key","summary","issuetype"];function jt(e){let{setFieldValue:t,fields:s}=e;const{optional:a,daywiseFields:r,showCostReport:i,hideEstimate:l}=s,n=(0,o.useCallback)(((e,s)=>{const a=r||{};if(e)t({...a,[s]:!0},"daywiseFields");else{const e={...a};delete e[s],t(e,"daywiseFields")}}),[r,t]);return(0,S.jsx)("div",{className:"settings-group",children:(0,S.jsxs)("div",{className:"row",children:[(0,S.jsxs)("div",{className:"col-4",children:[(0,S.jsx)(ft.Z,{checked:i,onChange:t,field:"showCostReport",label:"Show cost report"}),(0,S.jsxs)("span",{className:"pad-l-15",children:[" ( ",(0,S.jsx)("i",{className:"fa fa-exclamation-triangle",title:"Change will take effect only after report is refreshed"})," )"]})]}),(0,S.jsxs)("div",{className:"col-8",children:[(0,S.jsx)(ft.Z,{checked:l,onChange:t,field:"hideEstimate",label:"Hide estimate related fields"}),(0,S.jsxs)("span",{className:"pad-l-15",children:[" ( ",(0,S.jsx)("i",{className:"fa fa-exclamation-triangle",title:"Change will take effect only after report is refreshed"})," )"]})]}),(0,S.jsxs)("div",{className:"col-12",children:[(0,S.jsx)("strong",{children:"Additional fields to pull from Jira"}),(0,S.jsx)(xt,{value:a,field:"optional",onChange:t,hideTypes:yt,hideKeys:kt}),(0,S.jsx)("span",{children:"These fields would be displayed in Flat (Groupable)"})]}),(0,S.jsxs)("div",{className:"col-12",children:[(0,S.jsx)("strong",{children:"Additional fields to be displayed in Grouped - [User daywise] report"}),(0,S.jsx)("div",{className:"row",children:null===a||void 0===a?void 0:a.map((e=>(0,S.jsx)("div",{className:"col-4",children:(0,S.jsx)(ft.Z,{checked:null===r||void 0===r?void 0:r[e.key],onChange:n,field:e.key,label:e.name},e.key)})))})]})]})})}const vt=o.memo(jt);const wt=function(e){let{setValue:t,state:s,state:{logFormat:a,timeZone:r,daysToHide:i}}=e;const[l,n]=(0,o.useState)(!1);return(0,S.jsxs)("div",{className:"settings-group",children:[(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Report timezone (experimental)"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("timeZone","1",r,t),"Use my local time zone for all users"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("timeZone","2",r,t),"Use containing groups timezone for all users"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("timeZone","3",r,t),"Use individual users timezone"]})})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Days to hide in Daywise view"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("daysToHide","1",i,t),"Show all days"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("daysToHide","2",i,t),"Hide non working days without worklog"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("daysToHide","3",i,t),"Hide all days without worklog"]})})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Log hour format"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("logFormat","1",a,t),"Format hours (2h 30m)"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("logFormat","2",a,t),"Show as number (2.5)"]})})]})]}),(0,S.jsx)(ht,{showMore:l,setShowMore:n}),l&&(0,S.jsx)(St,{setValue:t,state:s})]})};function St(e){let{setValue:t,state:{breakupMode:s,userDisplayFormat:a,rIndicator:o}}=e;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"User display format"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("userDisplayFormat","1",a,t),"Show user display name only"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("userDisplayFormat","2",a,t),"Show user display name with avatar"]})})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Log breakup"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("breakupMode","1",s,t),"Single entry (Sum worklog added for same ticket on same day)"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("breakupMode","2",s,t),"Individual entry (Display individual entry for each of the worklog)"]})})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Range indicator"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("rIndicator","1",o,t),"Show thermometer as indicator"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("rIndicator","2",o,t),"Highlight background as indicator"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("rIndicator","0",o,t),"Do not show any indicator"]})})]})]})]})}var Nt=s(8801);const Tt=function(e){let{setValue:t,state:{logFilterType:s,filterThrsType:a,filterDays:o,filterDate:r,wlDateSelection:i}}=e;return(0,S.jsxs)("div",{className:"settings-group",children:[(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Filter worklogs by creation/updation"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("logFilterType","1",s,t),"Show all worklogs"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("logFilterType","2",s,t),"Show worklogs logged before the threshold"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("logFilterType","3",s,t),"Show worklogs logged after the threshold"]})})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Date selection"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("wlDateSelection","1",i,t),"Use updated date of worklog if its modified after creation"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("wlDateSelection","2",i,t),"Always use worklog creation date only"]})})]})]}),(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Threshold type"}),(0,S.jsxs)("div",{className:"col-md-9 col-form-label",children:[(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("filterThrsType","1",a,t),"X number of days from the log date"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("filterThrsType","2",a,t),"X number of days from the last date"]})}),(0,S.jsx)("div",{className:"form-check",children:(0,S.jsxs)("label",{className:"form-check-label",children:[at("filterThrsType","3",a,t),"On a specific date selected"]})})]})]}),"3"!==a&&(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Threshold days"}),(0,S.jsx)("div",{className:"col-md-9",children:(0,S.jsx)(Nt.R,{className:"form-check-input",value:o,maxLength:3,maxFractionDigits:0,onValueChange:e=>{let{value:s}=e;return t("filterDays",s)}})})]}),"3"===a&&(0,S.jsxs)("div",{className:"form-group row",children:[(0,S.jsx)("label",{className:"col-md-3 col-form-label",children:"Threshold date"}),(0,S.jsx)("div",{className:"col-md-9",children:(0,S.jsx)(b.Mt,{value:r,onChange:e=>t("filterDate",e)})})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("strong",{children:"Info:"})," This tab lets to filter the worklog based on the date when the worklog was created/updated by the user. This would help you to eliminate or identify worklogs added after a threshold date."]}),(0,S.jsx)("br",{}),(0,S.jsxs)("div",{children:[(0,S.jsx)("strong",{children:"Note:"})," Changes in this tab would reflect only after you refresh the report."]})]})},Ct=function(e){let{settings:t,onChange:s}=e;const[a,r]=(0,o.useState)({}),[i,l]=(0,o.useState)(t),n=e=>{r(e);const a={...t,...e};l(a),s(a,e)},d=(e,t)=>n({...a,[e]:t});return(0,S.jsxs)(ce.TabView,{className:"worklog-settings",children:[(0,S.jsx)(ce.TabPanel,{header:"Datasource",leftIcon:"fa fa-cog",contentClassName:"pad-22",children:(0,S.jsx)(pt,{state:i,setValue:d,setBoards:e=>{const{sprintList:t}=i;n({...a,sprintBoards:e,sprintList:t&&e.reduce(((e,s)=>(e[s.id]=t[s.id],e)),{})})}})}),(0,S.jsx)(ce.TabPanel,{header:"Formatting",leftIcon:"fa fa-cog",contentClassName:"pad-22",children:(0,S.jsx)(wt,{state:i,setValue:d})}),(0,S.jsx)(ce.TabPanel,{header:"Fields list",leftIcon:"fa fa-cog",contentClassName:"pad-22",children:(0,S.jsx)(vt,{fields:i.fields,setFieldValue:(e,t)=>{d("fields",{...i.fields,[t]:e})},epicField:i.epicField})}),(0,S.jsx)(ce.TabPanel,{header:"Log filter",leftIcon:"fa fa-filter",contentClassName:"pad-22",children:(0,S.jsx)(Tt,{state:i,setValue:d})}),(0,S.jsxs)(ce.TabPanel,{header:"JQL filter",leftIcon:"fa fa-filter",children:[(0,S.jsx)(b.zC,{multiline:!0,value:i.jql,onChange:e=>d("jql",e),style:{width:"100%",height:411},placeholder:"Provide the additional JQL filters to be applied while fetching data.",defaultValue:""}),(0,S.jsxs)("span",{children:[(0,S.jsx)("strong",{children:"Note:"})," Date range and user list filter will be added automatically."]})]})]})};class bt extends C.Z{constructor(e){super(e,"Report configurations"),this.onDone=async()=>{const{modifiedSettings:e,allSettings:t}=this.state,s=We(function(e,t,s){const{reportLoaded:a,userListMode:o,timeframeType:r}=e;a&&(t.reportLoaded=(!t.userListMode||t.userListMode===o)&&(!t.timeframeType||t.timeframeType===r));const{sprintBoards:i,selSprints:l}=s,n=(null===i||void 0===i?void 0:i.reduce(((e,t)=>(e[t.id]=!0,e)),{}))||{},d=Object.keys(l).filter((e=>!n[e]));if(d.length){const e={...s.selSprints};d.forEach((t=>delete e[t])),t.selSprints=e,s.selSprints=e}return s}(this.props.settings,e,t));this.props.setStateValue(e),await this.$config.saveSettings("reports_WorklogReport",s),this.props.fillSprintList(),this.onHide(s)},this.handleOnChange=(e,t)=>{this.setState({allSettings:e,modifiedSettings:t})},this.style={width:"85vw",maxWidth:"900px"},(0,te.f3)(this,"ConfigService"),this.className="no-padding",this.state={showDialog:!0,modifiedSettings:{},allSettings:e.settings}}getFooter(){return(0,S.jsx)(b.zx,{icon:"fa fa-floppy-o",label:"Done",onClick:this.onDone})}render(){return super.renderBase((0,S.jsx)(Ct,{settings:this.props.settings,onChange:this.handleOnChange}))}}const Dt=$e(bt,(e=>({settings:e})),{fillSprintList:function(e,t){return function(){e(Ue(t()))}},setStateValue:Ke});const $t=$e((function(e){let{isSprint:t,groupIndex:s,issue:a,user:o,uid:r,sprintsList:i,costView:l,timeExportFormat:n,convertSecs:d,formatTime:c,addNewWorklog:h,fields:{hideEstimate:p},additionalCols:m}=e;return(0,S.jsxs)("tr",{className:"auto-wrap","data-row-id":"ticket","data-current-user":o.isCurrentUser?"1":"0","data-test-id":a.ticketNo,children:[(0,S.jsx)(Ut,{issue:a,showParentSummary:!1,hideEstimate:p,convertSecs:d}),null===m||void 0===m?void 0:m.map((e=>{var t;let{key:s,Component:o,props:r}=e;return(0,S.jsx)(o,{value:null===(t=a.fields)||void 0===t?void 0:t[s],...r},s)})),t&&i.map((e=>{let{id:o}=e;return(0,S.jsx)(Wt,{convertSecs:d,groupIndex:s,costView:l,sprintId:o,uid:r,formatTime:c,ticketNo:a.ticketNo,isSprint:t,timeExportFormat:n,addNewWorklog:h},o)})),!t&&(0,S.jsx)(Wt,{convertSecs:d,groupIndex:s,timeExportFormat:n,uid:r,formatTime:c,ticketNo:a.ticketNo,isSprint:t,costView:l,addNewWorklog:h}),t&&l&&(0,S.jsx)("td",{children:a.allSprintTotalCost}),t&&!l&&(0,S.jsx)("td",{children:d(a.allSprintTotalHours)})]})}),(e=>{let{fields:t}=e;return{fields:t}}),null,["UserUtilsService",e=>{let{$userutils:{formatTime:t}}=e;return{formatTime:t}}]),Wt=$e((function(e){let{costView:t,dates:s,timeExportFormat:a,breakupMode:o,ticket:r,user:i,disableAddingWL:l,addNewWorklog:n,convertSecs:d,formatTime:c}=e;const h=(e,t)=>e&&0!==e.length?e.map((e=>`${c(e.logTime)} (${d(e.totalHours)})${t?`, Cost: ${e.totalCost}`:""} - ${e.comment||"(no comment provided)"}`)).join(";\n"):"";return t?(0,S.jsxs)(S.Fragment,{children:[s.map(((e,s)=>(0,S.jsx)("td",{className:"day-wl-block","data-test-id":e.prop,exportType:"float",children:(0,S.jsx)("span",{title:h(r.logs[e.prop],t),children:It(r.logs[e.prop])})},s))),(0,S.jsx)("td",{"data-test-id":"total",exportType:"float",children:r.totalCost})]}):(0,S.jsxs)(S.Fragment,{children:[s.map(((e,t)=>(0,S.jsx)(Lt,{timeExportFormat:a,disableAddingWL:l,breakupMode:o,addNewWorklog:n,convertSecs:d,user:i,getComments:h,formatTime:c,day:e,issue:r},t))),(0,S.jsx)("td",{exportType:a,"data-test-id":"total",children:d(r.totalHours)})]})}),((e,t)=>{var s;let{isSprint:a,groupIndex:o,sprintId:r,uid:i,ticketNo:l}=t;const{breakupMode:n,disableAddingWL:d,[a?`groupReport_${r}`:"groupReport"]:{dates:c,groupedData:{[o]:{usersMap:{[i]:h}}}}}=e;return{breakupMode:n,dates:c,user:h,disableAddingWL:d,ticket:(null===h||void 0===h||null===(s=h.ticketsMap)||void 0===s?void 0:s[l])||{}}}));function Ut(e){let{issue:t,showParentSummary:s,hideEstimate:a,convertSecs:o}=e;const r=o(t.originalestimate),i=o(t.remainingestimate),l=o(t.totalLogged)||0,n=(t.estVariance>0?"+":"")+(o(t.estVariance)||(t.originalestimate>0?0:"NA")),d=`Original Estimate: ${r||0}\nRemaining: ${i||0}\nTotal Logged: ${l}\nEstimate Variance: ${n}`;return(0,S.jsxs)("td",{className:"data-left",children:[(0,S.jsxs)("div",{className:"wl-ticket-detail",title:t.summary,children:[(0,S.jsx)(b.Ee,{src:t.iconUrl,title:t.issueType}),!s&&t.parent&&(0,S.jsxs)(b.rU,{href:t.parentUrl,className:"link",children:[t.parent," - "]}),(0,S.jsx)(b.rU,{href:t.url,className:"link",children:t.ticketNo})," -",(0,S.jsx)("span",{children:t.summary})]}),!a&&!(!r&&!i)&&(0,S.jsxs)("span",{className:"estimate",title:d,children:["(est: ",r||0," / rem: ",i||0," / log: ",l," / var: ",n,")"]})]})}function Lt(e){let{issue:t,user:s={},day:a,timeExportFormat:o,breakupMode:r,disableAddingWL:i,getComments:l,addNewWorklog:n,formatTime:d,convertSecs:c}=e;const{logs:h={}}=t,p=h[a.prop];return(0,S.jsxs)("td",{className:"day-wl-block"+(a.isHoliday?null!==p&&void 0!==p&&p.length?" log-high":" col-holiday":""),exportType:o,"data-test-id":a.prop,children:[(null===s||void 0===s?void 0:s.isCurrentUser)&&!0!==i&&(0,S.jsx)("span",{className:"fa fa-clock-o add-wl",title:"Click to add worklog",onClick:()=>n(t.ticketNo,a)}),"2"!==r&&(0,S.jsx)("span",{title:l(p),children:c(Et(p))}),"2"===r&&(0,S.jsxs)("div",{children:[" ",function(e){if(Array.isArray(e)&&e.length>0){const t=e.length>1?";":"";return e.map(((e,s)=>(0,S.jsx)("span",{title:`${d(e.logTime)} - ${e.comment}`,children:c(e.totalHours)+t},s)))}}(p)]})]})}function Et(e){return e&&0!==e.length?e.sum((e=>e.totalHours)):""}function It(e){return e&&0!==e.length?e.sum((e=>e.totalCost)):""}function Mt(e){return e.imageUrl||e.avatarUrls["48x48"]||e.avatarUrls["32x32"]}const Ft=$e((function(e){let{isSprint:t,groupIndex:s,boardId:a,user:r,user:i,colSpan:l,additionalCols:n,userDisplayFormat:d,sprintsList:c,costView:h,expanded:p,uid:m,timeExportFormat:u,convertSecs:g,addWorklog:f,toggleUserExpanded:x}=e;const y="1"!==d,k=(0,o.useCallback)((e=>{e.nativeEvent.srcElement.classList.contains("add-wl")||x(a,s,m)}),[a,s,m,x]),j=(0,o.useCallback)(((e,t)=>{var s;const{date:a,prop:o}=t;f(r,e,a,null===(s=r.total)||void 0===s?void 0:s[o])}),[r,f]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("tr",{className:"pointer auto-wrap",onClick:k,"data-current-user":i.isCurrentUser?"1":"0","data-row-id":"user",children:[(0,S.jsx)("td",{className:"data-left",colSpan:l,children:(0,S.jsxs)("div",{className:y?"user-info":"user-info-min",style:{paddingLeft:0},children:[(0,S.jsx)("i",{className:"pull-left drill-down fa "+(p?"fa-chevron-circle-down":"fa-chevron-circle-right"),title:"Click to toggle ticket details"}),y&&(0,S.jsx)("img",{src:Mt(i),height:40,width:40,className:"pull-left",alt:i.displayName}),(0,S.jsx)("span",{className:"name",children:i.displayName}),y&&(0,S.jsxs)("span",{className:"email",children:["(",i.emailAddress||i.name,i.timeZone&&(0,S.jsxs)("span",{children:[", time zone: ",i.timeZone]}),")"]})]})}),t&&c.map((e=>{let{id:t}=e;return(0,S.jsx)(Pt,{sprintId:t,uid:m,boardId:a,convertSecs:g,groupIndex:s,costView:h,timeExportFormat:u,addNewWorklog:j},t)})),!t&&(0,S.jsx)(Pt,{uid:m,convertSecs:g,groupIndex:s,costView:h,timeExportFormat:u,addNewWorklog:j}),t&&h&&(0,S.jsx)("td",{exportType:"float",children:i.allSprintTotalCost}),t&&!h&&(0,S.jsx)("td",{exportType:u,children:g(i.allSprintTotalHours)})]}),p&&(0,S.jsx)(Rt,{isSprint:t,groupIndex:s,boardId:a,uid:m,user:i,costView:h,sprintsList:c,addNewWorklog:j,convertSecs:g,timeExportFormat:u,additionalCols:n})]})}),((e,t)=>{let{boardId:s,groupIndex:a,user:o}=t;const{userDisplayFormat:r,timeframeType:i,userExpnState:l}=e,n="1"===i,d=(0,v.vW)(o),c={isSprint:n,userDisplayFormat:r,uid:d,expanded:!!l[`${s}_${a}_${d}`]};return n&&(c.sprintsList=e[`sprintsList_${s}`]),c}),{addWorklog:function(e){const{$session:{CurrentUser:{maxHours:t}}}=(0,g.f3)("SessionService"),s=60*(t||8)*60;return function(t,a,o,r){let l=(s||0)-(r||0);l<60&&(l="01:00"),i()(o).isSame(i()(),"day")&&(o=new Date),e({showWorklogPopup:!0,worklogItem:{ticketNo:a,dateStarted:o,timeSpent:l}})}},convertSecs:Qe,toggleUserExpanded:function(e,t){return function(s,a,o){const r={...t("userExpnState")},i=`${s}_${a}_${o}`,{[i]:l}=r;l?delete r[i]:r[i]=!0,e({userExpnState:r})}}}),Pt=$e((function(e){let{costView:t,dates:s,user:a,timeExportFormat:o,addNewWorklog:r,convertSecs:i,maxHours:l,rIndicator:n,disableAddingWL:d}=e;return t?(0,S.jsxs)(S.Fragment,{children:[s.map(((e,t)=>(0,S.jsx)("td",{className:`${a.logClass[e.prop]} day-wl-block`,"data-test-id":e.prop,exportType:"float",children:a.totalCost[e.prop]},t))),(0,S.jsx)("td",{"data-test-id":"total",exportType:"float",children:a.grandTotalCost})]}):(0,S.jsxs)(S.Fragment,{children:[s.map(((e,t)=>(0,S.jsxs)("td",{className:`${a.logClass[e.prop]} day-wl-block`,exportType:o,"data-test-id":e.prop,children:[a.isCurrentUser&&!0!==d&&(0,S.jsx)("span",{className:"fa fa-clock-o add-wl",title:"Click to add worklog",onClick:()=>r(null,e)}),i(a.total[e.prop]),"1"===n&&(0,S.jsx)(re,{value:a.total[e.prop],maxHours:l})]},t))),(0,S.jsx)("td",{exportType:o,"data-test-id":"total",children:i(a.grandTotal)})]})}),((e,t)=>{let{sprintId:s,groupIndex:a,uid:o}=t;const{timeframeType:r,["1"===r?`groupReport_${s}`:"groupReport"]:{dates:i,groupedData:l},maxHours:n,rIndicator:d,disableAddingWL:c}=e;return{dates:i,group:l,maxHours:n,rIndicator:d,disableAddingWL:c,user:l[a].usersMap[o]||{logClass:{},total:{},totalCost:{}}}}));function Rt(e){let{user:t,isSprint:s,groupIndex:a,sprintsList:o,uid:r,timeExportFormat:i,addNewWorklog:l,convertSecs:n,costView:d,additionalCols:c}=e;return t.tickets.map(((e,h)=>(0,S.jsx)($t,{isSprint:s,groupIndex:a,issue:e,user:t,uid:r,addNewWorklog:l,sprintsList:o,timeExportFormat:i,convertSecs:n,costView:d,additionalCols:c},h)))}const At=$e((function(e){let{group:t,index:s,dates:a,sprintsList:r,convertSecs:i,isSprint:l,boardId:n,costView:d,timeExportFormat:c,additionalCols:h}=e;const[p,m]=(0,o.useState)(!1),u=(0,o.useCallback)((()=>m((e=>!e))),[m]),g=((null===h||void 0===h?void 0:h.length)||0)+1;return(0,S.jsxs)(S.Fragment,{children:[!p&&!t.isDummy&&(0,S.jsxs)("tr",{className:"grouped-row left",title:"Click to hide user details",children:[(0,S.jsxs)("td",{colSpan:l?g:(null===a||void 0===a?void 0:a.length)+1+g,onClick:u,children:[(0,S.jsx)("i",{className:"pull-left drill-down fa fa-chevron-circle-down"}),t.name]}),l&&t.sprints.map(((e,t)=>e.days<=999?(0,S.jsx)("td",{colSpan:e.days+1,children:e.name},t):(0,S.jsxs)(o.Fragment,{children:[(0,S.jsx)("td",{colSpan:1e3,className:"total-field",children:e.name}),(0,S.jsx)("td",{colSpan:e.days-999})]},t)))]}),!p&&t.users.map(((e,t)=>(0,S.jsx)(Ft,{groupIndex:s,index:t,colSpan:g,user:e,timeExportFormat:c,boardId:n,costView:d,additionalCols:h},t))),!t.isDummy&&(0,S.jsxs)("tr",{className:"grouped-row right auto-wrap",onClick:p?u:null,children:[(0,S.jsxs)("td",{colSpan:g,children:[p&&(0,S.jsxs)("div",{children:[(0,S.jsx)("i",{className:"pull-left drill-down fa fa-chevron-circle-right",title:"Click to show user details"}),(0,S.jsx)("span",{className:"pull-left",children:t.name}),(0,S.jsxs)("span",{className:"pull-right",children:["Total ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})]})]}),!p&&(0,S.jsxs)("div",{children:[t.name," ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})," Total ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})]})]}),l&&r.map((e=>{let{id:t}=e;return(0,S.jsx)(Ht,{sprintId:t,boardId:n,convertSecs:i,timeExportFormat:c,costView:d,groupIndex:s},t)})),!l&&(0,S.jsx)(Ht,{convertSecs:i,timeExportFormat:c,costView:d,groupIndex:s}),l&&d&&(0,S.jsx)("td",{exportType:"float",children:t.grandTotalCost}),l&&!d&&(0,S.jsx)("td",{exportType:c,children:i(t.grandTotalHours)})]})]})}),((e,t)=>{let{boardId:s}=t;const a="1"===e.timeframeType;if(a){const{[`sprintsList_${s}`]:t}=e;return{isSprint:a,sprintsList:t}}{const{groupReport:{dates:t}}=e;return{isSprint:a,dates:t}}}),{convertSecs:Qe}),Ht=$e((function(e){let{group:t,costView:s,dates:a,timeExportFormat:o,convertSecs:r}=e;return s?(0,S.jsxs)(S.Fragment,{children:[a.map(((e,s)=>(0,S.jsx)("td",{className:e.isHoliday?t.totalCost[e.prop]?"log-high":"col-holiday":"",exportType:"float",children:t.totalCost[e.prop]},s))),(0,S.jsx)("td",{exportType:"float",children:t.grandTotalCost})]}):(0,S.jsxs)(S.Fragment,{children:[a.map(((e,s)=>(0,S.jsx)("td",{className:e.isHoliday?t.total[e.prop]?"log-high":"col-holiday":"",exportType:o,children:r(t.total[e.prop])},s))),(0,S.jsx)("td",{exportType:o,children:r(t.grandTotal)})]})}),((e,t)=>{let{sprintId:s,groupIndex:a}=t;const{timeframeType:o,["1"===o?`groupReport_${s}`:"groupReport"]:{dates:r,groupedData:i}}=e;return{dates:r,group:i[a]}}));const Vt=$e((function(e){let{boardId:t,isSprint:s,groupedData:a,additionalCols:o,sprintsList:r,logFormat:i,costView:l,rIndicator:n}=e;const d=((null===o||void 0===o?void 0:o.length)||0)+1,c="2"===i?"float":void 0,h=a.map(((e,s)=>(0,S.jsx)(At,{index:s,boardId:t,additionalCols:o,group:e,timeExportFormat:c,costView:l},s)));return(0,S.jsxs)(se.XP,{className:"2"!==n?"no-log-bg-hl":"",children:[h,a.length>1&&(0,S.jsxs)("tr",{className:"grouped-row right auto-wrap",children:[(0,S.jsxs)("td",{colSpan:d,children:["Grand Total ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})]}),s&&(null===r||void 0===r?void 0:r.map((e=>{let{id:t}=e;return(0,S.jsx)(Bt,{sprintId:t,timeExportFormat:c,costView:l},t)}))),!s&&(0,S.jsx)(Bt,{timeExportFormat:c,costView:l})]})]})}),((e,t)=>{let{boardId:s}=t;const a="1"===e.timeframeType;if(a){const{[`userGroup_${s}`]:t,[`sprintsList_${s}`]:o,logFormat:r,rIndicator:i}=e;return{isSprint:a,sprintsList:o,groupedData:t,logFormat:r,rIndicator:i}}{const{groupReport:{groupedData:t},logFormat:s,rIndicator:a}=e;return{groupedData:t,logFormat:s,rIndicator:a}}})),Bt=$e((function(e){let{groupedData:t,dates:s,timeExportFormat:a,costView:o,convertSecs:r}=e;return o?(0,S.jsxs)(S.Fragment,{children:[s.map(((e,s)=>(0,S.jsx)("td",{className:e.isHoliday?t.totalCost[e.prop]?"log-high":"col-holiday":"",exportType:"float",children:t.totalCost[e.prop]},s))),(0,S.jsx)("td",{exportType:"float",children:t.grandTotalCost})]}):(0,S.jsxs)(S.Fragment,{children:[s.map(((e,s)=>(0,S.jsx)("td",{className:e.isHoliday?t.total[e.prop]?"log-high":"col-holiday":"",exportType:a,children:r(t.total[e.prop])},s))),(0,S.jsx)("td",{exportType:a,children:r(t.grandTotal)})]})}),((e,t)=>{let{sprintId:s}=t;const a="1"===e.timeframeType,{[a?`groupReport_${s}`:"groupReport"]:{dates:o,groupedData:r}}=e;return{dates:o,groupedData:r}}),{convertSecs:Qe});const Ot=$e((function(e){let{useSprint:t,sprintsList:s,additionalCols:a,costView:r}=e;const i=((null===a||void 0===a?void 0:a.length)||0)+1;return(0,S.jsxs)(se.Et,{children:[(0,S.jsxs)("tr",{className:"data-center pad-min auto-wrap",children:[(0,S.jsx)("th",{style:{minWidth:260+120*i},rowSpan:i>1?1:2,colSpan:i,children:"User Details"}),t&&s.map((e=>(0,S.jsxs)(o.Fragment,{children:[(0,S.jsx)(Zt,{sprint:e}),(0,S.jsx)("th",{rowSpan:2,children:"Sprint Total"})]},e.id))),!t&&(0,S.jsx)(Zt,{}),!r&&(0,S.jsx)("th",{style:{minWidth:50,maxWidth:100},rowSpan:2,children:"Total Hours"}),r&&(0,S.jsx)("th",{style:{minWidth:50,maxWidth:100},rowSpan:2,children:"Total Cost"})]}),(0,S.jsxs)("tr",{className:"pad-min auto-wrap",children:[i>1&&(0,S.jsx)("th",{style:{minWidth:380},children:"Issue details"}),null===a||void 0===a?void 0:a.map((e=>(0,S.jsx)("th",{children:e.name},e.key))),t&&s.map((e=>{let{id:t}=e;return(0,S.jsx)(Gt,{sprintId:t},t)})),!t&&(0,S.jsx)(Gt,{})]})]})}),((e,t)=>{let{boardId:s}=t;const{selSprints:a,timeframeType:o}=e,r="1"===o;return{useSprint:r,board:r?a[s]:void 0,sprintsList:r?e[`sprintsList_${s}`]:void 0}})),Zt=$e((function(e){let{weeks:t}=e;return t.map(((e,t)=>(0,S.jsx)("th",{className:"week-head",colSpan:e.days,children:e.display},t)))}),((e,t)=>{let{sprint:s}=t;const{[s?`groupReport_${s.id}`:"groupReport"]:{weeks:a}}=e;return{weeks:a}})),Gt=$e((function(e){let{dates:t}=e;return t.map(((e,t)=>(0,S.jsxs)("th",{"data-test-id":e.prop,className:"day-head"+(e.isHoliday?" holiday":""),children:[e.dateNum,(0,S.jsx)("br",{}),(0,S.jsx)("span",{className:"day-name",children:e.day})]},t)))}),((e,t)=>{let{sprintId:s}=t;const{[s?`groupReport_${s}`:"groupReport"]:{dates:a}}=e;return{dates:a}}));const _t=$e((function(e){let{boardId:t,fields:s,exportSheetName:a,costView:r}=e;const{optional:i,daywiseFields:l}=s||{},n=(0,o.useMemo)((()=>null===i||void 0===i?void 0:i.filter((e=>null===l||void 0===l?void 0:l[e.key])).map((e=>({...e,...(0,z.ph)(e.type)})))),[i,l]);return(0,S.jsxs)(se.TT,{className:"table-bordered",exportSheetName:a,children:[(0,S.jsx)(Ot,{additionalCols:n,boardId:t}),(0,S.jsx)(Vt,{additionalCols:n,boardId:t,costView:r})]})}),(e=>{let{fields:t}=e;return{fields:t}})),zt=["-originalestimate","-totalLogged","-remainingestimate","-estVariance"],qt=(e,t)=>e&&(0,S.jsx)(w.Z,{href:t,className:"link",children:e});const Xt=$e((function(e){let{exportSheetName:t,getColumnSettings:s,flatGridSettingsChanged:a,flatWorklogs:r,hideEstimate:i,flatTableSettings:l,flatTableSettings:{groupBy:n,groupFoldable:d,displayColumns:c,sortField:h,isDesc:p}={displayColumns:i?zt:null},onSettingsChanged:m}=e;const[u]=(0,o.useState)((()=>s(qt))),g=(0,o.useRef)();return(0,o.useEffect)((()=>{l&&g.current&&m(),g.current=!0}),[l]),u&&r?(0,S.jsx)(_.Z,{className:"flat-data-grid",dataset:r,exportSheetName:t,columns:u,allowSorting:!0,onChange:a,displayColumns:c,groupBy:n,groupFoldable:d,sortField:h,isDesc:p,noRowsMessage:"No worklog details available"}):null}),((e,t)=>{let{boardId:s}=t;const{[s?`flatWorklogs_${s}`:"flatWorklogs"]:a,fields:{hideEstimate:o},flatTableSettings:r}=e;return{flatWorklogs:a,hideEstimate:o,flatTableSettings:r}}),{getColumnSettings:function(e,t){const s=Qe(0,t),{$userutils:{formatDateTime:a,formatDate:o}}=(0,g.f3)("UserUtilsService"),r={datetime:{format:e=>a(e)},date:{format:e=>o(e)}};return function(e){const{userListMode:o,timeframeType:i,fields:{optional:l=[]}={}}=t(),n="2"===o,d="1"===i,c="1"===t("logFormat")?"string":"number",h=l.map((e=>{if(tt.includes(e.key)||"timespent"===e.type)return null;const t={field:`fields.${e.key}`,displayText:e.name,type:e.type,...r[e.type]};if(et.includes(e.type))return t;const{Component:s,props:a}=(0,z.ph)(e.type);return t.viewComponent=s,t.props=a,t}));return[n&&{field:"groupName",displayText:"Group Name",type:"string"},d&&{field:"sprintName",displayText:"Sprint Name",type:"string"},{field:"projectName",displayText:"Project Name",type:"string"},{field:"issueType",displayText:"Issue Type",type:"string"},{field:"epicDisplay",displayText:"Epic",type:"string",format:(t,s)=>e(t,s.epicUrl)},{field:"parent",displayText:"Parent",type:"string",format:(t,s)=>e(t,s.parentUrl)},{field:"ticketNo",displayText:"Ticket No",type:"string",format:(t,s)=>e(t,s.ticketUrl)},{field:"statusName",displayText:"Status",type:"string"},{field:"summary",displayText:"Summary",type:"string"},{field:"logTime",displayText:"Log Date & Time",type:"datetime",format:e=>a(e)},{field:"logCreated",displayText:"Worklog Created",type:"datetime",format:e=>a(e)},{field:"logUpdated",displayText:"Worklog Updated",type:"datetime",format:e=>a(e)},{field:"userDisplay",displayText:"Log user",type:"string"},{field:"assignee",displayText:"Assignee",type:"string"},{field:"reporter",displayText:"Reporter",type:"string"},{field:"timeSpent",displayText:"Hr. Spent",type:c,format:s},{field:"originalestimate",displayText:"Ori. Estm.",type:c,format:s},{field:"totalLogged",displayText:"Total Worklogs",type:c,format:s},{field:"remainingestimate",displayText:"Rem. Estm.",type:c,format:s},{field:"estVariance",displayText:"Estm. Variance",type:"string",format:e=>(e>0?"+":"")+s(e)},{field:"comment",displayText:"Comment"},{field:"fields.project.key",displayText:"Project Name test",type:"string"},...h].filter(Boolean)}},flatGridSettingsChanged:function(e){return function(t){e({flatTableSettings:t})}}}),Yt=$e((function(e){let{groups:t,flatWorklogs:s,exportSheetName:a,convertSecs:r,costView:i}=e;const[l,n]=(0,o.useState)(!1);if((0,o.useEffect)((()=>{n(function(e,t){const s=[],a={},o=t.groupBy((e=>e.username)).reduce(((e,t)=>(e[t.key]=t.values,e)),{});t.groupBy((e=>({key:e.projectKey,name:e.projectName}))).sortBy((e=>e.key.key)).forEach((e=>{let{key:t,values:o}=e;s.push(t),a[t.key]=o,t.issueTypes=o.distinct((e=>e.issueType))}));const r=e.map((e=>{const{name:t,users:r}=e,i={grandTotal:0,grandTotalCost:0,projects:{}},l={name:t,overallTotal:i};return l.users=r.map((e=>{const t=(0,v.vW)(e),{emailAddress:r,displayName:l}=e,n={name:t,emailAddress:r,displayName:l};n.projects=s.reduce(((s,o)=>{const r=i.projects[o.key]||{total:0,totalCost:0};i.projects[o.key]=r;const l=a[o.key];if(l){const a=l.filter((e=>e.username===t));if(a.length){const t=a.groupBy((e=>e.issueType)).reduce(((t,s)=>{const a=s.values.sum((e=>e.timeSpent))||0,o=(0,v.qN)(a,e.costPerHour);return t[s.key]={total:a,totalCost:o,logs:s.values},r[s.key]=(r[s.key]||0)+a,r[`${s.key}_Cost`]=(r[`${s.key}_Cost`]||0)+o,t}),{}),i=a.sum((e=>e.timeSpent));t.grandTotal={total:i,totalCost:(0,v.qN)(i,e.costPerHour),logs:a},r.total+=t.grandTotal.total||0,r.totalCost+=t.grandTotal.totalCost||0,s[o.key]=t}}return s}),{});const d=o[t]||[],c=d.sum((e=>e.timeSpent));return n.grandTotal={total:c,totalCost:(0,v.qN)(c,e.costPerHour),logs:d},i.grandTotal+=n.grandTotal.total,i.grandTotalCost+=n.grandTotal.totalCost,n})),l})),i=r.reduce(((e,t)=>{const{overallTotal:{grandTotal:a,grandTotalCost:o,projects:r}}=t;return e.grandTotal=(e.grandTotal||0)+a,e.grandTotalCost=(e.grandTotalCost||0)+o,s.forEach((t=>{const s=r[t.key]||{},a=e[t.key]||{total:0,totalCost:0};e[t.key]=a,a.total+=s.total||0,a.totalCost+=s.totalCost||0,t.issueTypes.forEach((e=>{a[e]=(a[e]||0)+(s[e]||0),a[`${e}_Cost`]=(a[`${e}_Cost`]||0)+(s[`${e}_Cost`]||0)}))})),e}),{grandTotal:0,grandTotalCost:0});return{projects:s,groupedData:r,grandTotal:i}}(t,s))}),[t,s]),!l)return(0,S.jsx)("span",{children:"Loading..."});const{projects:d,groupedData:c,grandTotal:h}=l,p=1===(null===c||void 0===c?void 0:c.length)&&!c[0].name;return(0,S.jsxs)(se.TT,{className:"table-bordered",dataset:c,exportSheetName:a,children:[(0,S.jsxs)(se.Et,{children:[(0,S.jsxs)(se.lE,{children:[!p&&(0,S.jsx)(se.sg,{rowSpan:2,children:"Group Name"}),(0,S.jsx)(se.sg,{rowSpan:2,children:"User Name"}),d.map((e=>(0,S.jsx)(se.sg,{colSpan:e.issueTypes.length+1,children:e.name},e.key))),(0,S.jsx)(se.sg,{rowSpan:2,children:"Grand Total"})]}),(0,S.jsx)(se.lE,{children:d.map(((e,t)=>(0,S.jsxs)(o.Fragment,{children:[e.issueTypes.map(((e,t)=>(0,S.jsx)(se.sg,{children:e},t))),(0,S.jsx)(se.sg,{children:"Total"})]},t)))})]}),(0,S.jsx)(se.XP,{children:(e,t)=>(0,S.jsx)(Jt,{group:e,projects:d,costView:i,convertSecs:r,hideGroup:p},t)}),!p&&(0,S.jsx)(Kt,{grandTotal:h,projects:d,costView:i,convertSecs:r})]})}),((e,t)=>{let{boardId:s}=t;const{[s?`flatWorklogs_${s}`:"flatWorklogs"]:a,groupReport:{groupedData:o}}=e;return{flatWorklogs:a,groups:o}}),{convertSecs:Qe}),Jt=(0,o.memo)((function(e){let{hideGroup:t,projects:s,costView:a,group:r,convertSecs:i}=e;return(0,S.jsxs)(o.Fragment,{children:[r.users.map(((e,l)=>(0,S.jsxs)("tr",{children:[!t&&0===l&&(0,S.jsx)("td",{rowSpan:r.users.length+1,children:r.name}),(0,S.jsx)("td",{children:e.displayName}),s.map(((t,s)=>{var r,l,n;const d=e.projects[t.key]||{};return(0,S.jsxs)(o.Fragment,{children:[!a&&t.issueTypes.map(((e,t)=>{const s=d[e];return(0,S.jsx)("td",{className:"data-center",exportType:"float",children:i(null===s||void 0===s?void 0:s.total)},t)})),!a&&(0,S.jsx)("td",{className:"strong data-center",exportType:"float",children:i(null===(r=d.grandTotal)||void 0===r?void 0:r.total)}),a&&t.issueTypes.map(((e,t)=>{const s=d[e];return(0,S.jsx)("td",{className:"data-center",exportType:"float",title:i(null===s||void 0===s?void 0:s.total),children:null===s||void 0===s?void 0:s.totalCost},t)})),a&&(0,S.jsx)("td",{className:"strong data-center",exportType:"float",title:i(null===(l=d.grandTotal)||void 0===l?void 0:l.total),children:null===(n=d.grandTotal)||void 0===n?void 0:n.totalCost})]},s)})),!a&&(0,S.jsx)("td",{className:"strong data-center",exportType:"float",children:i(e.grandTotal.total)}),a&&(0,S.jsx)("td",{className:"strong data-center",exportType:"float",title:i(e.grandTotal.total),children:e.grandTotal.totalCost})]},l))),(0,S.jsxs)("tr",{className:"strong data-center",children:[(0,S.jsxs)("td",{className:"data-right",children:["Group Total ",(0,S.jsx)("span",{className:"fa fa-arrow-right"})]}),s.map(((e,t)=>{const s=r.overallTotal.projects[e.key]||{};return a?(0,S.jsxs)(o.Fragment,{children:[e.issueTypes.map(((e,t)=>(0,S.jsx)("td",{exportType:"float",title:i(s[e]),children:s[`${e}_Cost`]},t))),(0,S.jsx)("td",{exportType:"float",title:i(s.total),children:s.totalCost})]},t):(0,S.jsxs)(o.Fragment,{children:[e.issueTypes.map(((e,t)=>(0,S.jsx)("td",{exportType:"float",children:i(s[e])},t))),(0,S.jsx)("td",{exportType:"float",children:i(s.total)})]},t)})),!a&&(0,S.jsx)("td",{exportType:"float",children:i(r.overallTotal.grandTotal)}),a&&(0,S.jsx)("td",{exportType:"float",title:i(r.overallTotal.grandTotal),children:r.overallTotal.grandTotalCost})]})]})})),Kt=(0,o.memo)((function(e){let{grandTotal:t,projects:s,costView:a,convertSecs:r}=e;return(0,S.jsx)("tfoot",{children:(0,S.jsxs)("tr",{className:"strong data-center",children:[(0,S.jsxs)("td",{colSpan:2,className:"data-right",children:["Grand total ",(0,S.jsx)("span",{className:"fa fa-arrow-right"})]}),!a&&s.map(((e,s)=>(0,S.jsxs)(o.Fragment,{children:[e.issueTypes.map(((s,a)=>(0,S.jsx)("td",{exportType:"float",children:r(t[e.key][s])},a))),(0,S.jsx)("td",{exportType:"float",children:r(t[e.key].total)})]},s))),!a&&(0,S.jsx)("td",{exportType:"float",children:r(t.grandTotal)}),a&&s.map(((e,s)=>(0,S.jsxs)(o.Fragment,{children:[e.issueTypes.map(((s,a)=>(0,S.jsx)("td",{exportType:"float",title:r(t[e.key][s]),children:t[e.key][`${s}_Cost`]},a))),(0,S.jsx)("td",{exportType:"float",title:r(t[e.key].total),children:t[e.key].totalCost})]},s))),a&&(0,S.jsx)("td",{exportType:"float",title:r(t.grandTotal),children:t.grandTotalCost})]})})}));var Qt=s(7922),es=s(9831);const ts=$e((function(e){let{flatData:t,groupField:s,isSprint:a,reportUserGrp:r}=e;const[i,l]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{l(t.groupBy((e=>e[s])))}),[t,s,l]),i?(0,S.jsxs)("div",{className:"worklog-visualization-tab",children:[i.length>1&&(0,S.jsx)(ss,{title:a?"All Sprints":"All Groups",data:t}),i.map((e=>(0,S.jsx)(ss,{title:e.key,data:e.values,reportUserGrp:r},e.key)))]}):(0,S.jsx)("span",{children:"Loading"})}),(function(e,t){let{boardId:s}=t;const a="1"===e.timeframeType,{[a?`flatWorklogs_${s}`:"flatWorklogs"]:o,reportUserGrp:r}=e;return{isSprint:a,flatData:o,groupField:a?"sprintName":"groupName",reportUserGrp:r}})),ss=function(e){let{title:t,data:s,reportUserGrp:a}=e;const r=[];"4"!==a&&r.push({title:"Epic Wise",groupField:"epicDisplay",legendTitle:"Epic summary",data:s}),"2"!==a&&r.push({title:"Project Wise",groupField:"projectName",legendTitle:"Projects",data:s}),"3"!==a&&r.push({title:"Issuetype Wise",groupField:"issueType",legendTitle:"Issue types",data:s}),r.push({title:"Status Wise",groupField:"statusName",legendTitle:"Statuses",data:s});const i=(0,o.useCallback)((e=>(0,S.jsx)(os,{...e})),[]);return(0,S.jsx)("div",{className:"group-wise-charts",children:(0,S.jsx)(es.l,{header:(0,S.jsx)("h3",{children:t}),value:r,itemTemplate:i})})};function as(e,t){let{title:s,legendTitle:a,totalTSDisplay:o}=t;return{maintainAspectRatio:!1,layout:{autoPadding:!1},plugins:{legend:{labels:{boxWidth:20,color:"#495057"},title:{text:a,display:!0},position:"right"},title:{display:!0,text:s,align:"center",font:{size:"16px",weight:"bold"}},tooltip:{mode:"index",intersect:!0,filter:e=>!!e.raw,callbacks:{label:t=>{let{dataIndex:s}=t;const{display:a,perc:o}=e[s];return`Timespent: ${a} (${o}%)`},footer:()=>`Total: ${o}`}}}}}function os(e){let{title:t,legendTitle:s,groupField:a,data:r}=e;const[i,l]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const{$utils:e}=(0,g.f3)("UtilsService"),o=r.sum("timeSpent"),i=r.groupBy((e=>e[a]||"(Unavailable)")).map((t=>{let{key:s,values:a}=t;const r=a.sum("timeSpent");return{label:s,total:r,display:e.formatSecs(r),perc:parseFloat((100*r/o).toFixed(2))}})),n={labels:i.map((e=>{let{label:t}=e;return t})),datasets:[{data:i.map((e=>{let{total:t}=e;return t}))}]};l({chartData:n,chartOptions:as(i,{title:t,legendTitle:s,totalTimeSpent:o,totalTSDisplay:e.formatSecs(o)})})}),[r,a,t,s,l]),i?(0,S.jsx)("div",{className:"chart-container",children:(0,S.jsx)(Qt.Chart,{type:"pie",data:i.chartData,options:i.chartOptions})}):(0,S.jsx)("span",{children:"Loading"})}const rs=(0,S.jsx)("div",{className:"pad-15",children:"Loading... please wait while the report is being loaded. It may take few seconds / minute based on the range/filters you had selected."}),is=(0,S.jsx)("div",{className:"pad-15",children:"No data available to display."});const ls=$e((function(e){let{selSprints:t,isLoading:s,useSprint:a,hasData:o,onSettingsChanged:r}=e;if(s)return rs;if(!o)return null;let i=null;if(a){const e=Object.keys(t).filter((e=>{var s;return null===(s=t[e])||void 0===s?void 0:s.selected}));e.length>1?i=(0,S.jsx)(ce.TabView,{className:"no-padding multi-view",renderActiveOnly:!1,children:e.map((e=>(0,S.jsx)(ce.TabPanel,{header:t[e].name,contentClassName:"no-padding",children:(0,S.jsx)(ns,{boardId:e,onSettingsChanged:r})})))}):e.length&&(i=(0,S.jsx)(ns,{boardId:e[0],onSettingsChanged:r}))}else i=(0,S.jsx)(ns,{onSettingsChanged:r});return(0,S.jsx)("div",{className:"worklog-report",children:i})}),(e=>{let{reportLoaded:t,timeframeType:s,selSprints:a}=e;return{hasData:t,useSprint:"1"===s,selSprints:a}})),ns=$e((function(e){let{boardId:t,hasData:s,showCostReport:a,showSummaryReport:o,onSettingsChanged:r}=e;return s?(0,S.jsxs)(ce.TabView,{className:"no-padding",renderActiveOnly:!1,children:[(0,S.jsx)(ce.TabPanel,{header:"Grouped - [User daywise]",contentClassName:"no-padding",children:(0,S.jsx)(_t,{exportSheetName:"Grouped - [User daywise]",boardId:t})}),a&&(0,S.jsx)(ce.TabPanel,{header:"Cost Report",contentClassName:"no-padding",children:(0,S.jsx)(_t,{exportSheetName:"Cost Report",boardId:t,costView:!0})}),(0,S.jsx)(ce.TabPanel,{header:"Flat (Groupable)",contentClassName:"no-padding",children:(0,S.jsx)(Xt,{exportSheetName:"Flat (Groupable)",boardId:t,onSettingsChanged:r})}),o&&(0,S.jsx)(ce.TabPanel,{header:"Summary - (User project wise)",contentClassName:"no-padding",children:(0,S.jsx)(Yt,{exportSheetName:"Summary (User project wise)",boardId:t})}),(0,S.jsx)(ce.TabPanel,{header:"Visualization",contentClassName:"no-padding",children:(0,S.jsx)(ts,{exportSheetName:"Visualization",boardId:t})})]}):is}),((e,t)=>{let{boardId:s}=t;const a="1"===e.timeframeType,{userListMode:o,reportUserGrp:r,fields:{showCostReport:i},[a?`sprintsList_${s}`:"groupReport"]:l}=e;return{hasData:!!l,showCostReport:i&&"2"===o,showSummaryReport:!a&&"1"===r}}));const ds=function(){return(0,S.jsxs)("div",{className:"pad-15",children:[(0,S.jsx)("strong",{children:"How to use:"}),(0,S.jsxs)("ul",{children:[(0,S.jsx)("li",{children:"By default this page lets you to generate worklog report based on the selected date range."}),(0,S.jsxs)("li",{children:["If you want to generate the report based on one or more sprints, click on ( ",(0,S.jsx)("i",{className:"fa fa-cogs"}),") icon to change the settings of the report."]}),(0,S.jsxs)("li",{children:["Click on ( ",(0,S.jsx)("i",{className:"fa fa-cogs"}),") icon to change multiple other settings of the report like formating of display, add additional columns, setting threshold date to filter worklogs, JQL to filter data, etc.."]}),(0,S.jsxs)("li",{children:["Choose a date or sprint for which you would like to view the report or click the refresh ( ",(0,S.jsx)("i",{className:"fa fa-refresh"})," ) icon to load the report if date or sprint is already selected."]}),(0,S.jsxs)("li",{children:["You can choose the list of users by clicking the ( ",(0,S.jsx)("i",{className:"fa fa-users"})," ) icon."]}),(0,S.jsxs)("li",{children:["Click on Settings ",(0,S.jsx)("i",{className:"fa fa-arrow-right"})," User groups from left hand menu to add users permanently to a group and use it in future."]}),(0,S.jsx)("li",{children:"Time zone settings - Configure the time zone of each user & group properly while adding in group and select appropriate option in settings as well."}),(0,S.jsxs)("li",{children:["You have additional settings affecting this report in Settings ",(0,S.jsx)("i",{className:"fa fa-arrow-right"}),"General menu in left hand side."]})]}),(0,S.jsxs)("p",{children:[(0,S.jsx)("strong",{children:"Note:"})," Any changes you make to the group or the users under the group in this page will not get saved and is only for this session."]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("strong",{children:"What is new?"}),(0,S.jsxs)("ul",{children:[(0,S.jsx)("li",{children:"Viewing report based on sprint as an alternate option instead of date range selection"}),(0,S.jsx)("li",{children:"Option to eliminate or identify the worklogs created after the threshold date"}),(0,S.jsx)("li",{children:"Options to pull the report without specifiying the user group"}),(0,S.jsx)("li",{children:"Options to all worklog on a project"}),(0,S.jsx)("li",{children:"Automatically group the users & worklog based on project, epic or issuetype when worklog is pulled based on date range"})]})]})]})};class cs extends u.ZP{constructor(e){super(e,"Worklog Report","fa-clock-o"),this.showSettings=()=>this.setState({showSettings:!0}),this.settingsChanged=()=>this.setState({showSettings:!1}),this.showGroups=()=>this.setState({showGroupsPopup:!0}),this.hideGroups=e=>{this.props.groupsChanged(e),this.setState({showGroupsPopup:!1}),this.props.isGadget&&this.saveSettings()},this.refreshData=()=>{this.selSprints=this.props.selSprints,this.dateRange=this.props.dateRange,this.props.fetchData()},this.inputChanged=()=>{this.selSprints===this.props.selSprints&&this.dateRange===this.props.dateRange||(this.saveSettings(),this.refreshData())},this.saveSettings=async()=>{const{isGadget:e}=this.props,t=this.props.getSettingsToStore({incUserGroups:e});e?(this.settings={...this.settings,reportSettings:t},super.saveSettings()):await this.$config.saveSettings("reports_WorklogReport",t)},(0,g.f3)(this,"ConfigService"),this.selSprints=e.selSprints}UNSAFE_componentWillReceiveProps(e){const{isLoading:t}=e;this.setState({isLoading:t}),super.UNSAFE_componentWillReceiveProps(e)}renderCustomActions(){return(0,S.jsxs)(S.Fragment,{children:[!this.state.showSettings&&(0,S.jsx)(nt,{onInputChanged:this.inputChanged,showGroupsPopup:this.showGroups}),(0,S.jsx)(b.zx,{icon:"fa fa-cogs",onClick:this.showSettings,title:"Show settings"})]})}render(){const{showWorklogPopup:e,worklogItem:t,worklogAdded:s,hideWorklog:a,userGroups:o,reportLoaded:r}=this.props,{showSettings:i,showGroupsPopup:l,isLoading:n}=this.state;return super.renderBase((0,S.jsxs)("div",{className:"worklog-report-container",children:[i&&(0,S.jsx)(Dt,{onHide:this.settingsChanged}),l&&(0,S.jsx)(de.Z,{groups:o,onHide:this.hideGroups}),!r&&!n&&(0,S.jsx)(ds,{}),r&&(0,S.jsx)(ls,{isLoading:n,onSettingsChanged:this.saveSettings}),e&&(0,S.jsx)(k.Z,{worklog:t,onDone:s,onHide:a,uploadImmediately:!0})]}))}}const hs=De(cs,(e=>{let{selSprints:t,dateRange:s,loadingData:a,reportLoaded:o,showWorklogPopup:r,worklogItem:i,userGroups:l}=e;return{selSprints:t,dateRange:s,isLoading:a,reportLoaded:o,showWorklogPopup:r,worklogItem:i,userGroups:l}}),{fetchData:function(e,t){return async function(){const{timeframeType:s}=t();"1"===s?await function(e,t){return async function(){const s=t(),{selSprints:a,sprintStartRounding:o,sprintEndRounding:r,daysToHide:l,timeZone:n}=s,d=Object.keys(a).filter((e=>{var t;return null===(t=a[e])||void 0===t?void 0:t.selected}));if(!d.length)return;const{$jira:c,$session:{CurrentUser:{name:h}}}=(0,g.f3)("JiraService","SessionService"),p={loadingData:!1,errorTitle:"",errorMessage:""};try{e({loadingData:!0,reportLoaded:!1});const t=await c.getRapidSprintList(d,!0);for(const e of d){const d=qe(e,a,t);p[`sprintsList_${e}`]=d;const c=[],m={},u=[];p[`flatWorklogs_${e}`]=u;for(const e of d){const{id:t,startDate:a,endDate:d,completeDate:g=d,previousSprintEnd:f,nextSprintStart:x}=e,y=i()(a),k=i()(g),j={fromDate:y.toDate(),toDate:k.toDate(),timeZone:n,daysToHide:l};"2"===o?j.fromDate=y.startOf("day").toDate():"3"===o?j.fromDate=y.startOf("day").add(1,"days").toDate():"4"===o&&f&&f instanceof Date&&(j.fromDate=i()(new Date(f)).add(1,"seconds").toDate()),"2"===r?j.toDate=k.endOf("day").toDate():"3"===r?j.toDate=k.endOf("day").add(-1,"days").toDate():"4"===r&&x&&x instanceof Date&&(j.toDate=i()(new Date(x)).add(-1,"seconds").toDate());const{issues:w,epicDetails:S}=await Xe(t,j.fromDate,j.toDate,s);if(!w.length){p[`groupReport_${t}`]=null;continue}const{userwiseLog:N,userwiseLogArr:T}=Re(w,i()(j.fromDate),i()(j.toDate),null===h||void 0===h?void 0:h.toLowerCase(),s,S),{groupReport:C,flatWorklogs:b}=Ye(e,N,j,s);u.addRange(b),p[`groupReport_${t}`]=C,T.forEach((e=>{const t=(0,v.vW)(e,!0);m[t]||(c.push(e),m[t]=!0)})),e.settings=j}p[`userGroup_${e}`]=ze(d,p,c,s)}p.reportLoaded=!0}catch(f){var m,u;console.error("Error pulling sprint report:",f);const{$message:t}=(0,g.f3)("MessageService"),s=f.message||(null===(m=f.error)||void 0===m||null===(u=m.errorMessages)||void 0===u?void 0:u[0])||"Unknown error. Check the console for more details",a=f.message?"Worklog report":"Unknown error";e({errorTitle:a,errorMessage:s}),t.error(s,a)}finally{e(p)}}}(e,t)():await Be(e,t)()}},setStateValue:Ke,worklogAdded:function(e){return function(){e({showWorklogPopup:!1,worklogItem:null})}},hideWorklog:function(e){return function(){e({showWorklogPopup:!1,worklogItem:null})}},getSettingsToStore:function(e,t){return function(e){return We(t(),e)}},groupsChanged:function(e){return function(t){t&&Array.isArray(t)&&e({userGroups:t})}}},null,(e=>{let{isGadget:t,settings:s}=e,a=null;if(t)a=null===s||void 0===s?void 0:s.reportSettings;else{const{$session:e}=(0,g.f3)("SessionService");a=e.pageSettings.reports_WorklogReport}return async function(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{$session:a,$usergroup:o}=(0,te.f3)("SessionService","UserGroupService"),{maxHours:r,projects:i,epicNameField:l,rapidViews:n}=a.CurrentUser,d=60*(r||8)*60,c=We(e);null===n||void 0===n||!n.length||null!==(t=c.sprintBoards)&&void 0!==t&&t.length||(c.sprintBoards=n);const h=Ue(c);return{userGroups:e.userGroups||await o.getUserGroups(),...c,...h,maxHours:d,projects:i,epicField:null===l||void 0===l?void 0:l.id,sprintBoardsFromSettings:n,...s}}(a||{})}));function ps(){return`#${Math.floor(16777215*Math.random()).toString(16)}`}function ms(e){const{$userutils:t}=(0,te.f3)("UserUtils");return{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{mode:"index",intersect:!0,filter:e=>!!e.raw,callbacks:{title:function(s){const a=s[0].parsed.x,o=e[a];return t.formatDate(o)},footer:e=>`Total: ${e.map((e=>{let{raw:t}=e;return t})).sum()} hours`}},legend:{title:{text:"Issues",fontColor:"red"},position:"bottom",labels:{color:"#495057"}}},scales:{x:{stacked:!0,ticks:{color:"#495057"},grid:{color:"#ebedef"},label:{display:!0,text:"Hours spent"}},y:{stacked:!0,ticks:{color:"#495057"},grid:{color:"#ebedef"},label:{display:!0,text:"Hours spent"}}}}}const us=function(e){let{lastUpdated:t,setLoader:s,settings:{dateRange:a}}=e;const[r,l]=(0,o.useState)();return(0,o.useEffect)((()=>{null!==a&&void 0!==a&&a.fromDate&&(null===s||void 0===s||s(!0),async function(e){const{fromDate:t,toDate:s}=e,{$utils:a}=(0,te.f3)("UtilsService"),o=await async function(e){const{$worklog:t}=(0,te.f3)("WorklogService"),s=await t.getWorklogs(e);if(!s.length)return;const{fromDate:a}=e,o=i()(a),r=s.groupBy((e=>e.ticketNo)).map((e=>{let{key:t,values:s}=e;const a=s.reduce(((e,t)=>{const s=Math.abs(o.diff(t.dateStarted,"days"));return e[s]=(e[s]||0)+t.totalMins,e}),[]).map((e=>e?e/60:0));return{label:t,backgroundColor:ps(),data:a}}));return r}(e);if(!o)return!1;const r=a.getDateArray(t,s),l=r[0].getMonth()===r[r.length-1].getMonth();return{data:{labels:r.map(l?e=>e.getDate():(e,t)=>0===t||1===e.getDate()?e.format("MMM dd"):e.getDate()),datasets:o},options:ms(r)}}(function(e){let{fromDate:t,toDate:s,...a}=e;return"string"===typeof t&&(t=i()(t).toDate()),"string"===typeof s&&(s=i()(s).toDate()),{fromDate:t,toDate:s,...a}}(a)).then(l).finally((()=>null===s||void 0===s?void 0:s(!1))))}),[a,t,l,s]),null!==a&&void 0!==a&&a.fromDate?r?(0,S.jsx)("div",{className:"worklog-bar-chart-gadget",children:(0,S.jsx)(Qt.Chart,{type:"bar",data:r.data,options:r.options})}):(0,S.jsx)("div",{className:"pad-15",children:"No worklog data available for the selected date range"}):(0,S.jsx)("div",{className:"pad-15",children:"Date range is not configured. Configure date range to visualize data"})};class gs extends u.ZP{constructor(e){super(e,"Worklog Bar Chart","fa-bar-chart"),this.refreshData=async()=>this.setState({lastUpdated:new Date}),this.dateSelected=e=>{this.settings.dateRange=e,e.toDate&&(this.refreshData(),e.auto||this.saveSettings())},(0,te.f3)(this,"WorklogService","UtilsService","MessageService")}executeEvent(e){e.type!==u.Xk.AddWorklog&&e.type!==u.Xk.DeletedWorklog&&e.type!==u.Xk.WorklogModified||this.refreshData()}renderCustomActions(){return(0,S.jsx)(b.Mt,{range:!0,value:this.settings.dateRange,onChange:this.dateSelected,style:{marginRight:"35px"}})}render(){var e;const{state:{isLoading:t,lastUpdated:s}}=this;return super.renderBase((0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(us,{lastUpdated:s,settings:this.settings,setLoader:this.setLoader}),(0,S.jsx)(F,{enabled:!t&&this.context.needReload,onChange:this.refreshData},null===(e=this.context.timerEntry)||void 0===e?void 0:e.key)]}))}}gs.contextType=I.a2;const fs=gs;class xs extends C.Z{constructor(e){super(e,"Add Bookmark"),this.addBookmark=()=>{const{ticketsList:e}=this.state;e.length>0?(this.setState({isLoading:!0}),this.$bookmark.addBookmark(e).then((t=>{0===t.length?this.onHide(!0):(this.setState({isLoading:!1,ticketsList:t}),e.length===t.length?this.$message.warning("None of the ticket numbers provided are valid."):e.length>t.length&&this.$message.warning("Some of the ticket numbers provided are not valid."))}))):this.onHide()},this.listChanged=e=>this.setState({ticketsList:e}),(0,te.f3)(this,"BookmarkService","MessageService"),this.style.width="380px",this.state.ticketsList=[]}getFooter(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.zx,{type:"primary",onClick:this.addBookmark,label:"Save",icon:"fa fa-save"}),(0,S.jsx)(b.zx,{type:"default",onClick:this.onHide,label:"Cancel",icon:"fa fa-times"})]})}render(){const{state:{ticketsList:e}}=this;return super.renderBase((0,S.jsxs)("div",{className:"pad-22",children:[(0,S.jsx)(b.yh,{value:e,onChange:this.listChanged,placeholder:"Enter one or more ticket numbers"}),(0,S.jsx)("strong",{children:"Note:"})," Press enter key to add multiple items"]}))}}const ys=xs;var ks=s(6552);class js extends u.ZP{constructor(e){super(e,"My Bookmarks","fa-bookmark"),this.refreshData=()=>{this.setState({isLoading:!0,showAddPopup:!1}),this.$bookmark.getBookmarks().then((e=>{const{selAllChk:t}=this.state;e.forEach((e=>{e.ticketUrl=this.$userutils.getTicketUrl(e.ticketNo),e.selected=t,e.rowClass=this.$utils.getRowStatus(e)})),this.setState({isLoading:!1,bookmarksList:e})}))},this.startTimer=()=>this.context.startTimer(this.selectedTicket.ticketNo),this.selectAll=e=>{let{bookmarksList:t}=this.state;t=[...t],t.forEach((t=>t.selected=e)),this.setState({selAllChk:e,bookmarksList:t})},this.deleteSelection=()=>this.deleteBookmark(),this.showAddPopup=()=>this.setState({showAddPopup:!0}),this.hideAddPopup=e=>{e?this.refreshData():this.setState({showAddPopup:!1})},(0,g.f3)(this,"JiraService","BookmarkService","UtilsService","UserUtilsService","MessageService"),this.contextMenu=[{label:"Select Bookmark",icon:"fa fa-check-square-o",command:()=>this.selectTicket(this.selectedTicket)},{label:"Add worklog",icon:"fa fa-clock-o",command:()=>this.addWorklogOn(this.selectedTicket.ticketNo)},{label:"Delete Bookmark",icon:"fa fa-trash-o",command:()=>this.deleteBookmark(this.selectedTicket.ticketNo)}],this.state.selAllBks=!1,this.state.bookmarksList=[]}selectTicket(e){e.selected=!e.selected;let{bookmarksList:t}=this.state;t=[...t],this.setState({bookmarksList:t})}componentDidMount(){super.componentDidMount(),this.refreshData()}showContext(e,t){this.selectedTicket=t;const s=[...this.contextMenu];try{const e=this.context.getElapsedTimeInSecs(),a=(null===e||void 0===e?void 0:e.key)===t.ticketNo,o=null===e||void 0===e?void 0:e.isRunning;a?(o?s.push({label:"Pause timer",icon:"fa fa-pause",command:this.context.pauseTimer}):s.push({label:"Resume timer",icon:"fa fa-play",command:this.context.resumeTimer}),s.push({label:"Stop timer",icon:"fa fa-stop",command:this.context.stopTimer})):s.push({label:"Start timer",icon:"fa fa-play",command:this.startTimer})}catch{}(0,y.pT)(e,s)}deleteBookmark(e){let t;t=e?[e]:this.state.bookmarksList.filter((e=>e.selected)).map((e=>e.ticketNo)),0!==t.length?ks.Z.confirmDelete("Are you sure to delete the selected bookmark(s)?","Confirm delete bookmark(s)").then((()=>{this.setState({isLoading:!0}),this.$bookmark.removeBookmark(t).then((e=>{this.setState({bookmarksList:e,isLoading:!1})}))})):this.$message.info("Select the bookmarks to be deleted!")}executeEvent(e){e.type===a.X.TicketBookmarked&&this.refreshData()}renderCustomActions(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.zx,{icon:"fa fa-plus",onClick:this.showAddPopup,title:"Add ticket to bookmarks"}),(0,S.jsx)(b.zx,{type:"danger",icon:"fa fa-trash-o",onClick:this.deleteSelection,title:"Remove selected ticket(s) from bookmarks"})]})}render(){const{bookmarksList:e,selAllChk:t,showAddPopup:s}=this.state;return super.renderBase((0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(se.TT,{dataset:e,exportSheetName:"My bookmarks",children:[(0,S.jsx)(se.Et,{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)(se.sg,{className:"w40",noExport:!0,children:(0,S.jsx)(b.XZ,{checked:t,onChange:this.selectAll})}),(0,S.jsx)(se.sg,{sortBy:"ticketNo",children:"Ticket No"}),(0,S.jsx)(se.sg,{sortBy:"issuetype",children:"Type"}),(0,S.jsx)(se.sg,{sortBy:"summary",children:"Summary"}),(0,S.jsx)(se.sg,{sortBy:"assigneeName",children:"Assignee"}),(0,S.jsx)(se.sg,{sortBy:"reporter",children:"Reporter"}),(0,S.jsx)(se.sg,{sortBy:"priority",children:"Priority"}),(0,S.jsx)(se.sg,{sortBy:"status",children:"Status"}),(0,S.jsx)(se.sg,{sortBy:"resolution",children:"Resolution"}),(0,S.jsx)(se.sg,{sortBy:"createdSortable",children:"Created"}),(0,S.jsx)(se.sg,{sortBy:"updatedSortable",children:"Updated"})]})}),(0,S.jsx)(se.XP,{children:(e,t)=>(0,S.jsxs)("tr",{"data-test-id":e.ticketNo,onContextMenu:t=>this.showContext(t,e),className:e.rowClass,children:[(0,S.jsxs)("td",{className:"text-center",children:[e.selected&&(0,S.jsx)(b.XZ,{checked:!0,onChange:()=>this.selectTicket(e)}),!e.selected&&(0,S.jsx)("i",{className:"fa fa-ellipsis-v",onClick:t=>this.showContext(t,e)})]}),(0,S.jsx)("td",{children:(0,S.jsx)(w.Z,{href:e.ticketUrl,className:"link strike",children:e.ticketNo})}),(0,S.jsxs)("td",{children:[e.issuetypeIcon&&(0,S.jsx)(b.Ee,{src:e.issuetypeIcon}),e.issuetype]}),(0,S.jsx)("td",{children:e.summary}),(0,S.jsx)("td",{children:e.assigneeName}),(0,S.jsx)("td",{children:e.reporterName}),(0,S.jsxs)("td",{children:[e.priorityIcon&&(0,S.jsx)(b.Ee,{src:e.priorityIcon}),e.priority]}),(0,S.jsxs)("td",{children:[e.statusIcon&&(0,S.jsx)(b.Ee,{src:e.statusIcon}),e.status]}),(0,S.jsxs)("td",{children:[e.resolutionIcon&&(0,S.jsx)(b.Ee,{src:e.resolutionIcon}),e.resolution]}),(0,S.jsx)("td",{children:e.created}),(0,S.jsx)("td",{children:e.updated})]},e.ticketNo)}),(0,S.jsx)(se.ch,{span:11,children:"You have not yet bookmarked any tickets. Bookmark your frequently used tickets"})]}),s&&(0,S.jsx)(ys,{onHide:this.hideAddPopup})]}))}}js.contextType=I.a2;const vs=js;class ws extends u.ZP{constructor(e){super(e,"My open tickets","fa-eye"),this.refreshData=async e=>{this.setState({isLoading:!0});try{const t=(await this.$jira.getOpenTickets(e)).map((e=>{const t=e.fields;return{ticketNo:e.key,ticketUrl:this.$userutils.getTicketUrl(e.key),issuetypeIcon:(t.issuetype||{}).iconUrl,issuetype:(t.issuetype||{}).name,summary:t.summary,reporter:(t.reporter||{}).displayName,priorityIcon:(t.priority||{}).iconUrl,priority:(t.priority||{}).name,statusIcon:(t.status||{}).iconUrl,status:(t.status||{}).name,resolutionIcon:(t.resolution||{}).iconUrl,resolution:(t.resolution||{}).name,createdSortable:t.created,updatedSortable:t.updated,created:this.$userutils.formatDateTime(t.created),updated:this.$userutils.formatDateTime(t.updated)}}));this.setState({ticketList:t,isLoading:!1})}finally{this.setState({isLoading:!1})}},this.bookmarkAdded=()=>this.performAction(u.Xk.TicketBookmarked),(0,g.f3)(this,"JiraService","BookmarkService","UserUtilsService"),this.state.isLoading=!0,this.state.ticketList=[]}componentDidMount(){super.componentDidMount(),this.refreshData()}getHint(){return(0,S.jsxs)("ul",{className:"gadget-hint",children:[(0,S.jsx)("li",{children:"By default, unresolved ticket list assigned to you are shown in this gadget"}),(0,S.jsx)("li",{children:'You can control the list of tickets to be shown, by editing "Open tickets JQL" in Advanced Settings'}),(0,S.jsx)("li",{children:"Right click on any ticket to start time tracking or see more options"})]})}render(){const{ticketList:e}=this.state;return super.renderBase((0,S.jsxs)(se.TT,{dataset:e,exportSheetName:"My open tickets",children:[(0,S.jsx)(se.Et,{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)(se.sg,{sortBy:"ticketNo",children:"Ticket No"}),(0,S.jsx)(se.sg,{sortBy:"issuetype",children:"Type"}),(0,S.jsx)(se.sg,{sortBy:"summary",children:"Summary"}),(0,S.jsx)(se.sg,{sortBy:"reporter",children:"Reporter"}),(0,S.jsx)(se.sg,{sortBy:"priority",children:"Priority"}),(0,S.jsx)(se.sg,{sortBy:"status",children:"Status"}),(0,S.jsx)(se.sg,{sortBy:"resolution",children:"Resolution"}),(0,S.jsx)(se.sg,{sortBy:"createdSortable",children:"Created"}),(0,S.jsx)(se.sg,{sortBy:"updatedSortable",children:"Updated"})]})}),(0,S.jsx)(se.XP,{children:(e,t)=>(0,S.jsx)(Ss,{ticket:e,onAddWorklog:this.addWorklogOn,onBookmark:this.bookmarkAdded},t)}),(0,S.jsx)(se.ch,{span:9,children:"No open tickets were assigned to you. Enjoy your day!"})]}))}showContext(e,t){this.selectedTicket=t,(0,y.pT)(e,this.contextMenu)}}class Ss extends o.PureComponent{constructor(){super(...arguments),this.setRef=e=>this.keyCtr=e,this.showContext=e=>this.keyCtr.showContext(e)}render(){const{ticket:e,onAddWorklog:t,onBookmark:s}=this.props;return(0,S.jsxs)("tr",{onContextMenu:this.showContext,"data-test-id":e.ticketNo,children:[(0,S.jsx)(z.a3,{ref:this.setRef,value:e.ticketNo,onAddWorklog:t,onBookmark:s}),(0,S.jsxs)("td",{children:[(0,S.jsx)(b.Ee,{src:e.issuetypeIcon}),e.issuetype]}),(0,S.jsx)("td",{children:e.summary}),(0,S.jsx)("td",{children:e.reporter}),(0,S.jsxs)("td",{children:[(0,S.jsx)(b.Ee,{src:e.priorityIcon}),e.priority]}),(0,S.jsxs)("td",{children:[(0,S.jsx)(b.Ee,{src:e.statusIcon}),e.status]}),(0,S.jsxs)("td",{children:[e.resolutionIcon&&(0,S.jsx)(b.Ee,{src:e.resolutionIcon}),e.resolution]}),(0,S.jsx)("td",{children:e.created}),(0,S.jsx)("td",{children:e.updated})]})}}const Ns=ws;class Ts extends u.ZP{constructor(e){super(e,"My Reports","fa-filter"),this.refreshData=()=>{this.setState({isLoading:!0}),this.$report.getReportsList().then((e=>{const{selAllChk:t}=this.state;e.forEach((e=>{e.selected=t,e.displayDate=this.$userutils.formatDateTime(e.dateCreated),e.sortDate=e.dateCreated.getTime()})),this.setState({reportsList:e,isLoading:!1})}))},this.deleteSelectedReports=()=>{const e=this.state.reportsList.filter((e=>e.selected)).map((e=>e.id));0!==e.length?ks.Z.confirmDelete("Are you sure to delete the selected report(s)?","Confirm delete report(s)").then((()=>{this.setState({isLoading:!0}),this.$report.deleteSavedQuery(e).then((()=>this.refreshData()))})):this.$message.info("Select the reports to be deleted!")},this.selectAll=()=>{let{reportsList:e,selAllChk:t}=this.state;t=!t,e.forEach((e=>e.selected=t)),e=[...e],this.setState({reportsList:e,selAllChk:t,selReportsCount:t?e.length:null})},this.downloadReports=()=>{const e=this.state.reportsList.filter((e=>e.selected)).map((e=>e.id));0!==e.length?this.$report.exportQueries(e):this.$message.info("Select the reports to be exported!")},this.fileSelected=()=>{const e=this.fileSelector,t=e.files[0];if(t){if(!t.name.endsWith(".jrd"))return this.$message.warning("Unknown file selected to import. Select a valid Jira Assist Report definition (*.jrd) file"),void(e.value="");const s=new FileReader;s.readAsText(t,"UTF-8"),s.onload=e=>{const t=e.target.result;try{const e=JSON.parse(t).reports;if(!e||!Array.isArray(e))return void this.$message.error("Selected file is invalid or is corrupted");e.forEach((e=>{e.oldName=e.queryName,e.selected=!0,e.status="Will import"})),this.setState({reportsToImport:e})}catch(s){this.$message.error("Selected file is invalid or is corrupted")}},s.onerror=e=>{this.$message.error("Selected file is invalid or is corrupted. Unable to load the file!")}}e.value=""},this.editReport=e=>{this.context.navigate(`/reports/${e.advanced?"advanced":e.isNew?"custom":"customgrouped"}/${e.id}`,!0)},this.hideImportPopup=e=>{e&&this.refreshData(),this.setState({reportsToImport:null})},this.setFileSelector=e=>this.fileSelector=e,this.chooseFileForImport=()=>this.fileSelector.click(),(0,g.f3)(this,"ReportService","MessageService","UserUtils"),this.state.isLoading=!0}componentDidMount(){super.componentDidMount(),this.refreshData()}selectRowItem(e){e.selected=!e.selected;let{reportsList:t}=this.state;t=[...t];const s=t.count((e=>e.selected));this.setState({reportsList:t,selReportsCount:s})}renderCustomActions(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("input",{ref:this.setFileSelector,type:"file",className:"hide",accept:".jrd",onChange:this.fileSelected}),(0,S.jsx)(b.zx,{icon:"fa fa-upload",onClick:this.chooseFileForImport,title:"Import reports shared by others"}),(0,S.jsx)(b.zx,{icon:"fa fa-download",disabled:!this.state.selReportsCount,onClick:this.downloadReports,title:"Export reports to share with others"}),(0,S.jsx)(b.zx,{type:"danger",icon:"fa fa-trash-o",onClick:this.deleteSelectedReports,title:"Delete selected report(s)"})]})}render(){const{reportsList:e,selAllChk:t,reportsToImport:s}=this.state;return super.renderBase((0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(se.TT,{dataset:e,exportSheetName:"My reports",children:[(0,S.jsx)(se.Et,{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)(se.sg,{className:"w40",children:(0,S.jsx)(b.XZ,{checked:t,onChange:this.selectAll})}),(0,S.jsx)(se.sg,{sortBy:"queryName",children:"Report name"}),(0,S.jsx)(se.sg,{sortBy:"sortDate",children:"Created On"}),(0,S.jsx)(se.sg,{sortBy:"advanced",children:"Report type"}),(0,S.jsx)(se.sg,{sortBy:"outputCount",children:"Output fields"}),(0,S.jsx)(se.sg,{children:"Options"})]})}),(0,S.jsx)(se.XP,{children:e=>(0,S.jsxs)("tr",{children:[(0,S.jsx)("td",{className:"text-center",children:(0,S.jsx)(b.XZ,{checked:e.selected,onChange:()=>this.selectRowItem(e)})}),(0,S.jsx)("td",{children:e.queryName}),(0,S.jsx)("td",{children:e.displayDate}),(0,S.jsx)("td",{children:e.advanced?"Advanced report":"Custom Report"+(e.isNew?"":" (old)")}),(0,S.jsx)("td",{children:e.outputCount}),(0,S.jsx)("td",{className:"text-center",children:(0,S.jsx)(b.zx,{icon:"fa fa-edit",onClick:()=>this.editReport(e),title:"Click to edit this report"})})]},e.id)}),(0,S.jsx)(se.ch,{span:7,children:"You have not yet created or imported any reports."})]}),s&&(0,S.jsx)(bs,{reportsToImport:s,onHide:this.hideImportPopup})]}))}}Ts.contextType=I.Il;const Cs=Ts;class bs extends C.Z{constructor(e){super(e,"Select reports to import"),this.selectAllReports=()=>{let{selectAll:e,reportsToImport:t}=this.state;e=!e,t=[...t],t.forEach((t=>{t.selected=!t.disabled&&e,this.updateReportStatus(t)})),this.setState({selectAll:e,reportsToImport:t,selReportsCount:this.getReportsCount(t)})},this.getReportsCount=e=>(e||this.state.reportsToImport).filter((e=>e.selected)).length,this.importReports=()=>{const e=this.state.reportsToImport.filter((e=>e.selected)),t=e.map((e=>{const t={...e};return delete t.selected,delete t.id,delete t.oldName,delete t.status,this.$report.saveQuery(t).then((t=>(e.selected=!1,e.disabled=!0,e.status="Imported",!0)),(()=>(e.status="Duplicate name",!1)))}));Promise.all(t).then((t=>{if(t.some((e=>!e))){this.$message.error("Some of the reports were not import!","Import failed");let{reportsToImport:e}=this.state;e=[...e],this.setState({selReportsCount:this.getReportsCount(e),reportsToImport:e})}else this.$message.success(`${e.length} selected reports were imported`,"Reports imported"),this.onHide(!0)}))},(0,g.f3)(this,"UserUtilsService","MessageService","ReportService"),this.style={width:"850px"},this.state.selectAll=!0,this.state.reportsToImport=this.props.reportsToImport,this.state.selReportsCount=this.getReportsCount()}reportSelected(e){e.selected=!e.selected,this.updateReportStatus(e),this.setState({selReportsCount:this.getReportsCount()})}updateReportStatus(e){e.selected?(e.queryName||(e.queryName=e.oldName),e.status="Will import"):e.status="Excluded"}reportNameChanged(e,t){e.queryName=t,e.queryName?e.status="Will import":e.status="Name required",this.forceUpdate()}getFooter(){const{selReportsCount:e}=this.state;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.zx,{icon:"fa fa-times",onClick:this.onHide,label:"Cancel",type:"default"}),(0,S.jsx)(b.zx,{icon:"fa fa-check",disabled:!e,onClick:this.importReports,label:"Import",type:"primary"})]})}render(){const{reportsToImport:e,selectAll:t}=this.state;return super.renderBase((0,S.jsx)("div",{children:(0,S.jsxs)(se.TT,{dataset:e,children:[(0,S.jsx)("caption",{children:"Select all the reports which you would like to import and provide a name for the report to import."}),(0,S.jsx)(se.Et,{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)("th",{className:"no-min-width",children:(0,S.jsx)(b.XZ,{checked:t,onChange:this.selectAllReports})}),(0,S.jsx)("th",{children:"Report name"}),(0,S.jsx)("th",{children:"Report name (new)"}),(0,S.jsx)("th",{children:"Created date"}),(0,S.jsx)("th",{children:"Last modified date"}),(0,S.jsx)("th",{children:"Status"})]})}),(0,S.jsx)(se.XP,{children:(e,t)=>(0,S.jsxs)("tr",{children:[(0,S.jsx)("td",{className:"data-center",children:(0,S.jsx)(b.XZ,{checked:e.selected,disabled:e.disabled,onChange:t=>this.reportSelected(e,t)})}),(0,S.jsx)("td",{children:e.oldName}),(0,S.jsx)("td",{children:(0,S.jsx)(b.zC,{value:e.queryName,disabled:e.disabled||!e.selected,onChange:t=>this.reportNameChanged(e,t)})}),(0,S.jsx)("td",{children:this.$userutils.formatDateTime(e.dateCreated)}),(0,S.jsx)("td",{children:this.$userutils.formatDateTime(e.dateUpdated)}),(0,S.jsx)("td",{children:e.status})]},`${t}_${e.status}`)})]})}))}}class Ds extends u.ZP{constructor(e){super(e,"Worklog - [Pending upload]","fa-clock-o"),this.refreshData=()=>(this.state.isLoading||this.setState({isLoading:!0}),this.$worklog.getPendingWorklogs().then((e=>{const{selAllChk:t}=this.state;e.forEach((e=>{e.ticketUrl=this.$userutils.getTicketUrl(e.ticketNo),e.rowClass=this.$utils.getRowStatus(e),e.displayDate=this.$userutils.formatDateTime(e.dateStarted),e.selected=t,e.timeSpent=this.$utils.formatTs(e.timeSpent),e.overrideTimeSpent=this.$utils.formatTs(e.overrideTimeSpent)})),this.setState({isLoading:!1,worklogs:e})}))),this.selectAll=e=>{const{worklogs:t}=this.state;t.forEach((t=>t.selected=e)),this.setState({worklogs:[...t],selAllChk:e})},(0,g.f3)(this,"WorklogService","UtilsService","UserUtilsService","MessageService"),this.contextMenu=[{label:"Select worklog",icon:"fa fa-check-square-o",command:()=>this.selectRowItem(this.selectedItem)},{label:"Edit worklog",icon:"fa fa-edit",command:()=>this.editWorklogObj()},{label:"Copy worklog",icon:"fa fa-copy",command:()=>this.editWorklogObj(!0)},{label:"Upload worklog",icon:"fa fa-upload",command:()=>this.uploadWorklog([this.selectedItem])},{label:"Delete worklog",icon:"fa fa-trash-o",command:()=>this.deleteWorklog([this.selectedItem])}],this.state.selAllChk=!0,this.state.isLoading=!0}componentDidMount(){super.componentDidMount(),this.refreshData()}getHint(){return(0,S.jsxs)("ul",{className:"gadget-hint",children:[(0,S.jsx)("li",{children:"List of worklog entries created and yet to be uploaded to Jira are shown here"}),(0,S.jsx)("li",{children:"You can upload, edit or delete the entries from here or from worklog calendar"})]})}editWorklogObj(e){const t=Object.create(this.selectedItem);t.copy=e,this.addWorklog(t)}showContext(e,t){this.selectedItem=t,(0,y.pT)(e,this.contextMenu)}async uploadWorklog(e){e||(e=this.state.worklogs.filter((e=>e.selected)));const t=e.map((e=>e.id));if(0!==t.length){this.setState({isLoading:!0});try{const e=await this.$worklog.uploadWorklogs(t);this.setState({isLoading:!1,worklogs:e}),super.performAction(u.Xk.WorklogModified)}catch(s){(s.message||s.response)&&this.$message.error(s.message||s.response)}finally{this.refreshData()}}else this.$message.info("Select the worklogs to be uploaded!")}deleteWorklog(e){e||(e=this.state.worklogs.filter((e=>e.selected)));const t=e.map((e=>e.id));0!==t.length?ks.Z.confirmDelete("Are you sure to delete the selected worklog(s)?","Confirm delete worklog(s)").then((()=>{this.setState({isLoading:!0}),this.$worklog.deleteWorklogs(t).then((e=>{this.refreshData(),this.performAction(u.Xk.DeletedWorklog)}))})):this.$message.info("Select the worklogs to be deleted!")}executeEvent(e){e.type!==u.Xk.AddWorklog&&e.type!==u.Xk.DeletedWorklog&&e.type!==u.Xk.WorklogModified||this.refreshData()}selectRowItem(e){e.selected=!e.selected;const{worklogs:t}=this.state;this.setState({worklogs:[...t]})}renderCustomActions(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.zx,{icon:"fa fa-upload",onClick:()=>this.uploadWorklog(),title:"Upload selected worklogs"}),(0,S.jsx)(b.zx,{type:"danger",icon:"fa fa-trash-o",onClick:()=>this.deleteWorklog(),title:"Delete selected worklogs"})]})}render(){var e;const{worklogs:t,selAllChk:s,isLoading:a}=this.state;return super.renderBase((0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(se.TT,{dataset:t,exportSheetName:"Pending worklogs",children:[(0,S.jsx)(se.Et,{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)(se.sg,{className:"w40",noExport:!0,children:(0,S.jsx)(b.XZ,{checked:s,onChange:this.selectAll})}),(0,S.jsx)(se.sg,{sortBy:"ticketNo",children:"Ticket No"}),(0,S.jsx)(se.sg,{sortBy:"summary",children:"Summary"}),(0,S.jsx)(se.sg,{sortBy:"summary",children:"Assignee"}),(0,S.jsx)(se.sg,{sortBy:"dateStarted",children:"Log Time"}),(0,S.jsx)(se.sg,{sortBy:"timeSpent",children:"Time Spent"}),(0,S.jsx)(se.sg,{sortBy:"overrideTimeSpent",children:"Override Time"}),(0,S.jsx)(se.sg,{children:"Description"})]})}),(0,S.jsx)(se.XP,{children:e=>(0,S.jsxs)("tr",{onContextMenu:t=>this.showContext(t,e),className:e.rowClass,"data-test-id":e.ticketNo,children:[(0,S.jsxs)("td",{className:"text-center",children:[e.selected&&(0,S.jsx)(b.XZ,{checked:!0,onChange:()=>this.selectRowItem(e)}),!e.selected&&(0,S.jsx)("i",{className:"fa fa-ellipsis-v",onClick:t=>this.showContext(t,e)})]}),(0,S.jsx)("td",{children:(0,S.jsx)(w.Z,{href:e.ticketUrl,className:"link strike",children:e.ticketNo})}),(0,S.jsx)("td",{children:e.summary}),(0,S.jsx)("td",{children:e.assignee}),(0,S.jsx)("td",{children:e.displayDate}),(0,S.jsx)("td",{children:e.timeSpent}),(0,S.jsx)("td",{children:e.overrideTimeSpent}),(0,S.jsx)("td",{children:e.description})]},e.id)}),(0,S.jsx)(se.ch,{span:7,children:"No worklog pending to be uploaded!"})]}),(0,S.jsx)(F,{enabled:!a&&this.context.needReload,onChange:this.refreshData},null===(e=this.context.timerEntry)||void 0===e?void 0:e.key)]}))}}Ds.contextType=I.a2;const $s=Ds;class Ws extends u.ZP{constructor(e){super(e,"Ticketwise worklog","fa-list-alt"),this.refreshData=()=>{const e=this.settings.dateRange;e&&e.fromDate&&(this.setState({isLoading:!0}),e.dateWise=!1,this.$worklog.getWorklogs(e).then((e=>{e.forEach((e=>{e.rowClass=this.$utils.getRowStatus(e),e.ticketUrl=this.$userutils.getTicketUrl(e.ticketNo),e.totalHours=this.$utils.formatTs(e.totalHours),e.uploaded=this.$utils.formatTs(e.uploaded),e.pendingUpload=this.$utils.formatTs(e.pendingUpload)})),this.setState({isLoading:!1,worklogs:e})})))},this.dateSelected=e=>{this.settings.dateRange=e,e.toDate&&(this.refreshData(),e.auto||this.saveSettings())},(0,te.f3)(this,"WorklogService","UserUtilsService","UtilsService","MessageService"),this.contextMenu=[{label:"Upload worklog",icon:"fa fa-clock-o",command:()=>this.uploadWorklog()},{label:"Add worklog",icon:"fa fa-bookmark",command:()=>this.addWorklog()}]}componentDidMount(){super.componentDidMount(),this.refreshData()}showContext(e,t){this.selectedTicket=t,(0,y.pT)(e,this.contextMenu)}renderCustomActions(){return(0,S.jsx)(b.Mt,{range:!0,value:this.settings.dateRange,onChange:this.dateSelected,style:{marginRight:"35px"}})}getWorklogUrl(e,t){return this.$userutils.getWorklogUrl(e,t)}getTicketUrl(e){return this.$userutils.getTicketUrl(e)}async uploadWorklog(){const e=this.selectedTicket.logData.filter((e=>!e.worklogId)).map((e=>e.id));if(e.length){this.setState({isLoading:!0});try{await this.$worklog.uploadWorklogs(e),this.refreshData(),super.performAction(a.X.WorklogModified)}catch(t){t.message&&this.$message.error(t.message)}finally{this.setState({isLoading:!1})}}}addWorklog(){const{ticketNo:e}=this.selectedTicket,t=r().subtract(1,"hours").toDate();super.addWorklog({ticketNo:e,startTime:t,timeSpent:"01:00",allowOverride:!0})}render(){const{worklogs:e}=this.state;return super.renderBase((0,S.jsxs)(se.TT,{dataset:e,exportSheetName:"Ticketwise worklog",children:[(0,S.jsx)(se.Et,{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)(se.sg,{sortBy:"ticketNo",style:{width:"100px"},children:"Ticket No"}),(0,S.jsx)(se.sg,{sortBy:"summary",children:"Summary"}),(0,S.jsx)(se.sg,{sortBy:"totalHours",children:"Total Hours"}),(0,S.jsx)(se.sg,{sortBy:"uploaded",children:"Uploaded"}),(0,S.jsx)(se.sg,{sortBy:"pendingUpload",children:"Pending Upload"}),(0,S.jsx)(se.sg,{sortBy:"parentKey",children:"Parent Ticket"}),(0,S.jsx)(se.sg,{children:"Dates Logged"}),(0,S.jsx)(se.sg,{style:{width:"400px"},children:"Description"})]})}),(0,S.jsx)(se.XP,{children:e=>(0,S.jsxs)("tr",{onContextMenu:t=>this.showContext(t,e),className:e.rowClass,children:[(0,S.jsx)("td",{children:(0,S.jsx)(w.Z,{href:e.ticketUrl,className:"link strike",children:e.ticketNo})}),(0,S.jsx)("td",{children:e.summary}),(0,S.jsx)("td",{children:e.totalHours}),(0,S.jsx)("td",{children:e.uploaded}),(0,S.jsx)("td",{children:e.pendingUpload}),(0,S.jsx)("td",{children:e.parentKey?`${e.parentKey} - ${e.parentSumm}`:""}),(0,S.jsx)("td",{children:(0,S.jsx)("ul",{className:"tags",children:e.logData.map(((t,s)=>(0,S.jsxs)("li",{children:[t.worklogId&&(0,S.jsxs)(w.Z,{className:"link badge badge-pill skin-bg-font",href:this.getWorklogUrl(e.ticketNo,t.worklogId),title:t.comments,children:[(0,S.jsx)("span",{className:"fa fa-clock-o"}),"  ",(0,S.jsx)(z.qm,{tag:"span",value:t.dateLogged}),": ",t.uploaded]}),!t.worklogId&&(0,S.jsxs)("span",{className:"link badge badge-pill skin-bg-font",onClick:()=>this.editWorklog(t.id),title:t.comments,children:[(0,S.jsx)("span",{className:"fa fa-clock-o"})," ",(0,S.jsx)(z.qm,{tag:"span",value:t.dateLogged}),": ",t.uploaded]})]},s)))})}),(0,S.jsx)("td",{children:e.description})]},e.ticketNo)}),(0,S.jsx)(se.ch,{span:8,children:"No records exists"})]}))}}const Us=Ws,Ls=[{id:"myOpenTickets",icon:"fa-eye",name:"My Open Tickets",details:"Contains the list of open tickets assigned to you"},{id:"myBookmarks",icon:"fa-bookmark",name:"Bookmarks",details:"List of bookmarked tickets"},{id:"dateWiseWorklog",icon:"fa-list-alt",name:"Logged Work - [Daywise]",details:"List of worklog's grouped by date"},{id:"worklogBarChart",icon:"fa-bar-chart",name:"Worklog Bar Chart",details:"Worklogs represented as a stacked bar chart"},{id:"teamWorklogReport",icon:"fa-bar-chart",name:"Team Daywise Worklog",details:"Worklogs represented for individual users on daily basis as table"},{id:"pendingWorklog",icon:"fa-clock-o",name:"Worklog - [Pending Upload]",details:"Worklog's still pending for upload"},{id:"ticketWiseWorklog",icon:"fa-list-alt",name:"Logged Work - [Ticketwise]",details:"List of worklog's grouped by ticket"},{id:"myFilters",icon:"fa-filter",name:"My Reports",details:"List of custom & advanced report built / imported by you"},{id:"agendaDay",icon:"fa-calendar",name:"Current day calendar",details:"Display calendar for current date with worklog and meetings"},{id:"agendaWeek",icon:"fa-calendar",name:"Current week calendar",details:"Display calendar for current week with worklog and meetings"},{id:"listDay",icon:"fa-calendar",name:"Current day worklog List",details:"Display calendar as listview for current date with worklog and meetings"},{id:"listWeek",icon:"fa-calendar",name:"Current week worklog list",details:"Display calendar as listview for current week with worklog and meetings"},{id:"listMonth",icon:"fa-calendar",name:"Current month worklog list",details:"Display calendar as listview for current month with worklog and meetings"},{id:"sWiseTSpent",icon:"fa-list-alt",name:"Status Wise Time Spent",details:"Provides summary of time spent on each ticket on individual status"}]},9113:(e,t,s)=>{s.d(t,{Q:()=>h});var a=s(7313),o=s(4711),r=s(2725),i=s(4616),l=s(6417);const n=[9,16,17,18,27,123],d=/^\b[A-Z][A-Z0-9_]+-[1-9][0-9]*$/gi;async function c(e,t){var s;if(!new RegExp(d).test(t))return;const{$session:a}=(0,i.f3)("SessionService"),r=null===(s=a.CurrentUser.jiraUrl)||void 0===s?void 0:s.clearEnd("/");try{const[s]=await e.searchTickets(`key=${t}`);return{id:s.id,key:s.key,root:r,url:(0,o.V8)(r,s.key),summary:s.fields.summary,summaryText:s.fields.summary,img:s.fields.issuetype.iconUrl}}catch(l){console.error("Invalid issue key provided in picker",l)}}const h=a.memo((function(e){let{value:t,disabled:s,useDisplay:o,returnObject:d,onPick:h,onInvalid:p,tabIndex:m,...u}=e;const g=(0,a.useRef)({}),[f,x]=(0,a.useState)(o&&!!t),[y,k]=(0,a.useState)(!(!o||!t)&&{key:t}),[j,v]=(0,a.useState)(!t),{$jira:w}=(0,i.f3)("JiraService"),S=(e,t)=>{x(!1),!h||!e&&p&&t?p&&!e&&t&&p(t):h(d?e:null===e||void 0===e?void 0:e.key),e?o&&(k(e),v(!1)):(k(!1),v(!0))};(0,a.useEffect)((()=>{!o||!t||null!==y&&void 0!==y&&y.id&&t===y.key||async function(){const e=await c(w,t);S(e)}()}),[t]);const N=e=>{g.current.blurTimer&&(clearTimeout(g.current.blurTimer),delete g.current.blurTimer),S(e.value)},T=e=>{const t=e.target.value;t?g.current.blurTimer=setTimeout((async()=>{delete g.current.blurTimer,k({key:t}),x(!0);const e=await c(w,t);S(e)}),600):S("")},C=e=>{n.includes(e.keyCode)||v(!0)};return f&&o&&y?(0,l.jsxs)("div",{className:"sel-issue loading-data",title:"Please wait. Loading details...",children:[(0,l.jsx)("span",{className:"issue-key",children:y.key})," -",(0,l.jsx)("div",{className:"issue-summary",children:"Loading..."}),(0,l.jsx)("span",{className:"fa fa-spin fa-spinner"})]}):!j&&y&&o?(0,l.jsxs)("div",{className:"sel-issue"+(s?" disabled":""),tabIndex:m,onClick:s?void 0:C,onKeyDown:s?void 0:C,"data-test-id":"issue-key","data-issue-key":y.key,children:[(0,l.jsx)(r.Ee,{src:y.img,className:"margin-r-8"}),(0,l.jsx)("span",{className:"issue-key",children:y.key})," -",(0,l.jsx)("div",{className:"issue-summary",children:y.summaryText}),!s&&(0,l.jsx)("span",{className:"edit-key fa fa-pencil",title:"Click to edit issue"})]}):(0,l.jsx)(r.Qc,{value:t,displayField:"value",dataset:w.lookupIssues,disabled:s,maxLength:20,onSelect:N,onBlur:T,autoFocus:!0,optionGroupChildren:"issues",optionGroupLabel:"label",valueField:"key",...u,children:e=>(0,l.jsxs)("span",{style:{fontSize:12,margin:"10px 10px 0 0"},children:[(0,l.jsx)(r.Ee,{src:e.img,alt:"",className:"margin-r-8"}),e.key," - ",e.summaryText]})})}))}}]);